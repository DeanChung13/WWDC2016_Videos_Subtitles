國際用戶界面的新功能
早上好！歡迎大家！
感謝大家來參加本場演講我是Sara Radi
國際軟件工程師
今天和同事Joaquim Lobo Silva
一起討論一下國際用戶界面
現在我們開始
Apple軟件支持40多個本地化版本
每一種語言對我們來說都是挑戰
今天我們主要討論
軟件支持的兩種從右向左書寫的語言
它們是阿拉伯語和希伯來語
這種語言是巨大的挑戰
在開發應用時
這是因爲書寫方向與衆不同
那麼爲什麼我們要單獨討論這兩種語言呢？
在中東有超過4億的人口
這是一個巨大的正在成長的市場
就在去年 我們在阿拉伯聯合酋長國開了兩個Apple Store
圖片是Apple Store的開業分別位於阿布扎比和
迪拜...
僅幾周前 我們在阿拉伯聯合酋長國首次開放了Apple.com
網站的阿拉伯語版本
這確實非常令人激動那麼這對你來說意味着什麼呢？
作爲開發者你在這個市場獲得了更多的機會
爲用戶開發語言本地化的應用非常重要
因此在這個演講中我們主要談論從右向左書寫的語言
如果你想了解更多的關於語言本地化應用的設計
請查閱這兩個演講
“兼收幷蓄的應用設計”主要探討
應用的人機交互界面
以及“國際化最佳實踐”
如果你想學習有關應用國際化的知識
去年 在iOS 9上
我們擴大了國際化支持
全面支持從右向左書寫語言
在那以後
在watchOS 2.1中加入了希伯來語和阿拉伯語的本地化語言支持
今年...
我很高興的宣佈我們一直在致力於爲這個市場重新設計macOS
現在我想帶你們瀏覽一下
在這個演講中我們要經過的議程
首先Joaquim要簡要敘述一下APIs
它們是在去年引入的
然後他要討論一下在iOS 10中的圖像處理的最新進展
以及如何評估佈局方向
最後他會探討watchOS支持的新功能
然後我要講述macOS的新功能
在文本支持中的最新進展和你如何
在應用中正確顯示混合文本
現在讓Joaquim來講講iOS
Joaquim
好 謝謝Sara
早上好!謝謝大家的光臨!
我叫Joaquim 首先讓我
講講iOS
剛纔Sara講過去年在WWDC...
我們宣佈了在iOS整個平臺上全面支持從右向左語言的界面
當這些語言的用戶運行應用時
他們希望用戶界面適應這些語言的特點
UIKit爲你做了大量的工作它的控制層和視圖層
使從右向左語言的應用運行正確
在視圖中管理界面設計可以通過自動設計來實現
而且還有高層次的組件
例如iOS 9中新添加的UIStack視圖在去年也發佈了
它可以讓你很容易地爲用戶界面建模和維護你的界面
它可以容易實現嵌套使用多個水平和垂直視窗
棧視圖的優點是
它可以爲你管理自動佈局約束
尤其對於從右向左語言來說
它可以管理開頭和結尾的約束
它包括左和右兩個屬性
文本可以自動左右調整
當在從右向左的語言中運行的時候
重要的是要注意
正是因爲這些語言是從右向左書寫和閱讀的
這意味着並不是應用的每一個控制都是
嚴格遵守這些語言的書寫方向
還有細微的差別和例外情況
在爲這些語言設計應用時要銘記在心
一個例子是和重放有關的重放用戶界面
例如視頻、音頻和時間軸的快退和快進
它們的佈局方向應該保持一致
另一個例子是我們稱之爲空間界面
它可以是一組控制
它們沒有與它們有關的特定方向性
像左右這樣的文本對齊
在所有的語言中顯然都應該保持一致
還有一個例子是指南針
那些在實體或者地理上有對應物的東西
應該保持不變
東西南北不會根據左右而改變
iOS中有語義內容屬性有助於你管理
並且確定和調節
每個視圖和子視圖的設計流程
它是枚舉類型 正如我剛纔說的它是建立在UIView上的屬性
它包括我剛纔講到的所有的情況
有重放、空間用戶界面
還有自動的強制方向轉換
另外還有未確定 它是默認值
這可能是大多數視圖所屬的類別
因此如果你想更詳盡的瞭解它們
或者你是從右到左用戶界面設計的新手
我建議你查看去年的演講
對國際用戶界面的最新UIKit支持
它詳細介紹了這些概念
並且講解了一些新的API
或者不很新但是是我們新添加到iOS 9中的API
用於從右到左用戶界面
剛纔簡要介紹了iOS的佈局中現有的功能
下面我要介紹圖片
用於從右向左語言的圖片很有趣
它們可以分爲三類
第一類是通用圖片
這可能是大多數圖片所屬的類別
它們包括插圖和圖標
它們不需要考慮語言書寫的方向
任何情況下它們都是一樣的這對你來說當然是很熟悉的
例如常規用戶界面圖片或者在圖片查看器和Interface Builder上爲圖片命名
第二類是有方向和它們關聯的圖片
無論它是導航箭頭
例如導航條中返回按鈕
或者詳細展開按鈕
或者界面佈局表格的單元格上的展開箭頭
或者像本例中 簡單的文本展示
這些圖片應該按照從右向左來展示僅僅翻轉這些圖片
就會生成用於從右向左佈局的正確結果
現在讓我們翻轉圖像現在圓圈處在了正確的位置
在iOS中你可以通過使用imageFlippedForRightToLeftLayoutDirection來實現
我們把它稱爲基於界面圖像的方法和它的返回對象
當在用戶界面圖像視圖中展示的時候它會自動糾正從而正確顯示
如果這個應用在從右向左語言中運行
最後...
第三類是和方向密切相關的圖像
它們要更加複雜
僅僅翻轉圖像會產生
錯誤的從右向左結果
在本例中是和前面相同的項目列表
但是項目符號是對號而不是圓圈 當我翻轉圖像的時候
對號現在處於正確的位置
但是對號也被翻轉了
而在這個從右向左的例子中對號應該和原來保持一致
此時我需要的是兩個單獨的圖像
每個圖像用於一個佈局方向
我可以爲從右到左語言調節圖像
現在它顯示正確了現在我有兩個不同的圖像
到現在爲止你在iOS上
實現了在運行時正確的展示圖像實際上是進行了運行時檢查
你要使用語義內容屬性API
來檢查佈局方向
並且在運行時從文件庫中加載正確的圖像
在iOS 10中我們稍稍改變了一下
我們不贊成
爲從右向左佈局進行圖像翻轉
爲此我們引入了一個新的概念
就可以讓這三種圖像正確顯示
我們使用常規用戶界面圖像或者Interface Builder中的圖像命名
在Xcode 8中引入全新的方向圖片資源庫
它位於資源目錄中
謝謝！
這意味着什麼？
在Xcode中有你的圖像資源庫
現在你有了新的概念和新的屬性你可設置它們
它被稱爲方向屬性你可以設值不同的值
對應前面的幻燈片中提到的概念
一張圖片可以有一個固定的方向
你可以指定一張圖片用於一種佈局方向
也可以翻轉適用於另一種佈局
由從左到右佈局到從右到左佈局轉換或者相反
或者你也可以簡單的指定兩張不同的圖片
在你的資源目錄中兩張圖片適用於不同的方向
這些是圖片資源庫你可能已經熟悉了
其它種類的圖片轉化技術
例如不同的像素密度或者用於不同平臺的圖片
實際上它們是同一個概念你所要做的只是
在Interface Builder中設置圖像或者使用用戶界面圖像加載指定的圖像
現在我想給你們做個演示
好...
這是一個很簡單的應用...
讓我運行一遍展示一下它的界面
它的名字叫旗...
國際模式當然它是一個猜國旗的遊戲 耶
這個遊戲比較直接多人玩很有趣
在這裏你只看到一個非常簡單的用戶界面
這是要猜的國旗
底部有一個顯示按鈕
誰知道這是哪個國家？
我知道現在是星期五早上9點是嗎？
對 好的 我聽到了
我聽到很多人說法國 很好
好 謝謝你！
上面有兩個箭頭 一個向前
指向下一個問題一個箭頭返回
這是通過自動佈局約束實現的
這也是一個垂直棧視圖
誰知道這是哪個國家？
噢 哇 好 很棒 聽聽 好
好極了 是這是我的祖國 葡萄牙
好 現在你們明白了 對嗎？
現在我要給這個應用添加對從右向左語言的支持
現在我不會講這種
從右向左書寫和閱讀的語言
然而如果我想看應用的界面是什麼樣的 不必一定要會說這種語言
Xcode允許我
在自身模擬一個從右向左的環境
所以我要做的僅僅是編輯一下方案
在這兒 頂部有編輯方案
出現了下拉的列表 已經選擇了運行
在頂部有選項標籤
這兒是應用語言重載
這兒列舉了本應用支持的本地化語言 現在只有英語
但是我也能選擇從右向左的假語言設置
下面運行應用
用我的開發語言 英語
但是它讓用戶界面認爲
它運行在從右向左的語言環境中
讓我這樣設置一下 關閉
重新運行應用
好
讓我們再次運行這個遊戲
我們很快就能看到一些變化
導航條是正確的
後退按鈕的位置正確
並且我的用戶界面看起來和以前大致相同
除了你可能已經注意到了
箭頭的方向看起來不對它們指向彼此
它們的位置是正確的前進按鈕在左面
對從右向左語言來說是正確的
但是圖像本身沒有適應變化做出改變
現在我需要改變這種情況
在Xcode 8中 我需要做的是到我的圖像資源庫中
我需要繼續在此選擇它們
注意 我有兩個不同的圖像
一個是後退箭頭 一個是前進箭頭
我要到檢查工具中
選擇新的方向屬性
把它從固定圖像改爲從左向右圖像
翻轉爲相反的佈局方向
同樣...
前進箭頭你可以看到
是從左向右圖像的翻轉而不是固定方向
現在再次運行我的應用
讓我們看看它的界面怎樣
酷 開始遊戲
好 這就是我要做的
它完整的支持從右向左語言環境
不需要額外寫任何代碼
就實現了從右到左用戶界面的設計
自動佈局、棧視圖和現在的圖像資源庫
爲你的程序運行做了大大的提升
對了 還有一個重要的組件
頁面視圖控制器會提供支持
它會管理前進和後退的姿態
因此我也不必爲此多費心思
這就是關於圖像資源庫的演示讓我們回到幻燈片
太酷了！
剛纔簡要介紹了新的提供方向支持的圖像資源庫
現在你也可以完成這一切
如果你的圖像沒有直接儲存在文件庫中
比如你從遠端的服務器上獲取內容
並且它們具有方向性
而且它們要在你的用戶界面上顯示出來
對於沒有儲存在本地的圖像
你可以使用UIKit中的特徵集合來關聯這些圖像
我們也有基於用戶界面圖像的方便方法
讓你指定一個圖像是另一個圖像的相對物
並且它應該被翻轉以後
再添加到圖像資源庫中
這被稱爲imageWithHorizontallyFlippedOrientation方法
如果我用代碼展示給你的話可能更簡單一些
這就是我要做的就是創建圖像資源庫
在這個例子中我得到了一個從左向右圖像
從遠端資源 比如服務器
並且我的從右向左圖像是同一個圖像
但是被水平翻轉了我使用了用戶界面圖像上的新方法
然後要註冊兩個圖像
對應每個佈局方向
使用從左向右和從右向左的特徵集合
你可能已經使用或者編寫過相似的代碼
你正好得到了和特徵集合兼容的圖像
用於圖像視圖
你不必做出改變因爲再說一遍 它們是相同的概念
我們只是在它之上建立了一個新的方向屬性
這就是方向圖像在Xcode 8和iOS 10中的新概念
同樣在watchOS和macOS中也是這樣
正如你前面看到的 我們有了一個新的屬性 叫做佈局方向
這是UIKit中新的UITrait集合
因爲它是新的屬性不要忘記以下幾點
在評估iOS中的佈局方向時
用這個新概念
舉個簡單的例子我有一個UIView子類
在佈局子視圖上進行定製佈局
用這個簡單的藍盒子來表示
由語義內容屬性告知
它是應該是從左到右還是從右到左
這時你可以使用我們的API
現在如果沒有指明語言環境
語義內容屬性服從應用的環境
它可能屬於特徵環境
特徵環境是一個特徵集合
或者可能是這個應用的通用用戶界面佈局方向
現在實際上你的用戶界面視圖應該僅僅關心
它是應該從左到右還是從右到左 就是這樣 好
這相當複雜但是也確實很快
我很高興的告訴大家在iOS 10中你只要這樣做就可以了
通過使用基於用戶界面視圖的新屬性
它是一個計算屬性叫做effectiveUserInterfaceLayoutDirection
它會考慮所有的這些概念
並且立即告訴你應該
以從左向右還是從右向左佈局
如果你在佈局中根本沒有使用UIKit或者UIView
例如你使用SceneKit視圖或者SpriteKit視圖製作遊戲
但是你仍然想利用這些視圖控制器概念
你可以做到的使用這些基於用戶界面視圖新的類程序
給你同樣的
和語義內容屬性有關的同樣的佈局評估
這就是在iOS中的新進展的簡要介紹
我們看到了全新的方向圖像資源庫
可以和Interface Builder以及常規用戶界面圖像一起使用
不需要額外寫任何對從右向左語言支持的代碼
對另外一些圖像也是如此
這些圖像沒有直接儲存在文件庫中
結果是我們不贊成在
iOS 10中使用imageFlippedForRightToLeftLayoutDirection
我們也講解了基於用戶界面視圖新的方便屬性
用於決定定製佈局中的佈局方向
還有一個類程序
使你在其它語言中達到了同樣的效果
這就是iOS的情況現在我要講講watchOS
watchOS 2.1中
添加了阿拉伯語和希伯來語作爲備選系統語言
對於你的應用來說這意味着watchKit現在能夠識別從右向左語言
所有watchKit元素能正確的運行
在選擇阿拉伯語或者希伯來語的時候
它的API和iOS的相似
使你能夠調整每個組或者界面對象的實例
重要的是也要注意 剛剛說過
很自然的人們認爲
我們在iOS中看到的很多設計概念也應用於Watch
推送和彈出界面控制器也有方向
應也爲從右向左語言環境下做出改變
你應該記住這一點如果你的用戶界面
也要這樣顯示
在水平佈局中某些元素的優先級更高要優先顯示
或者按順序排列表格視圖單元格中的圖像
或者標籤有順序都應該改變以適應這些變化
對於Watch來說有一個特別的事物那是時間的思想和概念
具體來說就是順時針和逆時針
再回到那些細微差別和例外情況
如果你有輻射狀的、順時針或者逆時針的用戶界面
在佈局方向中它們應該沒有變化
這是需要謹記在心的一點
除了剛纔我們討論過的概念以外
你用API如何實現這個呢？
因此正如我剛纔說的
運行在從右向左的語言環境下時所有界面對象顯示正確
這包括按鈕、滑塊和開關
除此之外
方向和排列的概念也是自動改變的
這就是說水平界面的方向
和它們的排列以及
和父類有關的WatchKit中對象的排列也相應的改變
在上面的例子中 有一個簡單的應用
上面是水平排列的圖片 左對齊 向左
底部是垂直排列的圖片 左對齊
如果我在希伯來語中運行這個應用左面都轉移到了右面
注意水平界面的元素的排列順序也發生了變化
我們有語義內容屬性和iOS一樣
在我剛纔講過的實例中
幫助管理各個界面、界面對象或者對象組
它的功能和其它屬性的功能一樣簡單
在WatchKit對象中你可以設置這些屬性
如果你沒使用WatchKit來規劃你的用戶界面
而是使用SceneKit或者SpriteKit在WatchOS 3中它們還是很新的
你仍然能夠評估
佈局方向 如果你記住語義內容屬性的話
在這兒我只是使用一個類程序就得到了方向
用於界面設備 一旦我有了它
我只是檢查一下它是從左向右還是從右向左
這是對watchOS 2.1中新添加的特性的簡要介紹
它和iOS的思想和原則是一樣的
所有watchKit元素做得很好使界面顯示正確
而不需要額外的工作
任何在定製的用戶界面或者元素中你也應該考慮到這一點
當然要記住我剛纔提到的微小差別和例外情況
以及你可以使用語義內容屬性
在運行時幫助決定佈局方向
現在我要把時間交給Sara
講解一下macOS和如何處理雙向文本
非常感謝！希望你們度過一個愉快的週五 謝謝！
謝謝！
首先談談macOS
正如其它平臺iOS和watchOS
對於macOS來說概念是完全一樣的
如果你使用標準AppKit控制層
你會得到視圖的準確呈現
當你在從右向左環境中運行你的應用時
現在我想帶你們瀏覽一下系統的一些實例
展示一下動態控制是如何運行的
首先從我們稱之爲系統層控制開始
我們把它稱之爲系統層控制是因爲佈局
遵循用戶運行的系統語言
而不是你的應用佈局方向運行的
讓我們看一些實例可能更清楚一些
讓我們看一下這兒的菜單條
我的系統在從右向左環境中運行
正如你看到的
上面的菜單條從窗口的右邊開始
而且菜單內的元素也是從右向左擴展的
這個概念...
也適用於NSWindow
通過設計
我們決定使窗口控制保持一致
在所有應用中不管你的應用有沒有進行本地化
如果你有自己的邏輯並且你進行自己的定製控制
你需要考慮到這一點並且升級你的邏輯
即使你的應用不支持阿拉伯語或者希伯來語本地化
下一個 應用層控制
這是應用層控制
應用的佈局方向遵循你的應用語言
例如NSTableView
這是一個任務監控應用的截屏
我們使用棧表視圖
你可以看到表視圖的列自動改變了方向
當我們在阿拉伯語中運行應用時
另一個例子NSCollectionView
來自搜索應用
集合視圖佈局遵循從右向左語言
還有一個例子
NSScrollView用了相同的概念
我們也轉換了滾動視圖中滾動條的位置
這將避免和應用的內容重疊
注意如果你在應用中使用頁面視圖
它的滾動條的工作方式略有不同
WebKit會查閱你的網頁內容
然後評估它的HTML屬性
然後基於此來確定滾動條的位置
例如我運行了Safari的英文版
我進入了英文版Apple.com
看看我的網頁內容
我會得到
方向的屬性被設置爲從左向右
我們把滾動條設置在右邊
如果我採用同樣的設置
但這次我進入了阿拉伯語版的Apple.com
看看它的內容
現在我的內容是阿拉伯語看看這兒的方向屬性
它被設置爲從右向左
現在我們轉換了滾動條的位置
這些是WebKit控制和AppKit控制的例子
現在我想談談API
我們在上一個例子上看到
WebKit控制和AppKit控制略有不同
在WebKit中我們提供了新的API
叫做userInterfaceDirectionPolicy
我剛纔提到過網頁的內容被設置爲默認值
但是如果你願意你可以改變這個值
例如 你的滾動條遵循系統語言
而不是網頁的內容
你可以使用系統而不是內容來改變它的值
下面讓我們談談AppKit API
首先簡述一下
如果你使用標準AppKit控制層你什麼也不用做
所有的工作都是自動完成的
現在你可能有特殊的設計
你想自己佈局你的視圖
我們強烈建議你使用StackViews和GridViews
GridViews是macOS新添加的
這些工具都非常強大
因爲它們在底層爲你建立自動佈局約束
它們也使用開頭和結尾約束
它會自動翻轉視圖
當你在從右向左環境下運行應用時
如果不使用StackViews或GridViews 就使用自動佈局
如果你對此感到很陌生前幾年關於這個有很棒的演講
今天下午還有一場演講
叫做自動佈局的最新進展去看看吧
最後如果你使用基類方法中的storyboards
我們也爲你做好了文本的翻轉
此外 在NSView中有一個API
讓你獲取和設置視圖的佈局方向
舉個例子 我有一個橫幅滑塊
它有兩個值 左和右
我想讓滑塊和本地化語言保持一致
這樣做是合理的左應該總是待在左邊
右應該總是待在右邊
這完全沒有問題 如果我設置
滑塊的佈局方向總是從左向右
我剛纔說過在NSView中有一個API
讓你能夠這樣做
默認值設置給NSApp.userInterfaceLayoutDirection
但是你可以重新設置爲左或者右
取決於你想怎樣設計視圖
現在談一下圖像
在剛纔的Joaquim的演示中
我們引入了方向圖像資源庫
它位於資源目錄中
在macOS中也有資源目錄
它們和iOS以同樣的方式工作
在這兒我就不詳細講解了
但是有時
在應用文件庫中沒有相應的圖像
而你想從遠端 例如服務器中得到相應的圖像
在NSImageRep中有一個API
讓你能夠實現這個功能用代碼註冊你的圖像
讓我舉個例子看看它是如何工作的
我剛纔說過
有時你的圖像儲存在另一個地方
你想註冊它們
首先你需要做的是創建從左向右圖像
通過使用NSImage API
有了圖像以後
你需要把佈局方向設置爲從左向右
對於從右向左圖像來說也是如此
但是這一次你需要使用NSImageRep API
當你有了兩個圖像以後
你需要註冊從右向左圖像展示
和從左向右圖像展示這可以通過使用其它展示API來實現
當你註冊了兩個圖像以後
在運行時加載正確的圖像就可以了
無論你運行應用
在從左向右還是從右向左環境下
最後
我們爲普通AppKit控制層設計了新的方便初始化工具
爲一個附件 例如它會設置...
對齊屬性和自動佈局屬性
完全正確無需你操心
對於NSButton
它會翻轉圖像 複選框的位置
單選按鈕的位置這一切都是自動進行的
現在我爲你們做個演示
來總結一下本次演講的內容
好
太酷了！我從Joaquim的演示中得到啓發 創造了一個記分牌的應用
當我們進行比賽的時候可以用它紀錄分數
這兒有一個簡單的...
應用 你可以在視圖控制器中看到它
這兒僅僅是一個表格視圖
我已經設置好了自動佈局約束
在表格視圖單元格中有一張圖片
一個文本域 一個下一個按鈕非常簡單
這兒我用StackViews
來佈局表格視圖單元格中的元素
我不需要關心設置自動佈局約束
因爲文本視圖已經爲我做好了
在底部
有一個標籤我可以在那兒更新最高分
和最好玩家很簡單
現在我需要做什麼呢？
我將模擬從右向左環境
這可以在我的應用上直接進行看看是什麼樣子
好 我要進入Scheme Editor
進入應用語言
選擇從右向左的假語言
而不是系統語言
我要重新編譯運行我的應用
現在正在編譯 好
你可以看到沒有寫一行代碼
僅通過使用storyboard、StackViews和自動佈局就實現了它的功能
就是這樣
現在我的應用在從右向左環境中看上去很好
下面我要做什麼呢？
我要回到我的代碼
並且...
我要運行我的應用 這一次
用系統語言而不是從右向左的假語言
這次要在英語環境中運行應用因爲系統語言是英語
現在再次運行我的應用
爲什麼我要這樣做我只是想向你展示
國際用戶界面的另一個功能
我的應用在英語中看起來也很棒
現在我要加入遊戲
我要先添加一個遊戲者
我要點擊這兒 添加新的遊戲者很有趣
我想用我的母語寫我的名字
繼續 修改鍵入的語言
使用阿拉伯語而不是英語
好 我用阿拉伯語鍵入我的名字...
好
我其實也很擅長猜國旗
我會在遊戲中取勝我不會浪費時間
現在我要更新我的分數
好的...
好 看看發生了什麼
僅僅是更新我的名字
我的標籤就徹底打亂了因爲它跳到了右面
現在標籤上是“ ！得了最高分12 Sara”
這看上去不對
下面
我要展示如何解決這個問題
你怎樣才能使文本方向正確呢？
讓我們回到幻燈片
剛纔我們在演示應用中看到了僅僅是用阿拉伯語輸入我的姓名
就打亂了文本的呈現
現在看看如何才能修復這個問題
在應用中呈現文本非常重要
無論你的應用是否支持某種語言的本地化都沒有關係
即使你的應用只支持英語
你的用戶仍然可以用其它語言閱讀和書寫內容
當涉及到文本的時候
重要的是要記住文本排列
和文本方向是兩個不同的概念
例如在這兒 有一段英文片段
它是右對齊排列 很好它看上去不錯
因爲你可能需要那樣設計
這沒有打亂文本的展示
同樣在這個例子中這一次是左對齊排列
但是我把書寫順序改爲從右向左
這就會打亂文本的呈現
在本例中你會看到感嘆號的位置不對
讓我們再展開一點
在我們所有的平臺中默認都是橫向對齊
如果你沒有更改它的值
在大多數情況下我們會得到正確的顯示
我們講講文本方向它更復雜一點
這兒我要簡要
介紹一下文本引擎的算法
如果你想了解更多的關於Unicode的算法
你可以查閱Unicode.org中的詳述
我們從最簡單的基礎開始
Unicode字符有三種類型
一種是嚴格從左向右字符
例如
我們所熟悉的有拉丁語、漢語或者日語
一種是嚴格的從右向左字符
例如阿拉伯語、希伯來語、波斯語或者烏爾都語
還有一些字符根本沒有方向
我們把這些稱爲中立或者非嚴格字符
例如 空格
文本引擎是如何決定
某個片段的方向性的？
文本引擎判斷首先出現的嚴格Unicode字符是什麼類型
就是這樣
如果是嚴格從右向左字符
整個章節就遵循從右向左方向
如果是嚴格從左向右字符
整個章節就遵循從左向右方向
讓我們舉個例子看看它是如何工作的
現在我把演示應用中的標籤單獨取出來
%@得了最高分
我不知道在運行時%@會被什麼代替
因爲用戶可以用鍵盤輸入任何字符
讓我們把問題變得簡單些
假如%@被拉丁名字代替
此處第一個字母是A
它是拉丁字母 嚴格從左向右字字符
因此章節的方向也是從左向右顯示正確
現在假如這個變量被阿拉伯名字代替
第一個嚴格字符是阿拉伯字符
使整個章節變成從右向左
這就是爲什麼文本的呈現被打亂了
這是錯誤的
那麼現在什麼是正確的顯示呢？
我希望文本這樣顯示即使我的名字是阿拉伯人名
我希望它在左面並且章節的其它部分
也從左向右顯示
所以最好的情形是這樣的
它能讀取變量並且把它隔離開
讓名字自己按照一定的方向排列
而不會影響章節的其它部分
用Isolates支持這是可能的
Isolates是最新的雙向Unicode字符
在Unicode 6.3中引入
並且在我們所有的平臺中的文本引擎都支持
我剛纔講過
Isolates允許部分文本隔離開
使首先出現的嚴格字符遵循一定的方向
而不影響周圍的文本
我高興告訴大家你不需要
自己插入字符就像具體問題具體分析
因爲如果你使用localizedStringWithFormat
它們能自動實現這個功能
因此localizedStringWithFormat會自動隔離%@
在運行時它會做出正確的選擇
現在 回到演示應用
僅僅通過一行代碼就能解決前面的問題
讓我們試一下
好 太酷了
現在我要回到這個視圖控制器
在這兒我更新了我的標籤
爲了節省時間
我已經寫好了代碼使用帶格式的本地化標準字符串
而不是用正常的字符串
我打算繼續給這個正常的字符串加上註釋符號
對於使用localizedStringWithFormat的一行則取消註釋
再次運行我的應用
看看問題是否解決了
好 正如你們看到的 問題解決了
現在我的名字在句子的左邊
我可以正確地讀出它
再看看對於英文名字是否起作用
看看 如果我把名字改爲Rana它起作用了
再看看阿拉伯名字 也沒問題
這就是我們的平臺的Isolates支持
讓我們回到幻燈片
好 總結一下
在本次演講中我們引入了方向圖像資源庫
現在它能更容易的支持不同的圖像
用於從左向右或者從右向左本地化設置
在iOS watchOS和macOS中我們爲你設計了新的API
自動佈局是非常友好的
如果你想佈局你的視圖或者支持其它語言的本地化
我們也改善了文本引擎
通過支持Isolates的Unicode字符
有了這些改進
作爲開發者的你能更容易的開發軟件 開拓新的市場
如果你需要更多的信息請參閱developer.apple.com
那兒有我們的演講謝謝你們的到來！
如果你錯過了一些演講那兒還有相關的演講
請查閱它們 它們很棒
祝你們度過愉快的一天
希望大家在WWDC餘下的演講中過得愉快 非常感謝！