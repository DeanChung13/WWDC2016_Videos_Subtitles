iOS安全的工作原理
謝謝
非常感謝大家參加下午4點關於安全的演講
我知道大家一天辛苦了不過真的要感謝各位的到來
我叫Ivan Krstic
我管理Apple的安全工程架構
這個團隊從基礎將安全
構建給所有用戶手中的產品
今天的重點是iOS
我非常自豪地告訴大家安全的作用在
這一平臺上扮演着關鍵設計理念的角色
在我們開始之前我們要先講一下背景
爲什麼安全對Apple如此重要
爲什麼我們相信這對用戶至關重要？
這是因爲我們的移動設備前所未有地記錄着我們的生活
有史以來從未有過一種東西會對我們如此瞭解
瞭解我們的消費方式
瞭解我們發送的郵件我們拍下的照片
瞭解我們的消息
從最簡單的問好到最親密的對話
當今的移動設備前所未有地記錄着我們的生活
當你這樣考慮 你會發現
保護所有這些信息的安全
這不僅僅是技術上的問題
對我們來說是一項任務
這項任務的中心在於保護
我們用戶的個人數字主權
而且當你這樣考慮你還會發現
攻擊者的定義也發生了改變
現今的攻擊者可能會想要持有你的數據並進行勒索
他們可能是不良的商業競爭對手 想要佔得優勢
他們可能是網絡服務提供商
想要不可磨滅地標記出你的在線活動
在未徵求你同意的情況下進行跟蹤和廣告宣傳
這可能是國家
像是2014年SonyPictures的黑客入侵
有時候好奇心也會讓和我們親近的人受到侵害
攻擊者會是誰
當然 還有我們一定不能低估
高等貓科動物所帶來的威脅
謝謝
所以當你想想這些攻擊者
他們想要什麼？
我們發現這些動機通常會在這三個組中
有個人跟蹤和監視
嘗試獲取你的照片和消息
使用你的相機和麥克風
還有商業間諜
獲取你的商業郵件和文件
還有你的知識產權
攻擊者想要什麼？
最後這裏有直接經濟好處將金錢直接
從你的網上銀行業務交易中盜走或者植入廣告
以及在你瀏覽網頁的時候進行點擊欺詐
爲了做到這些事攻擊者創建了
廣告軟件 間諜軟件 勒索軟件
遠程訪問木馬以及多種多樣的惡意軟件
我們怎麼會知道？
因爲我們在其他平臺上見到過
但iOS上面沒有
iOS上市將近10年之久
還沒有出現一種iOS的惡意軟件
大範圍地影響我們的用戶
這是因爲大約在10年前Apple就意識到
移動設備會在用戶的生活中發揮着何種作用
我們意識到現存的安全技術
是遠遠不夠的並且無法勝任這些挑戰
所以我們決定構建出我們所能設想的最佳安全技術
來保護我們的客戶並且規模大得驚人
我們所保護的用戶
在全球範圍內擁有10億多激活的iOS設備
而且我們的每一項安全功能
都會真正地保護用戶免遭威脅
IOS安全支柱
但我們並不孤單
在iOS安全中有三個關鍵支柱
有平臺安全我們將這類技術
構建於我們的軟件和硬件之中
有用戶將他們的軟件升級到最新最安全的版本
然後有像各位這樣的開發者
使用我們的安全技術構建安全的應用
我們今天要談談這三個支柱
我們從平臺安全開始
當你想想之前安全的運作方式尤其在企業設置中
那是一長串的複雜內容
用戶必須要遵守才能保證安全
在設備上加載安全配置
複雜的批量管理方案複雜的密碼策略
非常困難 非常笨重用戶根本無法成功
而且很難實現安全
但因爲Apple擁有所有的硬件和軟件
我們能夠以一種獨特又創新的方式解決這一問題
當你審視iOS安全
我們將安全直接構建在硅片上
在默認情況下 我們讓設備在出廠時就是安全的
我們讓用戶非常容易地升級
並運行最新最安全的版本
我們讓用戶非常容易地使用Touch ID來安全登入設備
我們監管App Store而且我們讓安全易於使用
iOS平臺安全包括大量的功能
而今天我只有時間強調五項功能
我們從安全引導開始
安全引導
能夠信任一個設備的最重要
方式之一就是信任上面運行的軟件
我們的做法是
在硅片內部構建信任
每個iOS設備內部的Apple設計系統芯片都持有
Apple公開密鑰 位於一個叫做Boot ROM的只讀存儲區域中
在出廠前就已寫上並且之後無法改變
當你的iOS設備啓動時
我們會用那個公開密鑰
然後Boot ROM會在引導鏈中驗證下一步
也就是低級引導加載程序
而且只有通過了那個驗證我們纔會進入到鏈中的下一步
我們會重複該過程直到iOS設備完全開啓
這讓我們確定引導中使用的軟件
的每一部分都簽有Apple的私人密鑰
信任安全引導
當你想想安全引導
非常有趣的是我們不依靠
任何第三方來實現安全引導信任
我們不依賴我們控制之外的證書權威機構
用於安全引導的密鑰是由Apple生成 管理和提供的
用於驗證的代碼
剛纔給你們展示了也是Apple編寫的
只有Apple擁有給所有軟件簽名所需的私人密鑰
但這裏還有另一件有趣的事 那就是
當iOS設備去升級軟件版本時
它必須聯繫我們的安裝授權服務器
並請求許可來升級到指定的版本
做法是將升級版本的加密測量
發送給服務器然後詢問是否可以升級
我們這麼做是因爲現在服務器能夠
防止iOS設備遷移到更舊更不安全的iOS版本
所以當你將這兩者放在一起你會得到一個強大可靠的機制
依靠每個iOS設備上所運行的軟件
舊版iOS無法從一個設備複製到另一個設備上
該過程的軟件完整性是無法篡改的
現在我們談談保護用戶的靜態數據
數據保護
如果你非常認真對待這件事
你不要將保護用戶數據的加密密鑰
用在應用處理器中
或是設備中的普通處理器
這是因爲那裏的攻擊面實在是太大了
如果真的想保護用戶的靜態數據
你要構建專門的硅片來持有這些加密密鑰
我們就這樣做的
我們稱之爲Secure Enclave
當你在想密碼的時候
通常它們很短4到6位數
如果攻擊者設法將加密的數據從手機中取走
從iOS設備中取走
並嘗試所有可能的密碼
這不會花多長時間
所以取而代之我們從用戶的密碼中衍生出一個密鑰
僅用於Secure Enclave的硬件密鑰相掛鉤
這意味着無法在離線狀態下猜測出密碼
密碼猜測必須要在設備上進行
而且設備可以自由限制嘗試的次數
事實上 這就是你iOS設備的工作原理
在幾次錯誤密碼嘗試之後我們會實行時間延遲
但在10次錯誤密碼嘗試之後
Secure Enclave將不會再次解鎖那個設備
這與清除數據功能沒有任何關係
當啓用時
數據會在10次錯誤密碼嘗試之後被清除掉
即使你沒開這項功能
一旦出現10次錯誤密碼嘗試
Secure Enclave將不會再解鎖那個設備
無論你等多長時間
所以我們使用行業標準算法來構建系統
我們對其進行嚴格的內部安全審查
以及第三方代碼審覈
之後我們還會再進一步
我們將我們核心加密庫
用於支持數據保護而且我們將它們發佈到網上
供所有人下載檢查
我們談談沙盒
沙盒
沙盒是一種在應用之間隔離數據的方法
這是因爲即使意圖是好的
開發者有時還是會犯錯
沙盒這種方法可以減輕由那些錯誤帶來的潛在危害
這有點像汽車中的氣囊或安全帶
能夠減輕事故中受傷的風險
我們還使用沙盒來將一些有關安全的
選擇直接交到用戶的手裏
我們有一個叫做TCC的機制透明 同意 控制
我們可以詢問用戶問他們是否信任指定的應用
並將一些敏感數據交給它們例如地點 照片和聯繫人
一旦用戶在這樣的對話中下了決定
沙盒機制和內核就會執行那個決定
代碼簽名
我們平臺安全的另一個關鍵因素就是代碼簽名
當攻擊者嘗試攻擊設備時
第一步就是嘗試讓他們的惡意代碼運行起來
因此 iOS代碼簽名不僅是涵蓋操作系統
它還涵蓋設備上運行的每個應用
事實上 當你將應用上傳到App Store上面的時候
Xcode會計算每個可執行文件的密碼散列
和應用捆綁包中資源的密碼散列
並且會將它們和應用一同寫入代碼目錄
之後再送到App Store
當用戶下載應用並運行它
我們的內核會查看每個可執行的存儲頁面
然後和代碼目錄進行對比 來確保
其未被篡改過
結果 攻擊者無法將一些惡意代碼
植入到存儲中並將控制流轉移過去
反而 他們必須依靠於更加複雜的
更加困難的方案來運行他們的惡意代碼
Touch ID
我們談談Touch ID
每天平均80次用戶解鎖
我們知道我們的iPhone用戶每天平均解鎖手機80次
如果你設置了密碼這就會給那80次解鎖帶來麻煩
結果
幾乎過半的用戶沒有設置密碼
我們知道因爲密碼可以說是用於保護
用戶靜態數據的關鍵部分所以這個問題我們必須要解決
我們需一個解決方案
要簡單
要快速
並能爲用戶的數據提供極好的保護
我們解決方案是Touch ID
不過我們不僅是將指紋傳感器放入手機中
你可以更改密碼
但你無法更改你的生物特徵屬性
你無法改變你的指紋
所以我們知道
我們必須提供生物特徵數據這是我們能構建的
最高級別保護
所以我們做的是將指紋傳感器直接連接
到Secure Enclave通過一個加密鏈接
而且我們使得當你的手指觸摸到傳感器時
指紋會直接傳輸到Secure Enclave
在那裏進行處理然後加密
而應用處理器無法獲取指紋
應用處理器運行手機上的正常應用
我剛纔提過在Touch ID推出之前
大約一半的用戶設置了密碼
Touch ID之前的密碼使用率
現在九成人用密碼
Touch ID之後的密碼使用率
這精彩地示範了Apple的驚人之處
我們將硬件工程專業技術
軟件工程專業技術
對易於使用的投入
將它們組合在一起使得普通用戶
不關心指紋傳感器
不關心Secure Enclave或是散列函數
他們得到的是數據安全的驚人提升
用戶升級軟件
iOS安全的第二個支柱
是用戶升級軟件
最新版的iOS總會是最安全的
並且我們持續讓iOS變得更加安全
基於現在見過的威脅和未來預見到的威脅
而且我們構建所有深層的技術
來信任在我們硬件上運行的軟件
但iOS版本無論多麼安全
如果人們不去安裝最新的版本 這都是沒意義的
最安全的那個版本
所以當我們考慮軟件升級時
這不僅有關於那個設備和其運行的軟件
這還關於我們與運營商的關係
以及我們快速發佈升級的能力
還有用戶體驗
用戶如何看待設備上的升級
我們在iOS 9中做的一件事是我們極大縮小了
安裝升級所佔用的空間量
這樣擁有較小剩餘空間的用戶還是可以獲取最新
最安全的軟件版本
更小的安裝佔用空間
之後我們着眼於用戶體驗
然後說 有時候用戶不想因爲升級而被中斷
所以我們讓他們選擇是立刻安裝升級
或是在晚上安裝
當他們可能沒在使用手機的時候
或者第二天提醒
得出的結果很驚人
將近85%的客戶在運行最新的iOS版本
我們最安全的版本
如果你認爲這很簡單沒什麼大不了的
你只需去看看其他的平臺
Android安裝基數
順便一說這個比較很公平
因爲Android 6和iOS 9的發佈時間只相差幾個周
準確來說一下
在Android 5.1.1版之前每個版本都有一個漏洞
叫做Stagefright這會被遠程利用
你利用它的方法可以是將一個專門製作的消息發送給
一個有漏洞的設備然後獲得對那個設備的完全控制
Google很快修復了這個錯誤
但這沒有任何意義 因爲他們的大多數用戶沒有安裝補丁
而沒有安裝補丁是沒有任何作用的
這就是爲何我們投入如此多精力不僅是構建安全的iOS版本
而且還讓用戶能容易獲取最新最安全的版本
iOS安全中的第三個支柱
就是各位開發者
使用我們提供的安全技術來打造安全的應用
開發者打造安全應用
遵循最佳做法
這意味着遵循平臺上的最佳做法
我們有數量驚人的應用使用Touch ID API
讓用戶免於記住複雜的密碼
然後再直接輸入到應用中
去年 我們推出了一項新功能叫做App Transport Security
爲應用的信息提供強大的保護
隨着信息通過網絡傳輸到應用的服務器上
今天我很自豪地說在2016年的年底
App Transport Security將成爲App Store應用的一個必要條件
這意味着到了2016年底
當你的應用和你自己服務器的後端進行通信時
它們必須使用安全的TLS信道使用TLS 1.2
除非通信中的數據是批量數據
例如流媒體和已加密的數據
這會將真真正正的安全提供給我們的用戶
以及你應用在網絡上的通信
各位開發者還要承擔另一部分責任
當你構建應用的時候
這就是要清楚你的代碼這不僅是你編寫的代碼
還有你在應用中加入的任何第三方代碼
清楚你的代碼
這是因爲你使用的庫可能會破壞你應用的安全
可能因爲他們在背地裏做一些你不知情的事
但可能
因爲這裏有一個更新更安全的版本
這裏有一個很好的例子
有一個非常知名的第三方網絡庫
在TLS連接的安全驗證上出現了重大漏洞
這個漏洞很快就被修復了
但在一段時間裏 App Store中有多達25,000個應用
不是最新最安全的版本
所以從可靠位置獲取第三方代碼是十分重要的
你要清楚它的功能並且要保持更新
所以這些就是我們iOS安全中的三個關鍵支柱
平臺安全
這是最佳的安全技術機制
我們可以將其構建在我們的硬件和軟件之中
我們的用戶下載最新最安全的iOS版本
以及各位開發者使用我們的安全技術
來打造安全應用
我們的成果如何？
這個問題問得非常好那我們的成果如何？
iOS安全有多好？
安全的有趣之處在於因爲和性能不同
你無法直接測量
你無法進行測試 看看得出一個客觀的答案會花多長時間
所以剩下的就是間接指標
今天我會和大家分享三點
沒大範圍iOS惡意軟件
第一個是自推出後的十年時間裏
還沒有任何一種iOS惡意軟件大範圍影響我們的用戶
這一點對我們最爲重要
我們的用戶在將近10年時間裏得到了無微不至的保護
下一個間接指標很有意思
就是看看一些放出的不受限的越獄工具
這些越獄工具擊敗了iOS安全機制
有意思的地方是我們看到的最新版本
經常需要找到並鏈接起
5到10個截然不同的漏洞纔能夠
擊敗平臺安全機制
這比其他任何平臺都要高得多
原因是iOS安全措施是步調緊密地共同發揮作用
這樣擊敗所有的措施會花上很長時間和大量工夫
我的最後一個間接指標
我希望各位半信半疑地聽一下
可能在座的大多數人已經知道那就是軟件漏洞黑市
時不時地 一些價格
會在黑市上變得透明
通常這些價格是幾萬美元
有時候是十萬美元
但在2013年紐約時報獲悉
一個iOS漏洞價值五十萬美元
去年 福布斯採訪了一名越獄工具開發者
那個人說大多數專家一致認爲一款無限制的iOS越獄工具
的黑市價格是一百萬美元
一百萬美元
各位半信半疑地聽不過這個數字真的非常驚人
接下來我們應該怎麼做？
很明顯安全是過程而並非終點
在iOS安全上我們還會繼續努力 永遠不會停歇
這也不是我們最近才感興趣的事
你現在看到的是我們10年的結晶
爲保護用戶所做出的最傑出工作
但是壞人不會善罷甘休
而我們會不斷髮展我們的安全
來擊敗現在以及將來的威脅
我們會利用我們硬件和軟件的專業技術
我們會構建出我們所能設想的最好安全技術
來保護我們的客戶 和他們現在使用移動設備的方式
以及將來使用的方式
並保護我們的客戶不受現在和將來的攻擊者的侵害
哪怕是貓
非常感謝
如果你想了解更多信息
我邀請你去閱讀iOS安全指南
其中有關於這些強大功能的大量技術細節
我剛纔講過的還包括我沒時間講的
例如iCloud Keychain和雙因素認證
在此次會議的網站上會有一個鏈接
再次感謝大家