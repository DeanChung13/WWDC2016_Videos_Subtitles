通過主動建議增加應用使用
大家好
感謝大家到場與我們共度週五的下午
希望你在WWDC度過精彩的一週
我現在對這次演講感到十分興奮
因爲我們將討論的東西我認爲是大家都想要的
從根本講大家都在這裏
是因爲你們喜歡打造優質的應用
而且你可能想有更多的用戶使用那些優質的應用
好消息是我們想研究出機會
讓你的應用在恰當的時候提供給我們的客戶
這樣你會得到更多的參與
我們將在這整場的演講中討論
你可以那麼做的不同方法
現今我們在整個操作系統上以各種形式推薦應用
在許多不同地方
我們的客戶可以使用Siri應用建議
當他們從主屏幕向左滑動以及調用搜索的時候
甚至在輸入查詢之後
你可以在其他第三方應用內部得到結果
Handoff是我們宣傳第三方應用和你的應用的另一種方式
隨着你從一個設備上開始活動然後轉移到下一個
我們試着預測你將要做的事情
然後在屏幕的左下角提供那個應用的圖標
在某些情況下當我們認爲你非常想做的
是播放一種媒體
我們會將你的應用內容推薦到設備的鎖屏上
比如在你插入耳機或者Bluetooth配對
到你的車或者音響之後
如果有一款應用是你在那種情況下經常使用的
系統會得知
而且不僅提供那款應用還有應用的內容
我們今天將談談如何能夠構建精彩的體驗
爲那種環境
在你使用操作系統時例如閱讀新聞文章
你可以創建提醒
與你所看的內容有前後關聯
例如 如果你在讀一篇文章
然後你想再看一眼或回家再讀
因爲你正在觀看WWDC展示
你可以調出Siri
當你說“提醒我這件事”時Siri會理解你的意思
它會有當前在屏幕顯示的前後關聯
這會在任何應用上奏效只要採用一些API
今天晚些時候我們會討論
大家會對此感到尤爲興奮因爲這意味着
當客戶打開Reminders應用時
他們可以瞬間回到你的內容上
iOS 10上新出現的是整個系統上的地點推薦
當我們認爲客戶有某種意圖
想去某個地方或者使用一個地點時
是他們最近看過的
我們過會將談談如何讓你應用的數據
在整個系統中流動
Multitasking也是另一種界面
我們會將我們認爲客戶會感興趣的地點推薦給他們
你可以將你的應用圖標推薦在上面
在多任務UI的醒目位置上
同樣是iOS 10中的新功能就是我們將
你應用的聯繫方式推薦到原生聯繫人應用的內部
這裏你會注意到在WhatsApp中發現了一個句柄
我們過會將談談如果能夠讓你的應用內容
進入那個界面
所以...
要得知何時推薦操作系統需要學習
你的數據和應用
好消息是幾個簡單的API就會將
更大價值提供給你比我之前說的要更多
除了將你的應用在各種時刻推薦
你還會得到更深的Siri整合就像我說的
前後關聯提醒那樣
所以今天我們要做的是談談這些API
並且我們會講解如何恰當採用它們
這樣你們都會得到用戶更多的參與
藉助在整個OS上的推薦
首先我們將談談NSUserActivity和schema.org
NSUserActivity這種API相當於操作系統的眼睛
它幫助我們瞭解客戶當前在屏幕上所看的內容
而schema.org在網頁上有相同的作用
接下來 我們將談談一些新的改進
和新的API圍繞那些處理地點的應用
如果你的應用像Yelp那是一個目錄
提供很多不同地點或者相反 如果你的應用像Uber
要接收地點那這就與你非常相關了
之後我們會談談構建精彩的體驗
圍繞媒體應用建議
我之前展示了一個例子是一類內容推薦
在客戶插入耳機之後就會發生
我們會談談如何讓你的內容
在界面最突出位置顯示
之後我們會概述今天會學到的所有內容
先從NSUserActivity和schema.org開始
我想邀請Sofiane上臺Sofiane？
謝了 Daniel大家下午好
我叫Sofiane 今天我非常激動地在這裏跟大家談談
我們最近在研究的一些功能
我們剛聽過Daniel說過的在整個系統中
推薦應用內容的好方法
現在我們來談談一些API你能採用它們來實現這一目的
在整個展示中我們會談談功能
一些你可能已經熟悉了像是Handoff
或者Spotlight搜索還有一些在iOS 10中推出的新功能
例如 地點建議
你在這裏看到的所有功能
都有共同點
那就是單個API叫做NSUserActivity
首先 一些背景知識
NSUserActivity是iOS 8中推出的支持Handoff
這是非常神奇的功能允許你在一個設備上
開始一項活動 然後轉到另一個設備上繼續你之前的活動
去年在iOS 9中 我們支持將內容直接從
NSUserActivity推薦到Spotlight搜索結果裏
在iOS 10中我們進一步增強了NSUserActivities
它可以捕捉在你應用內部查看過的地點
並在整個系統中的多個位置推薦它們
甚至在其他應用中
現在NSUserActivity還將前後關聯信息提供給Siri
這樣Siri能幫助你獲取方向或者呼叫
你在應用中查看的地點
同樣新出現於iOS 10
NSUserActivity允許你的通信應用
直接從聯繫人卡片中推薦
作爲替代通信方式
我知道大家在想什麼“這太酷了” 但願吧
“但工作原理是什麼？”
我來告訴大家這是非常簡單明瞭的
我們有很多精彩內容要說所以直入主題吧
我們將談談NSUserActivity和schema.org
這些API允許你無縫地與系統整合
NSUserActivity用於原生應用而schema.org是用於網頁的
我們首先專注於NSUserActivity
NSUserActivity是輕量級界面 能捕獲應用程序的狀態
在用戶瀏覽你應用的過程中這還可以在之後還原
所以例如 這裏我們有Yelp應用
這是一款本地搜索應用隨着用戶瀏覽應用
創建NSUserActivity捕獲我們需要的信息
之後重現這個狀態
例如 當我觸發餐廳搜索時
我們遵循創建活動的相同模式
當我從那個列表中查看結果時
在這個特定案例中我們在查看一個地點
在iOS 10中NSUserActivity現在
更加了解特定概念 例如地點或者通信互動
我們很快就會講的不過之前我想
仔細看看這個屏幕
這裏我們創建了活動並用信息來描述它
來之後重現這個狀態以及已提交的數據
例如 地點名稱或者地址
之後我們通知系統這代表了
當前用戶狀態 我們決定它是否會宣傳用於Handoff
在整個系統中臨時可用於地點建議
或添加到設備索引...
或添加到設備索引上的Spotlight這樣它會出現在
Spotlight搜索結果中
這裏有一些相關會議關於這個話題的
尤其是採用NSUserActivities
用於Handoff和應用搜索
我推薦大家去看一下那裏的內容十分精彩
現在我們深入到代碼 好吧？
我將給你展示如何創建這些活動
我們在此簡化NSUserActivity的實例
並提供一個活動類型
那是你提供的字符串
這和你在info.plist中指定的字符串相同
我們推薦使用反向DNS樣式符號
保持字符串的特殊性
接下來 我們的活動需要標題而且我們使用的標題
會描述我們在這裏看的內容
這裏我們看到了餐廳
要記住的事情是
這是你的用戶活動的公衆形象
例如 這就是
其在Spotlight搜索結果中的樣子
你要確保你使用的標題有說明性並且有含義
下面 我們啓用Handoff應用搜索以及公共索引
因爲我們查看的內容是公開的
之後我們在userInfo屬性上設置一個字典
捕獲我們需要用來重現狀態的信息
當活動還原時
那種情況下 我們使用剛纔所查看的地點的唯一ID
通常當活動被還原時
例如 當傳遞給了另一個設備
你可以從服務器取回那個ID然後還原那個地點
如用戶期待那樣
爲了全面地描述你的活動並得出更豐富的搜索結果
你可以使用這個類
我們在iOS 9中推出叫做CSSearchableItemAttributeSet
它在你的應用和系統之間提供了共同語言
來更好地描述你的內容
如果你的網站映射的內容
是你在應用內查看的
可以提供網頁URL這樣當你的活動
例如被傳遞給一個未安裝有你應用的設備上
這會順着那個鏈接在Safari中恰當啓動
最後我們在活動上調用becomeCurrent
告訴系統
這代表了當前用戶狀態
這是用戶在屏幕上看到的東西
當你的應用啓動後會發生什麼？
例如 當你的活動被還原了
或者傳遞給另一個設備
你的應用程序啓動了這很好
然後調用UIApplication委託方法
叫做continueUserActivityrestorationHandler
我們首先要做的是檢查活動類型
然後確保它匹配我們所預料的那個
那個案例與我們之前使用的那個匹配
之後我們可以使用用戶輸入字典
來開始還原狀態
之前 我們放入了那個地點的唯一ID
通常在這裏我們能將其從服務器取回來
然後還原它並顯示正確的控制器
如用戶所期待那樣
所以使用最少的代碼
我們能夠從三大功能中獲益
Handoff Spotlight搜索及前後關聯Siri提醒
現在我們談談下面列出的其他功能
不過我先問大家一下
你是否遇到這樣情況你肚子餓了
想找到好的餐廳就餐？
所以你從Yelp開始然後找到完美的地點
之後你要跟朋友發消息讓他們在那裏見你
所以你切換到消息 開始輸入“夥計們 我找到地兒了”
不過你發現你沒有那個地方的地址
所以你切換到Yelp
你複製地址之後切換回消息
粘貼進入之後你終於完成了
然而並不是 因爲你還需要在某個時刻到達那裏
你切換出地圖
這可能來來回回很多次
你懂我的意思非常不好的體驗
所以在iOS 10 我們嘗試將這個體驗變得更加容易
你的起點還是一樣
你在應用中查看一個地點比如說一家餐廳
通過採用NSUserActivity
你的應用可以將那個相同地點
推薦到整個系統上的許多不同位置
當你從應用中切換走多任務UI會使其非常簡單
並在底部提供這個精緻的主動建議
使用你最喜愛的路徑規劃應用來提供方向
到你剛纔查看的地點
如果你進入Messages不需要來回操作
你可以開始寫像是“見面地點是...”
然後QuickType UI會自動將那個位置
直接推薦到QuickType來自你剛纔提供的內容
在Maps上亦然
Maps在Maps應用中直接推薦這些地點
不僅是在Maps應用中
還在新的Today View地圖小部件中
以及CarPlay中這是我最喜歡的功能
想象一下
查看應用 進入車中點擊屏幕
就好了 完成了你可以出發了
這些地點甚至可以推薦到其他應用中
所以我們在這裏看的是由Yelp提供的一個地點
通過NSUserActivity顯示在Uber應用內部
隨着用戶點入目的地文本域
這還給Siri提供前後關聯所以你可以查看你的應用
然後詢問Siri來獲取方向或者給
你查看的地點打電話
採用NSUserActivity會得到所有這些功能
而且所有這些功能都有共同點
就是它們都表示
建議最初是源自哪裏
這個案例中是Yelp
想象一下如果這是你的應用那不就太好了嗎？
現在這是可能的
NSUserActivity允許你這樣做 通過捕獲在你的
應用中查看過的地點
我們推出新的簡單API
在MapKit和CoreSpotlight上允許你那樣做
並整合到我剛談過的所有位置
在代碼方面 我們將創建一個NSUserActivity
並且重新使用相同的
我們之前定義的活動直接添加在上面
我們不需要創建單獨活動
對於使用MapKit的應用其簡單程度
相當於將MKMapItem設置到這個新的MapItem屬性
定義爲NSUserActivity
這基本上就行了
這還有很好的附加作用
自動填充內容屬性集所以你不用...
所以如果你想採用應用搜索
你要做的就是指定你想選擇性加入應用搜索
然後這些網站也會編入索引
這裏還有另一種方式那就是通過採用應用搜索
對於那些已經熟悉它的人
你能使用CSSearchableItemAttributeSet並描述地點
我們將它分解一下
我們首先做的是設置地點的名稱
這與我們查看的相匹配
這是我們之前講的全部UI所需要的
接下來 我們指定地址的文本表示
這是全部基於文本UI所需要的
例如像是鍵盤
接下來 我們指定維度和經度
這是可選的 但這會保證將你的用戶精確地指引到
你想將他們指引到的位置
經度和緯度是最精確的表示
供你使用如果你有這個信息的話
接下來 我們設置電話號碼這允許我們訪問Siri
這樣我們可以說比如“呼叫這個地方”
最後 我們表明
這個內容支持導航和電話呼叫
這樣結果將會呈現在Spotlight UI中
在Spotlight搜索結果UI中
有一個快速行動圖標進行電話呼叫
或者例如獲取方向
這就是如何得到地點建議的就是這麼簡單
你的應用將會推薦到所有這些不同地方
我們認爲這會提供更加飽滿的體驗
在你應用的內外都是如此
你的品牌可以進一步在整個系統中推薦
不僅限於你的應用之內
我們來談談聯繫人交互
IOS 10 DP從聯繫人卡片
直接整合通信應用
你在這裏看到的是一個聯繫人卡片
這裏獲知了WhatsApp的句柄並顯示出來
當我去點擊頂部的快速行動按鈕
來發送消息 我要選擇我想使用的聯繫方式
如果我這麼做了 這個選擇會被記住並持久保留
爲默認的通信方式
這樣你的應用會在推薦到那裏作爲默認的通道
給那特定的聯繫人發消息
這也由NSUserActivity所支持 還有新的密集框架
這與爲得到深層Siri整合所使用的框架相同
本週前幾天有兩場關於這個話題的精彩演講
我非常推薦大家去看看
這裏顯示的是WhatsApp應用
在發送文本消息我們將探討它的工作原理
首先我們創建INInteraction對象
這是我們在密集API中定義的新對象
這包含了關於意圖的信息
例如 這代表用戶行動
比如發送文本消息或者進行視頻通話
以及其他一些關於接收方和發送方的信息
還有創建內容的元數據
例如像是通信是否成功
接下來 你在交互上調用Donate Method
這樣系統會得知這次交互
並將你的應用直接在聯繫人卡片內部推薦
當用戶通過聯繫人卡片與你的應用進行交互
我們也遵循相同的模式
創建INInteraction表示用戶嘗試做的事情
包在NSUserActivity內之後你的應用會用它來啓動
我們看看這是如何轉換到代碼中的
首先在這裏我們創建發送方和接收方
要注意的是如果你的應用可以訪問
用戶的通訊簿
你可以指定你在這裏使用的聯繫人標識符
這樣系統能夠更好地找出
需要擴增的正確聯繫人
接下來 我們創建意圖
這裏我們使用INSendMessageIntent
因爲我們發送文本消息
這裏你可以使用三種通信意圖
用於發送文本消息進行音頻和視頻通話
要重點注意的是你還要保證你指定出
你的應用在info.plist中能夠處理的意圖
這與活動類型相比幾乎一樣
我們之前談過了
接着提供我們所使用的服務名稱
這裏我們在使用WhatsApp
如果你的應用處理多個協議那這會特別有用
例如如果你有多客戶端聊天應用
比如說與Jabber和ICQ有關
你要確保你使用正確的服務名稱
接下來 我們創建INInteraction對象
這會捕獲我們之前創建的所有信息
以及一些元數據包括通信的方向性等等
因爲我們在這裏發送文本消息
我們使用外送方向
這是唯一支持的交互捐送方向
最後 我們將這個交互捐送給系統
這樣它會...系統能夠
增強與你通信的聯繫人
我說過了當用戶從聯繫人卡片
與你的應用交互我們遵循相同的模式
並使用相同的UI應用程序委託方法來啓動你的應用
我們首先在這裏做的是從NSUserActivity
檢查意圖和交互
之後我們可以開始與預期接收方進行通信
這就是如何得到聯繫人交互
你的應用可以在聯繫人卡片上直接推薦
這是最自然的通信方式
成功了我們講完了列表中的一切
但還沒完我們還要講點別的
我們來談談一些最佳實踐你要牢記在心
使用NSUserActivity時
首先就是要懶對 這纔是重點
假設你在研發一款郵件客戶端
你想採用Handoff這樣你的用戶能夠
先在Mac上面開始寫郵件然後在手機上
外出時 接着在iPhone上之前的地方繼續寫下去
這裏我們做的是我們有一個方法
在每次按下鍵盤上的按鍵時就調用這個方法
而且每次我們都計算並更新userInfo字典
這會消耗巨大並且效率低下
相反你應該做的是使用needsSave屬性
告訴系統這個活動是髒的
這樣系統能夠在適合時間
呼叫你來更新你的userInfo目錄
例如將活動傳遞到另一個設備之前
這裏我們是這樣做的我們在實施
updateUserActivityState委託方法
這是我們更新userInfo字典的機會
這樣我們可以只做一次而且效率更加的高
接下來 確定你保留當前活動的強引用
我們在這裏做的是減輕NSUserActivity
在上面做一些東西調用becomeCurrent
這很好 不過之後
我們沒有保留強引用並推出了函數
因此 活動被釋放了因爲走出範圍了
活動釋放不會是當前的因爲它不存在
相反 你應該做的是保留當前
活動的強引用
若這涉及到UIViewControllers
或者任何符合UI響應器的東西
還可以使用用戶活動定義...
用戶活動屬性定義在UI響應器上
這有極佳的效果
讓UIKit爲你管理活動的當前性
你不必調用becomeCurrent或使其無效
UIKit會爲你做到當視圖控制器
比如說鏈接到了視圖層級
接下來傳送少量有效負載
確保你只保留足夠的信息
在userInfo字典中來重現狀態 僅這些而已
記住這些用戶信息和活動是通過
Bluetooth發送的 這就是爲什麼要儘可能保持輕量級
例如 假設你研發的應用要處理大型照片
從網絡上下載的
所以我們在這裏做的是下載這些照片
將其序列化爲數據 然後將它們放入userInfo字典
這很容易就會達到幾MB效率低下
相反 你可以做的是保留獨特標識符
指向你所從事的內容例如 網頁URL
這樣當你還原活動時
你可以將其從服務器取回或者通過其他方法獲取
如果你真的要處理大量有效負載
你可以使用延續流
它們專門設計用於該目的
在開發者資料中有大量相關的信息
好了 還有一個
一定要保持你的活動類型唯一併且有描述性
這是爲了避免衝突
但重要的是它們還要代表當前用戶活動
或者當前用戶行動
所以這裏不使用單個活動類型
是我用在應用內部各處的
更好的是使用多個活動類型來描述應用的不同部分
例如一個是當我查看地點
一個是當我搜索地點
你會在這裏發現我使用反向DNS樣式符號
這確保了不會與其他活動類型相沖突
那些類型可能是在其他應用內部定義的
好了 現在該演示了
將使用ProactiveToolbox應用
這是我們在DeveloperLibrary中供大家使用的樣例
我們看看如何採用NSUserActivity推薦地點
我們還會簡短講講Handoff以及應用搜索
我們開始吧
好 我將在此啓動ProactiveToolbox應用
左邊是我運行iOS 10的設備然後Xcode就在後面
我先給大家快速瀏覽一下這個應用
讓你知道它的作用
這裏我們有披薩店的列表
這是搜索本地披薩店的應用
然後使用Core Location來獲取我的當前位置
以及用MapKit來獲取符合披薩條件的地點
我來看看這第一個
我得到更豐富的頁面有更多詳細信息
像是名稱 電話號碼 地址網站 以及該地點的地圖
現在我們將研究如何能實施位置推薦
這樣相同的位置會推薦到很多不同地方
不過之前我們先這麼做
我要計時怎麼樣？
看看這麼做要多長時間
我啓動計時器這就開始
好了 我現在進入Xcode
這是我的地點查看控制器這個控制
是我用來顯示更豐富的結果
更豐富的披薩店結果
每當地圖項目在我的應用中更新時 我就會調用這個方法
我將這個拖放到這裏
我在此創建NSUserActivity
如你所見我在創建活動 提供給它
活動類型 代表着我所做的事情的含義
在這個案例中我還使用反向DNS樣式符號
這確保我的活動類型是唯一的
我之前已經在info.plist中定義了這個活動類型
接下來我們設置標題和關鍵詞
我這裏還是使用有含義的標題
因爲這將是用戶活動的公開形象
接下來 我設置Handoff應用搜索以及公共索引
因爲我們在這裏看的內容是公開的
更重要的部分是這個
我在活動內部設置mapItem
這個是有附加作用的能爲我們
填充contentAttributeSets
我在這裏就那麼做的我的完成方法是通過表示
這個內容支持導航和電話呼叫
這樣它會有正確的圖標出現在Spotlight搜索結果中
還記得要懶嗎？在這裏我就是這樣
設置needsSave爲真以及委託方法
這樣就會調用userActivity委託
當我需要更新userInfo字典時
最後我使用userActivity屬性
它是由UIViewController內的UI Responder所定義
然後設置上活動這樣我能保留強引用
而且UIKit會替我自動管理它
接下來 我將實施這個UI...這個用戶活動委託方法
updateUserActivityState
在這裏我將更新我的userInfo字典
通過我在下面這個方法內定義的內容
這會返回字典的信息
相關的信息我之後要用它們重現這個狀態
我們繼續 構建並運行
好了 這就是相同的地點
我沒有破壞什麼東西沒有出現變化
我將雙擊Home鍵
現在你能看到這在底部出現了
這個橫幅 來獲取到我剛纔所看地點的方向
非常簡單 超級方便
打開Maps也是一樣
我直接在這裏看到相同位置甚至顯示我的應用程序圖標
謝謝
好了 我們縮放回來
當我打開Messages也是一樣
比如說“見面地點是...”
你看到這裏有相同的位置
直接推薦到QuickType UI內部
由我的應用提供我可以直接點擊
地點的名稱和地址都插入進去了
而且這還對收到的消息有效
這裏我得到一條文本消息在問我他們的電話號碼是什麼
信息從NSUserActivity中直接提取了出來
我可以點擊它然後再插入電話號碼
非常炫酷
我們看看計時
3分40秒這還不錯
所有這些位置推薦功能
通過單個API由我的應用提供
我投機取巧了一點我有一些示例代碼 但你懂我意思了
這不需要大量的投入
所以消息 QuickTypeSiri 地圖 多任務處理
所有這些只需一個API
好了 我們也在應用搜索上做了些工作
將該內容編入索引
我首先回到應用然後還原其初始狀態
我將搜索披薩
披薩
果然那個位置出現了
但當我點擊它 我的應用就啓動了 但它做得並不正確
它沒有將內容還原成用戶期待的那樣
沒有顯示披薩店的豐富UI
我回到我的代碼這裏
這是因爲我們沒實施UIApplicationDelegate方法
所以進入我的應用委託
拖放那部分
我在這裏做的是
我在實施continueuserActivity restorationHandler
UIApplicationDelegate首先檢查活動類型
這是我們剛纔使用的那個
之後調用我在下面定義的方法這會查看userInfo
並像用戶預期那樣還原狀態
我將重新構建並運行
然後再看一遍
我們回到Spotlight
點擊結果
現在我們做對了還原了內容
如用戶期待那樣
所以這快速瀏覽了採用NSUserActivity的方法
用於位置推薦應用搜索和Handoff
好了 我們切換回來
這個樣例可在DeveloperLibrary中獲取
它的功能還要更多
它幫助你測試與NSUserActivity的整合
這是在你工作時放在身邊使用的好工具
用於這些位置推薦功能
好了 我們剛纔知道了採用NSUserActivity很容易
並在系統的許多不同部分推薦你的內容
我將談談schema.org如何提供
一些這樣的好處尤其是位置推薦
當我設計這些功能這些位置推薦功能
我們希望相同的效果也能再現於
你在Safari中查看的網站上
所以爲此
例如當你查看yelp.com
這映射了我們之前看過的相同內容
在Yelp應用中
當你從Safari切換走
你會得到相同的精緻便利的建議
來獲取這個地點的方向
這因爲yelp.com採用schema.org
這是我們爲此使用的技術
稍微講講背景知識
schema.org是開放網頁標記標準
允許你從語義上給內容加註釋
通過豐富的結構化元數據
這裏有很多架構爲各種概念提供大量的表達
而且schema.org也是旨在
爲用戶提供豐富的搜索體驗
在iOS中 以及所有主要搜索引擎
這些架構都是按照樹形結構排列
例如更具體的架構 像是餐廳
是源自更一般的類型例如本地商業
我們拿餐廳作爲例子
它是源自多個架構的因此
這繼承了所有定義它們的屬性
例如 名稱屬性是由事物架構定義的
在這個案例中這會捕獲餐廳名稱
地址也是一回事那是在本地商業架構中定義的
其他更針對於餐廳的事物
例如是否接受預定
是直接在餐廳架構內部定義的
這是schema.org實際運作的例子
在左邊 我們看到之前看過的網站
在右邊是在語義上描述它的內容
以Safari可以理解的方法
創建電話號碼
餐廳名稱地址 評級 網站
等等 能做的可以更多
我們來看看一個簡單的例子
這是一個非常簡單的HTML文檔
描述關於餐廳的內容
我們來看看這個網頁可能的樣子
當加入JSON-LDschema.org標記
如你所見 我們沒有改變任何實際的內容
或者實際的文檔結構我們只是在旁邊提供了元數據
以一種機器能接受的格式來描述內容
包括簡單的屬性像是電話
不過還有更復雜的結構化屬性像是地址
本身就是PostalAddress類型的另一個架構
如果你喜歡你還可以給內容註釋
與微數據內聯
我們就這麼做
我們在改變初始文檔的實際結構
並使用內聯微數據標記來增強它
在iOS 10中 Safari提取這些與位置相關的架構
在NSUserActivity中像推薦原生應用那樣推薦它們
這也會給你一些好處
關於我們之前談過的位置推薦
這些是Safari會提取的一些架構
任何帶有PostalAddressGeoCoordinate或電話屬性
而我們之前用的餐廳架構就是絕佳的例子
你有所有這些屬性
你可以組合或指定你當時可用的那些屬性
好了 我們談了NSUserActivity和schema.org
使用NSUserActivity
將用戶在應用內查看的位置
在整個系統的很多地方中 毫不費力地推薦給他們
還有通信應用
當然 還有所有Handoff和應用搜索的使用案例
在你網站上使用schema.org來得到這一些好處
用於位置建議
與NSUserActivity幾乎一回事
現在我們看看你的應用如何使用這些位置建議
像我們之前看過的
這裏我們將談談那麼做的兩種方式
一個是通過鍵盤另一個是針對路線規劃應用
我們從第一個開始
如果你的應用處理文本格式的地址
你可在應用內部受益於位置建議通過QuickType UI
現在我們在看Uber應用
如果你不知道的話這是一款拼車應用
當用戶進入文本域
這被註釋成位置文本域
那個情況下 我們從Yelp中直接將內容推薦到Uber內部
這包括最近推薦的位置
由其他應用在NSUserActivities或schema.org中推薦
基於你日曆上面的未來位置
可能複製到粘貼板中的位置
例如 你收到附帶地址的文本消息
甚至可能是你最近使用Siri互動過的地點
例如 如果你問...
如果你請求Siri給你指向附近的餐廳
之後與那個結果互動
你就會在那你看到它作爲位置建議的一部分
我們在UIKit中推出新的API
所以你的應用可以告知系統
文本域所預期的內容類型
在這個案例中我們使用的是位置
基於這個線索鍵盤就能夠作出
正確的主動建議
如果此時在前後關聯中可用的話
不過沒有可用的主動建議
這還會在自動校正方面提供更爲豐富體驗
因爲自動校正現在能知道應用所預期的內容
我們在UITextInputTraits中添加了新屬性
叫做textContentType允許你指定這個內容
這裏 我們使用UITextField這符合UITextInputTraits
因此會得到這個屬性
我們表示這個文本域預期完整的街道地址
這裏有很多的文本內容類型供你使用
範圍從描述人羣到位置還有很多其他的
這個完整列表可在DeveloperLibrary中獲取
不過我們着重仔細看看這兩個
這兩個都與位置相關
不過它們有不同的粒度等級
你要使用最能表現你的使用案例的那個
擁有正確的粒度等級
例如
一個導航應用通常會預期完整的街道地址
這樣能準確地將用戶指引到他們的目的地
而天氣應用可能通常只需要在乎州和城市
因爲這對天氣的使用案例就足夠了
如你所見
基於我們指定的不同內容類型
我們得到了不同的內容推薦到了QuickType欄內部
一個是完整的街道地址另一個只是加州舊金山
在鍵盤中得到建議就是這麼簡單
現在我們看看路線規劃應用如何得益於
這些底部精美的方向橫幅
如Daniel之前說的路線規劃應用
第三方路線規劃應用也可以提升到這裏
讓用戶直接加速進入你的應用
當我們認爲用戶的意圖是獲取方向
我們利用了現有API叫做MKDirectionsRequest
這是在iOS 6中推出的這允許你註冊路線規劃應用
然後處理所有的方向請求
iOS會隨着時間學習
基於各種因素判斷用戶最愛的路線規劃應用是什麼
例如像是參與
然後在合適的時候在多任務UI中建議
爲此你要確保你將應用配置成
能接收方向請求
這很容易就能在Xcode中通過功能面板完成
在iOS 10中 我們推出了一種新的路線規劃模式
專門用於拼車應用
接下來 你要聲明與你應用真正相關的地圖區域
比如說如果你的應用是當地的地鐵應用
你可以指定你的應用只在這個區域相關
最後你要確保
你會採取合適的行動當你的應用啓動在
MKDirectionsRequest內部
那就是你的應用應該自動開始定向
或者填充UI 使得用戶能
容易地獲取方向
在代碼方面 這個例子示範了如何採用MKDirectionsRequest
MKDirectionsRequest使用一個URL方案
當你的應用啓動後會附帶有一個URL
我們首先做的是檢查
我們得到的URL實際上是有效的MKDirectionsRequest
MKDirectionsRequest爲此提供isDirectionsRequestURL
接下來我們減輕MKDirectionsRequest的一個實例
來自URL的內容這包含的信息是關於
出發地和用戶想到達的目的地
在iOS 10中 接下來這個功能十分重要
尤其對於那些已經採用了MKDirectionsRequest的人
那就是現在你可以使用沒有地理座標的
地圖項目進行啓動
在這個案例中你要將你得到的
地址字典進行地理編碼使用CLGeocoders
geocodeAddressDictionary這會返給你一個地點標記
附帶正確的緯度和經度這會之後幫助你開始定向
到預定的位置這就差不多好了
這就是如何推薦你的路線規劃應用
在多任務UI的醒目位置上
至此 我想交給Daniel
來談談媒體應用的建議謝謝大家
這太棒了好了
現在我們談談媒體應用建議
如果你的應用處理任何形式的媒體
像是播客應用或類似Spotify的應用
或甚至播放視頻的應用那你就要認真聽聽了
現今的iOS會推薦我們認爲你會使用的應用
基於你的行爲
我們在大量不同的UI中推薦那個應用
我之前展示過了
我們特別地在Spotlight中提供哪些建議
還有Today View
如果建議的動作跟隨着特定的觸發
例如 當你插入耳機或者Bluetooth配對
或甚至到達某個地方而且是媒體應用
我們可以進一步提升它
我們看看這是什麼樣的
這是Spotlight中推薦的樣子
假如說我總是或者經常聽播客
在插入耳機之後
注意 在左邊上部有播客應用建議
不過在某些情況下那個推薦
會提升到鎖屏的上面
所以你看到的是
我們傳統上用於Handoff的UI
現在用於推薦一款應用
是我們認爲我可能使用的因爲這遵循
之前提到的那些觸發
這是非常好的體驗
但又不是那麼的好因爲說到底
你現在必須做的是
你必須解鎖設備
向右滑動才能獲取我們
所預測的你想要消費的內容
通過非常簡單的API
你可以爲用戶構建更好的體驗
這是它之前的樣子我剛纔給你展示過了
這是它之後的樣子
我們做到了吧？這是之前的樣子
這是之後的樣子好太多了
不僅用戶可以參與到內容中
而且不用解鎖他們的設備
同時還可以將專輯封面在突出位置展現給用戶
這在做完後可能很顯而易見
不過這個特定的界面還提供了更好的轉化
如果你看實際數字的話
如果你感興趣於
讓用戶實際去播放你的內容
你應該是感興趣的那這就是屬於你的API
我們怎麼做？
我會一步步地講非常易於採用的
這都可以歸結於一個類叫做MPPlayableContentManager
想象一下你有
一個有着不同屬性的字典
有標題 藝術家 專輯
你想做的是將其提升到
設備的鎖屏上當系統認爲
客戶可能會參與其中
你首先要做的就是
導入Media Player並聲明你自己
與那個類別中的委託一致
然後你要實施一個方法叫做playableContentManager
這很簡單
首先 你要抓取媒體項目
通過你有的任何手段
很顯然你要做好準備
尤其是如果你要獲取遠程資源
以防其失效那種情況下 你要調用
在下面看到的那個回調句柄
因此係統會明白不一定要給你推薦
下一步 你要填充NowPlayingInfo
在設備的鎖屏上
這是我實施的一個方法所以給你展示其背後的內容
首先你要做的是抓取infoCenter對象
之後如果你有確實一張特定的圖像
是這個媒體項目上有的你可以將它推薦到
設備的鎖屏上
如果你使用的是默認圖像這就是個機會
讓你的品牌得到提升
然後你要把你的表示轉化成
nowPlayingInfo表示最重要的是
要在infoCenter上設置nowPlayingInfo
在完成之前所展示的回調之前
所以你要在方法結束之前完成
如果出於某種原因你不喜歡
或你的應用在準備回放時出現錯誤
如果手機處於飛行模式
這是另一個機會讓你提早去除錯誤
注意 實際上你不想在此時開始回放
你插入耳機 你要等待
客戶點擊播放按鈕
不過你要做好準備加載到流文件中等等
就是這樣
再說一遍 現今的iOS根據你的行爲推薦應用
如果遵循特定的觸發並且它們是媒體應用
我們把它們提升到鎖屏上
通過我剛纔展示的非常簡單的採用
你可以得到更好的體驗並且有機會
去推廣你的品牌
以及你有的那麼華麗的專輯封面
好了 總結一下我們今天所講的內容
我們談了幾個簡單的API有助於將你的應用深度整合到
操作系統中
我們談了NSUserActivity這相當於操作系統的眼睛
這幫助我們從語義上瞭解客戶當前所看的內容
然後我們談了schema.org從很多方面講
對網頁來說類似於NSUserActivity
我們講了現有API中新的使用案例
以及全新的UIKit API
來幫助我們讓系統瞭解何時提升位置
之後說到了MPContentMPPlayableContentManager
如果你是媒體應用那這就尤爲相關
希望今天大家都清楚地知道
這些API易於採用並且容易測試
在網上可以獲取更多的信息
以及一些精彩的相關會議
如果還沒有看的話你應該去看看
這裏有很多與SiriKit相關的工作
有很多與搜索API相關的工作大家今天都看過了
以及過去兩年來的一些先前的會議
圍繞Handoff和上述的搜索API
最後我在結尾說一下這個領域
我們公司會繼續投入下去的
我們需要各位開發者所做的事
就是告知我們你們應用的功能
以儘可能最詳細的方式
因爲從根本上講我們越瞭解你的應用
我們就越清楚何時是推薦的最佳時機
所以今天你看到了
很多不同的情況中語義細節是不同層次的
你可以將活動或文本域註釋進去
我會盡可能多地鼓勵你
當你做的時候要儘可能地外顯出來
不僅支持我們今天討論的功能
同樣讓你的應用處在優勢位置面向未來
感謝大家今天的到來
祝願大家在WWDC和週五過得愉快
再見