Xcode應用簽名的新特性
早上好
謝謝
歡迎來到“Xcode應用簽名的新特性”介紹
Xcode給應用程序簽名可能很麻煩
我們理解這一點
但是現在你們需要知道的是在Xcode 8裏面
我們極大地簡化了應用簽名的管理
事實上它現在是自動完成的
另一方面若你要100%地掌控Xcode
來完成你的應用簽名
你現在也能做到這一點了
Xcode不會修改或者創建新的用戶配置
應用簽名能讓你的身份被用戶辨識
一旦打開應用 他們就會知道
這個應用由你開發並且沒有被第三方修改過
數字簽名同樣能防止（第三方的）應用詐騙
因爲當你用自己的bundle ID到開發者網站綁定註冊之後
其他的開發者團體就不能使用這個bundle ID了
簽名同樣能授權你訪問系統服務
比如iCloud網絡支付
今天我們將介紹4項內容
讓我們從簽名的原理和一些基礎知識開始
比如怎樣給你的應用程序簽名
在那之後我們會介紹一些激動人心的改進
包括如何給新的(開發)設備
配置簽名證書
現在 你們需要同步個人密鑰
或者撤銷然後重新生成證書
這種情況已經成爲過去了
是的 你們會喜歡我們的改進的
在這之後我們會介紹一些新的工作流程
它們讓應用簽名變得格外簡單
最後 我們會介紹一些最佳做法
來實現新項目配置
我們從應用簽名原理和基礎講起
當Xcode部署你的應用以及對它簽名時
這一切的背後都是它通過一個叫codesign的工具來實現的
現在如果你是新手的話你可以完全不用考慮這一點了
Xcode能自動幫你完成簽名
若你已經有一定經驗 你也許會想
簽名？它是怎麼實現的？我們使用了codesign這個工具
codesign所做的就是它將應用程序的源碼包
進行加密封裝
這樣能讓系統識別
簽名後的應用程序是否有被修改過
所以如果有任何人修改過你的應用它就不能被安裝或者啓動
除此以外codesign還賦予應用程序獨特的加密簽名
所以它能夠被識別
用戶也能知道這個應用來自何處
如果你想給應用程序簽名你需要準備3個東西
首先是一個簽名證書
簽名證書能確定你軟件開發者的身份
用戶配置跟你的應用程序關聯
它們被用於設備授權
應用權限確定了應用程序所支持的功能範圍
比如iCloud和Wallet
簽名證書都是由Apple簽發
這一點尤爲重要因爲設備需要和Apple建立信任鏈
這樣才能安裝應用
證書有兩種類別
一種是應用開發證書被用於部署和運行應用
一種是應用發佈證書
被用於發佈應用到iTunesConnect時的身份驗證
或者 如果這些是企業證書的話它們是用來發布給用戶的
所有的簽名證書都需要個人密鑰
個人密鑰必須保存在Apple的keychain
如果你想要給應用簽名
跟證書匹配的個人密鑰
也會在證書生成的同時被創建
所以擁有這枚個人密鑰就顯得尤爲重要
值得一提的是Apple從來不會保存你的個人密鑰
你也不能去開發者網站下載它們
好消息是 在Xcode 8裏面
你的應用開發證書
再也不是一個煩惱了
我們等下會展開講解這一部分
用戶配置也是由Apple簽發的
同證書相反的是
證書被用於確認你的開發者身份
而用戶配置跟你的應用程序關聯
它允許你的應用被運行在特定設備上
在配置裏面有一個身份列表
在應用程序被安裝到設備的時候
設備會檢索這個身份列表確認你的身份是包括在裏面的
如果是的話你就能安裝這個應用
配置同時也授權應用使用應用權限
一個配置裏麪包含一個權限白名單
如果你想使用一個權限那麼它必須在這個白名單裏面
同樣的 如果你是新手的話
你不需要考慮這些
Xcode會自動爲你處理這些
如果你有一定經驗
你也許會問爲什麼你需要一個新的用戶配置？
當你在添加一個新的應用權限到應用程序的時候
這都是因爲權限白名單的存在
說到應用權限
權限定義了應用程序對系統功能的支持範圍
本質上來說權限只是一個被賦予特殊值的字符串
就像一條鏈子或者一個碗狀物
權限具體數值由其系統功能來定義
所以如果你的應用需要實現一個系列的功能
但是應用擴展需要實現另外一個系列的
沒有問題
Xcode有內置的功能編輯器
我們稱之爲功能選項卡
功能選項卡可以在配置詳情裏面
管理你的權限PLIST
所以你完全不需要訪問開發者網頁
一切都可以在Xcode裏面完成
這些就是你給應用簽名時所需要用到的一些東西
我們現在來看看當Xcode給應用簽名時都發生了什麼
Xcode需要知道使用哪一個證書
以及哪一個配置文件
實際情況中Xcode會首先部署你的應用程序
然後開始檢索你電腦裏的證書列表
它會使用最新的並且跟你開發組匹配的那一個證書
Xcode接下來會檢索你的配置列表
然後選擇那一個最新的並且跟bundle ID匹配的配置
這樣證書和配置就被整合在了一起其中配置會被內嵌到應用程序裏面
而證書會被codesign用來加密封裝應用程序
以上就是一個快速回顧
應用簽名原理和基礎
現在我們來討論一下我們
爲新設備配置簽名證書所做的改進
誰之前見過這個？
是的 你的賬戶已經擁有一個證書
Xcode幫助你重置它
如果你按下重置按鈕後會怎樣？
是的 你現有的證書會被清除掉
一個新的證書會被創建爲什麼會這樣？
事實上 你的應用開發賬戶只能使用一個簽名證書
若你只有一臺開發設備它能很好地勝任（開發工作）
證書被成功創建個人密鑰也同時被生成
並且保存在你的keychain裏面萬事俱備了
現在如果你有另外一臺Mac呢？
好吧 如果你想從第二臺Mac部署應用並且簽名的話
你需要一個證書以及個人密鑰
你可以通過keychain把它們同步過去第二臺Mac
然後在Xcode上導入證書和密鑰
或者你可以創建新的簽名證書
但是首先它需要你廢除舊的證書
然後你就可以在第二臺Mac上部署應用了
但這也意味着你無法在第一臺Mac上部署了
然後很容易就會陷入這個死循環
在一臺上能開發
在另一臺就不能
這真的很繁瑣並且令人沮喪
現在 好消息是 在Xcode 8中
你可以同時擁有多個應用開發證書了
是的
你的每一臺設備
都能擁有獨立的證書和個人密鑰了
你再也不需要爲了應用開發而同步個人密鑰了
當然你再也不需要看到這個了
這些改進只對應用開發證書有效
應用發佈證書依然
被限制在一個的數量
以前簽名證書是在Xcode或者開發者網站上生成的
現在它們是在Xcode 8或者更新的版本上生成
如果你的Mac上有舊版的Xcode
然後你生成一個新的簽名證書
它依然可以使用新的證書100%向後兼容
以上就是Xcode 8裏關於簽名證書所做的改進
現在我想把舞臺交給我的同事Itai
他將會跟大家介紹Xcode 8裏的一些新的工作流程
大家早上好
Joshua給我們講解了一些應用簽名的原理
和基礎
你需要一個證書和一個配置
與你的設備和權限匹配
但是很多人都同時擁有擴展應用
如Apple Watch應用或者應用內的嵌入式框架
每一個部分都會有各自不同的簽名需求
這些需求綜合起來能讓簽名變得異常複雜
簽名將會變成一個難題
而且管理好每一個簽名需求也會異常困難
所以Xcode在許多版本發佈中
都致力於簡化這些(工作流程)
在Xcode 7裏“Fix Issue”按鈕將會出現
當Xcode檢測到你的簽名配置出現錯誤的時候
有時候點擊這些按鈕能夠修復問題
然後你就能回到應用開發
但是 很多時候這並不能解決問題
或者你需要點擊很多次 直到問題解決並且 在任何時候
Xcode都不會讓用戶瞭解問題所在
問題爲什麼能得到解決並且是如何得到解決的
事實上若Xcode知道怎麼解決這樣的問題
爲什麼還要讓它打斷你的應用開發
讓你點擊一個修復按鈕呢？
在應用簽名時和Xcode 7的交互
很多時候會讓你覺得是在跟一個黑匣子對話
你不能看到裏面但是你能瘋狂地點擊紅色修復鈕
尤其當你陷入抓狂的時候
這樣看來它的工作機制並不是很理想
所以 在Xcode 8中我們取消了修復鍵
但是同時我們也做了更多的工作
我們完全重新設計了Xcode 8的簽名機制
我們現在擁有了全新的簽名基礎架構
比以往的更快並且更穩定
此基礎上 我們重新構建了新工作流程
在常規選項卡下設計了新的用戶界面
這樣你就能預覽和管理你的簽名配置
所有功能高度集成
接着我們着手改進了Xcode和用戶的溝通機制
當簽名問題發生的時候
許多的錯誤信息晦澀難懂讓人無從下手
所以在Xcode8中我們修訂了它們
因此你會看到更清晰明瞭的信息
當任何異常情況出現時
如果你很好奇
Xcode是怎樣替你
修復簽名問題
我們增加了狀態報告功能
這樣你就能實時瞭解Xcode如何修復問題
如Joshua在開始提到的一樣
Xcode 8新增了兩種簽名機制
第一種是自動簽名
現在自動簽名功能被完全重新設計
它能滿足你的一切簽名需求
你再也不需要創建配置或者更新app ID
這一切Xcode都能在後臺自動完成
所以當你在開發應用的時候
Xcode會確保你擁有最新的簽名
如果你需要掌控你應用簽名的每一個細節
你可以開啓自主簽名功能
在這種模式下Xcode不會創建或者修改
你的任何配置
它也不會更改你的簽名配置
我們來進一步看看這一切都是怎樣工作的
首先 自動簽名
當你創建一個新的項目時
自動簽名是默認選項
但是如果你是一個有經驗的開發者或者你正在打開一個已有項目
你可以在常規選項卡下開啓它
在這個全新的簽名UI
你需要做的只是勾選
然後告訴Xcode你的應用開發組
在那之後Xcode會自動完成配置的創建
以及應用程序的簽名
它會告訴你部署應用時會用到的
配置和證書
所以具體來說自動簽名能爲你做些什麼？
沒錯 它會創建你的簽名證書
這樣 當你在開發iOS應用時
它能幫助你創建iOS應用開發證書
它也能創建以及更新你的應用ID和配置
這一切都在你開發的同時在後臺完成
這樣你就能專心於應用開發
但是也有一些情況Xcode 8會提示你
尤其在你連接一臺新設備到Mac的時候
你的Mac發現這臺設備並沒有在開發組註冊
Xcode會在註冊前詢問你
因爲我們知道授權設備是有數量限制的
你需要完全掌控它們的分配
最後
如果你想知道Xcode替你在後臺做了什麼
你可以查看簽名報告
來瞭解Xcode的工作記錄和原理
接下來讓給大家演示一下這一切都是如何工作的
我將要演示的是Xcode 8如何自動簽名
在全新的iOS應用上
點擊繼續
給它命名
我不是一個出色的廚師我喜歡簡單的菜譜
第一點需要大家注意的是
在新的項目助手中
有一個新的彈出選項“團隊”
當你創建項目的時候你可以直接選擇
你希望用來簽名的開發組
在那之後 你的應用就將會
使用這個開發組來進行自動簽名
點擊繼續
我會在桌面創建它
Xcode剛做了些什麼？
它創建了一個全新的項目
並且開啓了自動簽名作爲默認選項
當我創建項目的時候
它直接就生成了簽名證書
和一個配置給我
我可以放大這裏 來看得更清晰
如果我希望修改我的應用開發組
我可以在這裏完成
創建一個新項目就是這麼簡單
我可部署項目並且讓它直接運行在設備上
我再也不需要點擊修復鍵或者修改我的配置了
我所需要做的只是創建一個新項目然後告訴它我的開發組
但是我們還可以讓這一切變得更有趣
就如Joshua之前所說你可以使用功能選項卡
來開啓你需要的系統功能比如說Cloud Kit
我們用這個應用來嘗試
我們進入功能選項卡
這裏我能看見我的應用支持的全部系統功能
我需要做的只是輕觸這個開關來開啓其中一項
我想要使用Cloud Kit以及信息推送
當我們做這些的時候Xcode會相應地更改我的項目
它關聯了系統框架它也修改了我的權限文件
它甚至還聯繫了開發者網站
下載了一個新的配置
我現可直接部署並運行我的應用
我能立刻開始使用這些系統功能
重申一次 我從來沒有點擊任何修復鍵
或者輸入任何權限
現在 我偶然知道了Xcode下載了一個新的配置
我是Xcode軟件工程師
可是你們大部分人可能都不是
所以如果你好奇Xcode都做了哪些工作
你只需點擊進入“報告導航”
那裏你能看到一個叫“更新簽名”的新報告
任何時候只要Xcode替你修復一個簽名問題
這樣的一個報告就會被創建
讓我們看看最新的一個
看看裏面都有什麼內容
我們放大來讓現實更清晰
這裏我們能看到Xcode檢測到了一個問題
我能看到問題更多的詳細信息
只要點擊那一行並且展開
所以Xcode在說我已有的配置
並不支持iCloud
緊接着在這下面
它創建了一個新的配置給我的應用
一切都如此簡單
你就知道Xcode在替我修復問題時具體做了哪些工作
關於自動簽名你還需要知道幾件事
第一是它只適用於應用開發簽名
應用發佈簽名是由另一個工作流程完成的
Joshua稍後會聊到這個話題
並且它只適用於Xcode生成的用戶配置
這些當然都是Xcode替你創建的配置
並保證它們在你應用開發過程中實時更新
這樣的好處是你可以使用自動簽名
不需要擔心應用發佈證書
被Xcode使用
你的應用發佈證書和用戶配置
絕對不會被自動簽名修改
在Xcode 8裏自動簽名被重新設計了
它不會出現在你的視線裏同時它也幫助你管理簽名
所以你能真正集中精力在重要的事情上
也就是應用開發
現在我們來看一看圍欄的另一面
自主簽名
如果你還記得的話這是一個模式
在裏面你能控制應用簽名的每一步工序
你可以開啓自主簽名功能
只需要在常規選項卡里取消勾線自動簽名
在那之後
Xcode就會讓你選擇不同的用戶配置
來搭配你不同的開發配置
這會非常有用當你擁有持續集成系統
或者當你需要給免費和付費版應用不同的配置
現在你有了實現它們的工具
這一切配置你都能在常規選項卡里面完成
不需要再訪問“構建設置編輯器”
這是一個功能強大的UI來幫助你配置應用簽名
但是我們想要它的功能更進一步
你們當中有人需要手動選擇配置時
肯定遇到過一些奇怪的安裝或運行報錯
這通常跟權限有關
我們希望Xcode能提供給大家更有用的信息
在你陷入問題之前
爲此我們在常規選項卡里加入了一些新的錯誤報告機制
它就在你設置的旁邊
這樣選擇正確的配置就會更加簡單
這裏我能看見我的配置
並不支持我應用的功能
我能清楚瞭解如何解決這個問題
另外
我可以看見用戶配置的更多信息
只要點擊配置信息
就能看到很多細節
比如配置的創建日期以及它支持的系統功能
並且 它也更方便我們排查錯誤
以及瞭解如何修復問題
自主簽名僅限於手動創建的配置
這些配置是由你或者你的開發組成員創建
在開發者網頁上
Xcode一定不會修改它們
你可以選擇任何種類的配置
如我之前提到的
如果你想用應用開發的配置來做開發部署
用應用發佈的配置做其他用
這是可行的
這真是很棒的事情
尤其對於那些經驗豐富的開發者
他們以前手動選擇過配置
Xcode 8裏又一個新的開發設置名爲“用戶配置區分符”
它的作用是根據名字來引用配置
爲什麼這是一個很大的進步
因爲在Xcode 8前
Xcode只能根據獨特ID來引用配置
不管是有一新開發者加入你的團隊
或者你添加了一個新的設備
你都需要相應地更新你的配置
在這個過程中也會生成一個新的獨特ID
然後你就需要更新你的項目配置
好了 在Xcode 8因爲我們使用名字來引用配置
你所需要做的只是更新配置
Xcode就能自動識別它你再也不需要更新你的項目配置了
謝謝
現在讓我們看看自主簽名是怎樣
在演示機上工作的
好的
我將給大家演示我的另外一個正開發的應用——Scrapbook
這裏放大
所以Scrapbook已被設置成爲自主簽名
我選擇了不同的配置給我的免費和付費版本應用
這真的很容易配置
在常規選項卡里
這就是我需要做的一切
只需要從選項欄裏選擇不同的配置
因爲我沒有看到任何報錯信息
我就已經確定我可以部署和運行這個應用了
一切都會順利工作
但是就如之前的演示裏面
讓我們把事情變得更有趣一點
我想要使用這個功能選項卡
這樣我就能把iCloud和消息推送包括在我的應用功能裏
如果你在之前已經使用過功能選項卡
使用一個手動設置的用戶配置的時候
你大概也已經注意到它會更改你的簽名設置
或者進行一些你並不需要的改變
在Xcode 8裏功能選項卡可以很安全地被使用在
自主簽名模式了
它能判斷你做的本地設置改變是否安全
比如更新你的權限PLIST
但是它不會接觸到你的配置
我將告訴你怎樣通過手動的步驟
來解決這些問題
我們來看看這個
我會點擊“功能”
然後開啓iCloud和推送通知
現在Xcode會給
能正常運行的步驟旁邊打勾
給其它一些
需要另外在開發者網站上完成的步驟標打叉
我能在常規選項卡里看到更多的詳細信息
讓我把這裏放大
如果你看見這個報錯信息
Xcode在告訴我我選擇的配置
不支持iCloud和推送通知
這很明顯 因爲我剛開啓了它們
這一切都很清晰明瞭
我明確的知道如何解決這些問題
但是在過去如果我試着部署和運行
我的應用要麼不能安裝要麼不能成功運行
最後 如果我想看更多信息的話
我可以點擊配置信息鈕
Xcode告訴我配置的更多信息
比如它支持或者不支持的系統功能
重申一遍這一切都非常簡單
我清楚的知道如何解決這些問題
讓我們來修復這一個
如我之前所說在自主簽名模式裏
Xcode不會修改我的配置
我需要去到開發者網站上自己修改
所以我要打開開發者網站
點擊證書——標識符——配置
我需要做的第一件事就是更新應用ID
所以我要選擇應用ID
選擇我爲這個應用已創建好的應用ID
它告訴我所有支持的系統功能
點擊修改
向下滾動開啓iCloud
我看到的這個警告信息
在提醒我 當我更新了應用ID之後
我還需要下載一個新版本的用戶配置
點擊確定
然後我想開啓更新版本的iCloud
我將開啓它
它再一次提醒我需要一個新配置
點擊確定
向下滾動開啓推送通知
一切都完成了
下一步是更新我的配置
點擊“開發”
然後你看到兩個scrapbook的配置
被標註爲無效
那是因爲我已對我的應用ID作了修改
可是我還沒有重新生成新的配置
所以它們就過期了
讓我們來更新Scrapbook免費版的配置
點擊然後修改
我能向下滾動
我不會修改證書或者設備信息
點擊生成
然後下載新的配置
現在最後一個步驟是安裝配置
這樣Xcode就能使用它了
我可以在下載文件夾裏面點擊它
所以這裏發生了什麼？
讓我放大看看
當我點擊配置的時候Xcode安裝了它
然後立刻更新並開始使用它了
所以我們能看到免費版應用的部署設置頁面的報錯信息
已經消失了
你可能也已經注意到
在這期間我並沒有修改任何的項目配置
這是用戶配置區分符在後臺幫我們完成了一切工作
一旦我安裝了新版的配置
Xcode就能直接自動使用它
現在我可以部署和安裝我的免費版應用
一切都能正常工作我能使用iCloud和推送通知
但是好像我還需要更新我的付費版應用
有人想看我在開發者網站上再做一遍嗎？
還是我們已經知道怎麼做了？
好的
這有一點枯燥
如果你注意看我剛纔演示的步驟這實際上是
重複了一邊我剛纔所做的
以及Xcode爲我所做的一切步驟
在自動簽名裏
以上就是自主簽名Xcode 8裏一個新的簽名模式
你將能完全掌控應用簽名
Xcode不會擾亂你的設置或者修改你的配置
但是我還是鼓勵大家使用自動簽名
它在Xcode 8裏被重新設計了
並且提供了無縫高效的開發流程
我希望你們能夠喜歡
現在我們重新請回Joshua給大家講解一些最佳做法
謝謝你 Itai
我們剛纔看到了Xcode 8的新流程
能讓大家很方便並且快捷地管理簽名
現在我想跟大家談談一些最佳做法
來管理你的項目簽名
第一件事是使用自動簽名
自動化的設計是希望大家的生活越來越容易
它很好的勝任了這一點不管是對獨立開發者
或是大型團隊
所以你應該把你應用的所有開發人員
加入到一個開發組
你應該使用功能選項卡來管理權限
這樣就能避免使用開發者網站
來配置功能比如iCloud容器
如果你是用自主簽名 不要設置CODE_SIGN_IDENTITY
因爲你有一個獨特的簽名證書
和你的帳戶關聯
所以如果你給你的簽名證書設置了這個
一旦有人想使用你的項目
他們就不能部署了
所以你應該讓它設置爲默認值
避免使用構建設置編輯器
你應該使用目標編輯器下面的常規選項卡這一新UI
它能讓你看到配置的詳細信息
並且它能正確使用名字引用配置
這樣你就能保證項目信息的準確性
你還應該使用功能選項卡
在自主簽名模式下來管理你的權限PLIST
並且如果你是用開發簽名來配置你所有的項目
你應該試用自動簽名
當你回去打開Mac的時候
看一看目標編輯器的勾選項
然後試一試
當你想發佈你的應用時
Xcode有一個專門的工作流程
一切都建立在創建一個歸檔的基礎之上
應用歸檔裏包括了你的應用程序的拷貝
很重要的一點是你應該使用開發簽名
如果你用發佈證書給應用簽名的話
你將不能完整地測試
你開發的應用
所以必須使用開發簽名
當你準備好要發佈
當你使用organizer
Xcode會給應用重新簽名
使用你的開發證書和用戶配置
若你點擊上傳 它會直接被上載到iTunes Connect
或者 你點擊導出你會得到一個IPA文件
或是一個被髮布簽名過的應用
以上就是發佈應用的最佳做法
我們今天介紹了幾項內容我們講到了簽名證書的新改進
能讓你很容易配置新的開發機器
我們談到了新的自動工作流程
能解決你應用開發過程中的很多痛點
我們還談到了新的自主簽名模式
所以你能手動配置項目
按照你自己的意願
如果你想了解更多進入這個鏈接
如果你想了解更多Xcode或者安全機制的信息
你可以參加這些會話
謝謝大家