HomeKit的新特性
大家好謝謝大家的到來 歡迎你們
我是Dennis Matthews
我是AppleHomeKit工程組的一員
在我們開始介紹HomeKit的新特性之前
我想花幾分鐘來談一談HomeKit
我想要着重介紹一些組成HomeKit的核心功能
HomeKit是一個應用框架它提供了非常豐富的應用程序接口
這些接口能夠讓你的應用
與各種兼容HomeKit的家居設備進行溝通
你的應用程序可以通過相同的接口
訪問不同廠家生產的家居設備
HomeKit將用戶家庭數據保存在一個公共的數據庫裏
這點非常重要它讓所有的應用程序
都能訪問同樣的家庭數據以及家居設備的配置
如果這個用戶有多臺移動設備
並且它們都登陸了同樣的iCloud賬戶
HomeKit能讓家庭數據同步於
這幾臺不同設備間
這一點非常棒
因爲用戶不再需要做額外的設置他只要拿起任意一臺設備
就可以同HomeKit家居設備溝通
HomeKit同樣支持用戶家庭數據共享
所以一個用戶可以允許他的家人和朋友
控制他配置的家居設備
共享非常簡單
用戶只需要通過iCloud賬戶邀請其他的用戶
只要他們接受了邀請
HomeKit就能自動完成家居控制的共享
添加額外的移動設備
並相應地配置所有的家居設備
這樣新的用戶就能夠訪問並且控制家居設備了
當然 家庭主人可以隨時撤銷別人的訪問權限
HomeKit使用了統一的通信協議來控制不同的家居設備
確保它們和Apple設備安全地通信
所有的HomeKit家居設備
不管它們是通過何種媒介進行通信
都使用了相同的通信協議
Apple支持的協議同時還定義了一組豐富的設備配置
這些配置能夠描述大部分常用的家居設備
有了它們Siri支持也就水到渠成了
Siri爲用戶提供了一種自然的交流方式
來訪問控制他們的家居設備
當用戶在家時Apple設備連接到
HomeKit家居設備非常簡單
用戶需要做的只是
讓HomeKit設備和Apple設備“對話”
進行通信
它們的通信要麼使用Wi-Fi要麼是低功耗的藍牙連接
當用戶不在家時
對家居設備的遙控操作
是通過Apple TV完成的就如同一個遙控網關
Apple TV創建了一個加密通信通道
來連接移動設備和家居設備
安全性
我們從開發HomeKit的第一天起就不斷強化它的安全性
所有的HomeKit通信都是點對點加密
即 所有用來進行通信加密的密鑰
只保存在用戶自己的設備上
所以即使通信流經了中間設備或者中介服務
他們也不能解密
即使Apple也不行
HomeKit採用的是業界知名的“完全向前加密”技術
也就是說 每一次的通信對話從用戶的Apple設備
到他們的HomeKit設備
用戶的每一個會話密鑰都是爲這一次通信對話新生成的
當通信完成 這些密鑰就會被銷燬
這點非常重要因爲即使在將來
如果任何一個設備被攻破一個長期密鑰被泄漏
它也不能夠被用來
解密在那之前進行的數據通信
家庭數據是私密的
我們對數據私密性的保護集成在應用接口上
應用程序必須明確地向用戶請求權限
才能訪問家庭數據
HomeKit支持各種不同家居設備
我們和家居設備生產商一起合作
在市場上推出了種類豐富的家居設備
我們的合作商還在計劃
推出更多令人興奮的新設備到HomeKit生態系統
以上就是一個高層次的概述有關於HomeKit
有了這些背景知識 讓我們開始介紹HomeKit的新特性
我們會介紹三大項內容
首先 系統平臺
我們擴展了HomeKit的平臺支持範圍
涵蓋Apple的系統平臺包括 iOS watchOS 以及 tvOS
我們擴大了HomeKit對家居設備的支持範圍
就在這次升級
許多的新功能和新提升
都會隨着此次的應用框架升級進入你的應用
我們稍後會介紹更多細節
首先 系統平臺我們非常激動
在今年發佈了一個HomeKit應用
Home應用提供了非常簡潔的操作界面
讓用戶能非常容易的地操控他們的家居設備
它還允許用戶對家居設備進行自動化設置
Home應用支持所有iOS設備包括iPod Touch和iPhone
在iPad上看起來也非常美觀
是的 隨着watchOS 3的發佈Home應用也支持了Apple Watch
我們認爲用戶會得到非常棒的體驗
不止如此 我們還把HomeKit深度集成到了iOS系統裏
HomeKit選項可以直接在控制中心被訪問
用戶可以配置他們常用的家居設備
控制這些家居設備以及選擇場景
一切都在控制中心完成
關於系統平臺的第二點...
遠程遙控和自動化
隨着tvOS 10的發佈我們擴展了Apple TV功能範圍
所以在遠程遙控的基礎上Apple TV現在還負責
所有家居設備的自動化運行
是的 這一點非常棒因爲不管用戶在哪裏
在這個虛擬的世界裏他們能夠放心
所有的家用設備自動化都在Apple TV上進行
Apple TV同樣爲共享用戶提供更多的操控選項
它可以將管理權限授權給共享用戶
擁有管理權限的共享用戶
也將能控制設備的配置
他們可以添加或移除家居設備
或者 同樣的 他們也能邀請其他用戶
讓他們也能控制所有家居設備
現在 我們還能管理每一個用戶的遠程訪問權限
我們可以授權或者移除其他用戶的遠程訪問
防止他們連接到家居設備上
同樣的功能現在也支持iPad
不止如此
如果用戶家裏有多臺授權移動設備
比如Apple TV和iPad或者是任意設備的組合
它們會自動地協作
擴展家庭的HomeKit網絡
在和家居設備通信的時候
它們會自動選擇一個控制設備進行通信
不需要額外的配置來自用戶
這一切都由HomeKit自動完成
系統平臺第三點更新關於tvOS 10
我們非常激動地把HomeKit框架集成在了tvOS
現在tvOS有了HomeKit框架
你的應用就可以預覽家居配置
操控家居設備
以及開啓情景模式直接在Apple TV上完成
這同樣也意味着Apple TV現可使用Siri控制HomeKit
得益於Siri操控的便捷性
你能方便地控制HomeKit設備
以上就是系統平臺的幾點重大更新
我們來快速回顧一下
首先 Home應用
它是Apple研發設計的HomeKit應用
它能讓家居設備的配置
以及常用功能的操控變得非常的簡單上手
第二 遠程操控和自動化
我們擴展了Apple TV功能範圍
讓它來自動化運行家居設備
同時它還支持了共享用戶對家居設備的控制
同樣的功能現在也支持iPad
第三點 在tvOS內部我們集成了HomeKit框架
我們非常激動能把這些新特性帶給系統平臺
第二項內容我們將會講到新的家居設備支持
第一類新設備今年我們將會支持
常用的空氣處理類設備
所以現在 HomeKit能支持空調和暖氣設備
空氣過濾器 以及空氣加溼器
這非常棒因爲我們的用戶現在可以
把這些全新的家居設備
加入到HomeKit生態系統使它們實現自動化
第二類 我們非常開心地
將相機類設備加入了HomeKit支持範圍
有了相機類設備你的應用程序將能夠
顯示相機拍攝的實時視頻
顯示相機拍攝的靜態照片
控制相機的所有配置
以及控制揚聲器和麥克風配置
第三類 門鈴
門鈴是一種非常簡單的家居設備
當門鈴被按下它能觸發相應的程序
同時門鈴設備能夠控制
鈴聲的音量
如果門鈴設備還帶有視覺指示器
它們也能被門鈴設備所控制
我們常見的門鈴也常常和其它的設備集成在一起
門鈴攝像頭是一個熱門的類型
現在它們的配置也同樣被HomeKit支持
這些功能強大的設備不僅能被HomeKit控制
它們的使用體驗也和系統高度統一
舉個例子
如果你有一個門鈴
一個門鎖
以及攝像頭
它們都被用戶配置作爲房間的一部分
也許用戶稱這個房間爲“入口”
HomeKit會自動關聯這些設備的不同功能
用戶能對它們進行觸控感應設置
這也讓一些神奇的用戶體驗比如豐富通知成爲了可能
比如說 現在門鈴聲響起
HomeKit會自動拍攝一張照片
用戶就會收到一條豐富通知
同時 在通知欄裏用戶還能直接進行控制
他能按下按鈕
打開對講機同來人進行對話
或者 用戶也可以選擇解鎖大門
通知欄可以實時顯示監控視頻
是的 同樣的功能也支持Apple Watch
只要點擊
表面的圖片就可以開啓視頻流
從你的HomeKit攝像頭到你的Apple Watch
當然 你可以選擇解鎖直接在Apple Watch上完成
接下來 我們來看看HomeKit框架都有哪些更新
我們想先介紹一些簡單
卻強大的應用功能升級
現在 設備的使用情境將會被反饋給你的應用程序
首先是主要功能
假如有這樣一臺設備它提供兩種功能
風扇功能和燈光功能
這就是你的應用程序顯示的結果
僅僅看着這些功能的名字你完全不能瞭解
用戶使用的是什麼設備
這是一個帶排氣扇的燈具？
或者是一臺帶照明燈的風扇？
現在 隨着HomeKit協議的更新
家居設備能夠標註出它的主要功能
這個信息會被反饋給你的應用程序
通過HMService類的isPrimaryService屬性
它會對你大有裨益
因爲現在你能
對設備進行內容感應設置
第二個例子是關於關聯功能
在這個例子中假設一臺設備擁有
三個電源插口和一個開關
現在 如果僅僅是看着它們的名字你不會明白這個開關功能具體是什麼
這個開關只控制了一個插座？或者它控制了所有的插座？
當用戶看到這臺設備
他就能知道這個開關同時控制了其它三個插座
如今有了關聯功能所有功能都能夠相互關聯
然後把它們之間的關係反饋給HomeKit
接着這個信息也會被反饋給你
所以在這個例子中開關是和三個插座口關聯的
它們之間的邏輯關係是
開關控制着三個插座
現在 對於用戶當他們看着用戶界面時
不但能看到插座設備還可以看到它們相應的狀態
它們的電源是開啓或關閉
根據和它們關聯的開關狀態來判定
第三點是有效的參數
要解釋有效參數的概念我們來看一個例子
如果我們想要建造一臺設備
假如說這臺設備是一臺空調
在我們建造的過程中
我們想要把Apple定義的參數內置到這臺設備裏
我們要爲設備選擇一個製冷狀態的目標參數
它是這樣被定義在參數表裏面的
但是我們建造的空調不支持加熱
所以這裏的heat以及auto狀態對我都是無效的參數
現在 設備可以把參數標註爲“無效”
如果Apple定義的參數表與設備的實際功能配置不符合的話
在這個實例中 這臺設備將heat和auto標註爲“不支持”
這條信息會被反饋給應用程序
通過HMCharacteristicMetadata類的Valid Values屬性
應用界面上只會顯示出有效的控制選項
這樣就能和你的設備功能完全匹配
接下來 配置HomeKit設備
配置HomeKit設備
大概是你的用戶要做的第一步了
它包括了幾個步驟
首先 你需要檢索已有的家居設備
一旦發現了一臺新設備
並且它屬於Wi-Fi網絡的一部分
或者是一臺藍牙設備並且在有效範圍內
你會收到這樣的代碼信息
在accessoryBrowser的委託回調函數下出現了didFindNewAccessory變量
一旦你擁有了這臺設備信息你就可以調用
HMHome下的addAccessory函數來添加這臺設備
但是對於一些Wi-Fi設備
若它還沒註冊在用戶Wi-Fi網絡裏
現在你還需要額外的步驟
把這些設備加入用戶的Wi-Fi網絡
你可以使用EA框架來實現
然後完成這些額外的步驟
我們認爲這不是最好的用戶體驗
所以現在
在iOS 10中我們提供了一個簡單的應用接口
用來添加和配置新設備它能完全照顧到
所有需要的步驟
來配置家居設備然後添加到用戶的網絡裏
在調用addAndSetupAccessories函數時
應用界面會引導用戶選擇相應的設備
所以在這個例子中界面會顯示出所有的設備
包括Wi-Fi網絡下的新設備
用戶可以選擇他們想要添加的設備
一旦他們選擇了一臺設備
若它並沒被註冊到用戶Wi-Fi網絡
它會被安全地添加進Wi-Fi網絡裏
接着HomeKit安全碼會被掃描
設備的HomeKit配對就完成了
然後用戶會被提示給設備命名
爲設備選擇一個房間
在這個例子中 因爲這是一個電源插座它屬於一個特殊的設備分類
所以用戶還會被提示
標註出與它關聯的其他設備
在我們的這個實例中假如這個插座與風扇關聯
所以我們選擇風扇作爲它的關聯設備
最後 用戶也可以把這個設備設置爲
他們常用設備的其中之一如此一來
這個設備的控制選項就會出現在手機的控制中心裏面
就是這樣
只需要一個簡單的應用接口手機就能引導用戶完成整個設置流程
今後所有的應用程序都會擁有同樣一致的體驗
我們認爲這能極大提升用戶的使用體驗
所以我們強烈建議大家開始使用這個應用接口
接下來 我們來談一談相機設備
相機是一種功能豐富但是操作複雜的設備
它擁有種類繁多的控制選項
相較於把這些複雜的原生功能提供給你的應用
我們提供了一種非常簡潔的方法
讓用戶使用這一功能強大的設備
使用cameraProfile對象
一個profile通常是許多關聯服務的合集
這個合集描述了一臺設備的常用功能
所以cameraProfile提供了全部的接口
讓你得以控制相機設備
一臺設備的cameraProfile變量
將從HMAccessory類cameraProfile屬性得到
一臺設備可以擁有多個攝像頭它同樣能被HomeKit控制
每個攝像頭都是cameraProfile數組裏衆多元素中的一個
讓我們看看cameraProfile具體功能
cameraProfile提供了額外的接口 它們能幫助你控制
相機的不同功能
你可以控制相機拍攝和顯示實時視頻
包括音頻流和視頻流
讓相機拍攝和顯示靜態照片
控制相機所有的設置
以及控制相機的揚聲器和麥克風設置
我們來看看HMCameraProfile類所提供的接口
首先是視頻流控制
先看HMStreamControl
HMStreamControl提供了一些簡單的函數
它們允許你啓動或者停止視頻流拍攝
在HMCameraStream下調用startStream函數
就能開啓相機的視頻流拍攝
一旦視頻流被開啓它的運行狀態會被反饋給你
使用StreamControl委託回調函數
一旦視頻流開啓
cameraStreamControlDidStartStream函數就會告知你
視頻流已經被開啓
同樣的 要停止視頻流拍攝只需要調用stopStream函數
相機的運行狀態會通過同樣的機制被反饋回來
通過cameraStreamControl內部的didStopStreamWithError委託回調函數
當視頻流被開啓時
你的應用程序能夠引用這個視頻流
使用它的cameraStream屬性
我們來看看cameraStream包含了什麼
cameraStream包含了音頻流和視頻流
所以在cameraStream類中
你能夠進一步地控制
相機的音頻設置
有了它 你既可以讓視頻流靜音
或者只允許視頻流輸入聲音或者允許雙向的語音傳遞
所以現在你擁有了視頻流你想用它來幹什麼？
是的 你想要把它顯示在應用界面上
怎麼做到呢？
非常簡單在iOS 10和tvOS 10中
你只需要創建一個HMCameraView
在這view類裏...
有一個名爲cameraSource的單一屬性
你只需要指定你的視頻流
關聯到這個屬性就是這樣
做完這些你的應用就能夠顯示實時的視頻流
在watch OS上也非常相似
你只用創建一個WKInterfaceCamera
然後調用setCameraSource函數
你的Apple Watch就能顯示實時視頻流了
所以...以上就是一些不同的對象你需要了解它們
來控制你的相機設備
事實上這非常簡單讓我們看一看這個實例
首先 我們訪問設備的cameraProfile
在這個例子中 選擇第一個cameraProfile
在cameraProfile的streamControl類裏
調用了startStream函數它會開啓相機的視頻流拍攝
如果要顯示視頻流我們將創建一個
HMCameraView
一旦我們的視頻流被開啓
它的狀態會被反饋回來
通過這個委託回調函數
我們所需要做的只是把這個視頻流指向
View裏的cameraSource屬性
就這樣
現在你的應用界面就可以顯示來自相機的視頻流了
接下來 我們來看看snapshotControl
snapshotControl接口同streamControl很相似
snapshotControl類定義了takeSnapshot函數
每當一張照片被拍攝你會被相應地告知
通過cameraSnapshotControl函數下的didTake snapshot委託回調函數
要引用最近的拍攝照片
你需要用到mostRecentSnapshot屬性
讓我們看看SnapshotControl它還有一個額外的變量
能夠告訴你相片的拍攝日期
它同時包括時間和日期
同樣 若你想把照片顯示在應用界面上
你只需要創建一個View界面然後把它指向這張照片
這裏有一個使用相機拍攝並顯示一張照片的例子
（與視頻流處理）非常相似它們的核心組件都大同小異
首先我們需要訪問cameraProfile
在這個cameraProfile的snapshotControl類裏
我們需要調用takeSnapshot函數
創建一個應用界面View...來顯示拍攝的照片
一旦這個委託函數被回調
照片的引用變量也同時被返回
我們只需要使用這個變量並把它傳遞給相機的source屬性
就是這樣
完成這些過後相機拍攝的照片就能被顯示出來
接着 我們來看看settingsControl
settingsControl包括了HMCharacteristics對象
HMCharacteristics允許你控制相機支持的所有設置
通過接口 你將能控制相機的夜視
傾斜調整 變焦 旋轉以及鏡面翻轉功能
如果cameraSupport屬性不支持其中任何一項
這個屬性就會變成nil
如果支持 你將得到全部的權限來控制相機的設置
使用你的應用程序
最後 我們來看看相機音頻控制
它允許你同時控制攝像頭內置的揚聲器
以及麥克風
同樣 我們擁有這些HMCharacteristics對象
它允許你更改麥克風的靜音設置
更改揚聲器的靜音設置
控制麥克風的增益或者控制揚聲器的音量
所有這些關鍵的應用接口都將開放給你
用來控制這種功能強大的設備
讓我們總結一下
我們今天講到了三大主題
首先 系統平臺
推出Home應用 一個Apple爲HomeKit開發設計的應用程序
遠程訪問和自動化
擴展了Apple TV的功能範圍同時還增加了對iPad的支持
以此實現了對家居設備的遠程訪問和自動化控制
我們還將HomeKit框架集成到了tvOS
下一個主題是關於家居設備
我們增加了對熱門的空氣處理類設備的支持
我們還將功能強大的攝像設備加入了HomeKit的生態系統
我們還支持了門鈴以及它相關的組合設備
也就是門鈴攝像頭
有關HomeKit框架更新
我們談到了一些簡單卻又強大的功能提升
來幫助我們得到家居設備的使用情境
因此我們可以提供內容感應界面給用戶
我們極大地簡化了新設備的配置流程
只需要調用一個應用接口
就能使用一致的系統體驗來引導用戶
完成HomeKit新設備的配置
我們還介紹了cameraProfile對象
它將允許我們的應用程序更高效地使用諸多的家居設備
在我結束之前我想請大家思考一下
HomeKit設備和你的應用程序
正在改變我們的用戶和家的互動方式
得益於Siri這樣的系統功能自動化 通知功能
再結合Apple平臺上豐富的輔助類功能
比如Voiceover等等
我們第一次使這些家用設備
讓患有各種殘疾的用戶 無障礙地使用
它的意義巨大
對很多用戶來說這都將是改變人生的全新體驗
所以我希望大家能夠瞭解這些不同的功能
它們將在Apple平臺上向大家開放
請充分利用它們來開發你的家居設備和應用程序
讓所有人從中受益
對於我們的MFi項目成員
一份更新的參數預覽將會很快開放給你們
對於新的設備製造商如果希望加入這個項目
這個鏈接會給你提供更多的信息或者請直接和我們的工作人員交談
更多關於這次HomeKit發佈的信息以及相關的參考信息
可以在這個鏈接裏被找到
這些是一些相關的演講我建議你們觀看其視頻
若你們已經錯過了
第一個尤其令人鼓舞
非常感謝大家祝會議圓滿