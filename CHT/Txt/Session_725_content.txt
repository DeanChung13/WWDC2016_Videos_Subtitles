大家好 我是Todd RitlandAirPrint工程師
和iOS首席印刷工程師
這個就是在企業中部署AirPrint
AirPrint是Apple的全方位印刷解決方案
這是一項可以幫助你創建無損打印輸出的技術
無需下載或安裝驅動程序
若你是應用開發者並想在你的應用程序中添加打印服務
請查看developer.apple.com/airprint
上面有個我之前在 WWDC 的演講
標題叫AirPrint的優勢
然後下載示例代碼就可以開始了
如果你是一個打印機製造商
或者是一個打印服務器開發者
並且想對你的產品授權AirPrint技術
請電郵airprint@apple.com
這次談話將會針對負責部署AirPrint
和想要了解更多所有的
讓AirPrint在企業環境中能很好工作的企業特點
企業的打印服務有很多特有的要求
我們企業的用戶會和一堆打印機打交道
（打印機）經常來自不同的製造商並有着不同的功能
在不同的樓層或者是不同的樓之中
還可能在不同的地點
這些也可能是非常複雜的打印機
網絡架構一般很複雜
通常他們是無線或者有線的客戶端
而且他們的網絡結構和所在建築的物理位置可能並無關聯
IT部門也會有各種各樣的網絡要求比如說禁止軟件升級
禁止組播數據包傳輸
和阻塞特定端口
這些都會影響到打印機
企業客戶也可能會有會計要求
因爲每一頁都會花錢
當然
安全性要求是必要的
而且在企業打印中越來越重要
我們從企業中收到最多的請求
是可以創建PDF
並且增加更多無紙化的工作流程
安全性
訪問控制和會計
還有更方便的找到打印機
讓我們來看一下AirPrint其中每一項上具體能帶給我們什麼
首先是從打印面板中創建PDF
Mac OS早具備生成PDF的能力
在任何地方都可以打印
而如今在iOS10
所有的iOS設備都具備了這項能力接下來我想展示下它是怎麼工作的
我現在有一臺運行着iOS 10的iPad
當我輕觸打印
我就可以用我的雙指縮放打印預覽
而且在這裏我左上角有一個分享按鈕
所有支持PDF的應用就會出現在分享菜單下面
還會有AirDrop和其他系統分享的選項
這也可在Managed Open InEnterprise功能中使用
這樣就可以把商業條目和個人條目分開
在具備3D Touch的設備上
你也可以用Peek and Pop手勢
來到和打印預覽裏同樣的視圖
我認爲企業用戶會喜歡這個新的無紙化工作流程
應用到他們所有的iOS設備中
安全性
下面是一個極其重要的話題
安全性
iOS和Mac OS上的AirPrint完全支持端到端加密法
這樣你的網絡文檔就被保護起來了
AirPrint支持最新的TLS產業標準
基於HTTP的1.2加密
這項加密技術
對於所有新AirPrint打印機和服務器是必須的
接下來 對於額外的安全措施
很多企業用戶不想打印出來的文件
呆在打印機的出紙盒裏
這樣一個人未經允許就可以拿起來查看
對於支持PIN Release的iOS和Mac OS打印機
用戶會在打印機上輸入自己的PIN
來接收他們的打印文件
在iOS上 當需要輸入PIN時
打印面板會顯示一個標籤用來解釋
當用戶點觸打印時會顯示一個提醒
輸入PIN來釋放打印任務
在Mac OS上
用戶可以輸入自己想要的PIN來釋放打印
Mac OS也支持這樣的PIN設置
當PIN是可選的打印時就不需要輸入PIN
然後是訪問控制和會計
登錄
AirPrint一直支持打印機和服務器
需要輸入用戶名和密碼來驗證身份
我們把輸入的用戶名和密碼保存在Keychain中
這樣用戶就不用重複輸入
iOS 10已支持這樣一個功能
忘記已存儲的身份驗證信息
以便使用需要輸入不同用戶名的工作流
今年的新功能還有支持僅密碼驗證
這樣打印機就只被一個簡單密碼保護起來
就像這裏展示的
會計
當企業需要把賬單
或者賬戶信息添加到每一次的打印中
iOS和Mac OS兩者都支持打印機和服務器
接受該賬戶信息
如果每次打印都需要這個賬戶信息
在打印繼續前用戶需要輸入該賬戶信息
此外對打印任務 iOS和Mac OS支持賬戶ID可選或強制
這個是Mac OS X上UI的界面
接着是更方便的找到打印機
支持的發現方式
AirPrint有很多方式來發現和使用打印機
大多數用戶使用AirPrint的主流方法是Local Bonjour
它不需要設置
打印機顯示可用 自動地出現在列表裏
不用任何設置
AirPrint也一直支持Wide-Area Bonjour
Bonjour基於DNS發現服務
並且如果使用正確記錄來配置DNS服務器
打印機也可以這樣被發現
我會示範下這個怎麼做
iOS和Mac OS現在也都支持移動設備管理
或者帶有設置好AirPrint有效載荷的MDM配置文件
iOS 10的新變化是
我們把AirPrint Bluetooth Beacon作爲發現打印機的發法
它使用藍牙低功耗信標
配置DNS服務器來發布AirPrint打印機並不難
首先 設置好的DNS服務器必須在
被需顯示打印機的iOS設備和Mac使用的DNS服務器列表裏
一共有很多種管理哪些DNS服務器
和搜索域被使用了的方法
比如DHCP和MDM配置文件
然後下一步你需要添加A或者AAAA記錄
到打印機的名字裏
和設置了靜態IP地址的打印機裏
爲主要的IPPS服務類型添加PTR記錄
還要爲通用子類型額外添加一個PTR記錄
這是AirPrint的關鍵AirPrint不僅是IPPS服務
它還有一個通用的子類型
而那就是iOS設備和Mac搜索的東西
你要爲該服務添加一個SRV記錄
然後還有一個TXT或檢測過的文件記錄
它描述了打印機的很多性能和信息
極其重要的一點是去找到
打印機或服務器的TXT或文件記錄
用Mac OS命令行工具dns-sd可以輕鬆做到這一點
想要用dns-sd找到那些記錄
只需要在你設置的打印機的相同子網下執行這條命令
使用-Z選項會以當前區域的文件格式來顯示記錄
你要應用_tcp._ipps.service類型
到本地域就像這裏以藍色顯示的部分
你會得到一個輸出包含每一個在本地被發現的打印機
PTR SRV和TXT記錄幾乎都是你需往DNS服務器中添加的
外加其他的一些補充
改變過的地方在這裏被綠色高亮
像我之前提過的你需要添加一個額外的PTR記錄
到通用子類型
就像第二行的這個一樣
你還要把SRV記錄中本地打印機的名字換成
完全符合要求的域名
我早些時候提到的A記錄
而且你還要替換
本地Bonjour實例名
使之成爲完全符合要求的域名
就像這裏顯示的帶有打印機管理員URL的綠色部分
如果這個不修好的話
用戶將不能使用Mac OS上的按鈕
快速訪問打印機的管理員頁面
這些文字
可以直接拷貝到zone file裏
這樣打印機就會出現在列表裏供用戶使用
前提是用戶把這個DNS服務器設置成他們DNS服務器中的一個
配置Wide-Area Bonjour打印機的關鍵是
藉助dns-sd命令行工具
MDM配置文件是一個很流行又超級簡單的方法
來爲你的用戶們設置打印機
AirPrint有效載荷可以被添加到任何配置文件裏
而且有效載荷包含一個主機或IP地址
還包含一個資源路徑
對於大多數AirPrint打印機資源路徑是ipp/print
AirPrint服務器也一樣這會成爲隊列
這個是Apple Configurator的截圖
最受歡迎的移動設備管理工具之一
下一個是令我們非常興奮的一項新技術
也是iOS10的新功能
它就是AirPrint Bluetooth Beacon
那麼什麼是AirPrint Bluetooth Beacon它是怎麼工作的？
它是可以被設置的很多市場上的第三方
藍牙信標設備就可以
只要在打印機附近
或者它也可以成爲打印機的一部分
用打印機自帶的無線電和天線就可以辦到
未來的AirPrint打印機就會內置這項功能
它所做的就是把連接信息發射出去
若iPhone接收到了那個IP地址
它就可以向這個打印機發送打印任務了
這個非常厲害因爲網絡的複雜性對我們無關緊要
唯一重要的是我們能收到那個IP地址
它甚至可以是網絡上的一個公用IP地址
即便遠到iOS設備藍牙覆蓋的範圍
外加可以收到那個IP地址
打印機就能出現在用戶的列表裏以供使用
而且AirPrint Beacon也可以很好和打印服務器配合運作
我們這裏有個AirPrint服務器在右邊
在網絡上的每一臺打印機都有一個AirPrint Bluetooth Beacon
正在發佈服務器的IP地址
和打印機關聯的Queue ID
當用戶開始打印打印任務發送到打印服務器上
還有相隨的隊列信息
然後服務器把打印任務發送到用戶在UI界面選擇的那個打印機
我們來細說下何謂AirPrint Bluetooth Beacon格式
這樣你就可以設置你的打印機了
首先 我們有一個header
這個用來把藍牙信標驗證爲一個AirPrint Beacon
所有的AirPrint Bluetooth Beacons都一樣
這樣我們就可以拷貝了
下一步
我們有了連接信息
它會告訴我們之後被發現的IP地址
是IPv4地址還是IPv6地址
它還會告訴我們這個IP地址是服務器的
還是打印機的
這個字節還決定連接是否用TLS加密
對於這個示例連接是TLS加密的
IP地址是一個IPv6地址
且這不是一個服務器
請瀏覽發佈在developer.apple.com上的說明
這個字節是如何設置的
接着我們有一個打印機的ID
該打印任務是應發送到打印服務器上
或者資源路徑的信息還是打印任務應被直接發送到打印機上
這個打印機把ipp/print作爲資源路徑
重複下 請瀏覽發佈的說明
是更多關於指定資源路徑的
下面我們有了連接的端口號
631是標準的IPP端口
端口443經常被用作TLS安全連接
對於這個示例
277是631的16進制也就是標準的IPP端口
下面我們有一個IP地址
如果你的打印機使用的是不可升級的外置信標
確保打印機使用的是靜態IP地址
否則這個IP在信標中一旦IP地址發生變化就會失效
最後 就像iBeacon一樣我們測好的信號強度爲1米
用的是和Apple iBeacon測量強度一樣的度量方法
這樣可以更好的給iOS設備提供關於距離打印機物理距離的信息
對於這個例子發射功率平均爲64分貝
也就是16進制的40
AirPrint Bluetooth Beacon的格式和iBeacon稍微有點像
iBeacon的格式要少一個字節
但是起始的header非常相似
如果你是根據iBeacon技術說明設置的你的設備
你有可能稍作調整並用相似的參數來設置AirPrint Bluetooth Beacon
很多製造商對藍牙硬件
會或者將會使用特定的AirPrint Bluetooth Beacon設置流程
那麼對於企業用戶
iOS和Mac OS提供很多非常好的技術來支持PDF工作流
以適應日益增長的數碼世界
AirPrint則提供了非常好的安全性訪問控制
會計和新的發現技術使打印更出色不論任何環境
老規矩 告訴我們你的意見你們的企業有什麼特殊的需求
請在apple.com/feedback上發送意見反饋
更多關於此次演示的信息
和參考數據
請查閱developer.apple.com/wwdc16/725
你可能也想知道
在Nob Hill的“Apple設備管理的新特性”會話
時間是週三上午11點
還有“獲取內部核心位置”
地點在Marina
時間是週三下午3點15分