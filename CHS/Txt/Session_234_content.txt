ResearchKit有何新特性？
早上好
早上好
谢谢
欢迎今天来此的医生兼编码员
和从事研究工作提供伟大研究应用的开发人员
当然 包括今天在此的学生
我知道他们已在用ResearchKit
欢迎你们所有人
你们想看到一款伟大的ResearchKit应用吗？
是的
好 我很高兴在昨晚的派对后至少还有部分人清醒着
Duke Medicine的Autism & Beyond
是的 我们有Duke开发商在此所以 谢谢
Duke Medicine的Autism & Beyond
是旨在识别和理解儿童发展风险的研究
在ResearchKit应用
一个年轻的孩子观看视频
前置摄像机记录他们的反应
让我们一起来看看
有一只蜘蛛爬上水管子
应用程序分析了孩子的情绪反应的视频
提取面部表情
有一天 这样的视频可能会被使用
在她自己的家的孩子的自闭症
和其他心理健康的问题 如焦虑
如果研究成功了
Duke将能够使用科学为基础的工具帮助家长了解
支持孩子的成长
我认为这是很神奇的
它只是去年开发的许多应用程序之一使用ResearchKit的应用
今天 我和同事Yuan Zhu希望我们可以激发你们
创建另一个同样伟大的ResearchKit应用
今天我们将ResearchKit新特性
我们将谈一点
从开源社区以及你如何贡献
但首先我想先回顾一下ResearchKit
一年多前推出ResearchKit
其目的是采取基本临床研究的组成部分
并将他们转移到移动世界
这些基本组成部分都是需要知情同意
调查任务和主动任务
考虑到iPhone的数量很惊人
在世界范围内 像你我这些用户可以研究做出贡献
但有一些显著的差异
临床研究和移动世界
特别是在临床研究
参与者就在那里
研究人员可看到并告诉他们要做什么且和他们在一起
所以当你移动到移动空间有一些事情要考虑
我想每个组件并向你展示ResearchKit怎么工作
知情同意
知情同意是必要的对于所有使用人类主题的研究
研究人员需要告诉参与者是什么研究
他们要收集的数据他们将如何使用这些数据
他们将如何确保隐私怎样的人可以拿走研究
和许多其他事情
所以通常像在Autism & Beyond研究中的人
会得到这样的一个内容
这是相当长
因为如果你把它端到端的它会比我高
所以这是一个很多人需要通过文本
所以这个叫做ResearchKit
我们开发了一个知情同意书模块
我们所做的是把这个大的形式分割成一系列的屏幕
在每一个屏幕上它描述特别部分
给出了一个概述提供了一个学习更多的链接
若参与者希望的话 他们可以向下钻并获得更多的信息
他们可以在这里撤回信息
然后在一切结束时都被放到一起给出最后的评论
然后用户可以决定参与研究与否
如果他们决定参加这项研究
然后他们会被要求提供他们的名字签署电子同意书
正如我们最有名的用户Johnny Appleseed在此做的
现在我想指出的是
若你是一个开发人员做第一个ResearchKit应用
你不能只是在这里剪切和粘贴本文Duke或者其他研究拥有的
知情同意书文本批准
通过一个机构审查委员会或伦理委员会
你需要使用他们给的文本
而你也必须抵制成为一个有创造力的作家的冲动
而且喜欢 你知道我看这些东西和思考
我可以简单地说我可以让这个变成非常激动人心的阅读
但你不想这么做
你想得到研究员给你的东西并确保它已被批准
这就是知情同意书
在临床研究中
研究人员通常有一个参与者
至少做一个调查 如果只要求人口数据
但这也是很常见的研究使用像这样的标准调查
病人健康问卷或PHQ-9
现在很容易将一篇书面调查变成一个移动的调查
ResearchKit试图使这一点更加优化
在大多数情况下 每一页有一个问题
当然 我们可以支持任何书面调查
比如填空 多项选择
但因为移动ResearchKit可以做的更多
你可以选择
它可以有一个真正的滑动在那里你必须滑动你的手指
你可以位置作为一个答案或日期和时间或图像
ResearchKit有许多丰富的回答格式
好 日期现很适合我
所以这是我们的调查任务
现在活跃的任务
在临床环境中的参与者可能被要求做一些事 像散步
因此研究人员可以观察他们的步态
或者解决一个难题或讲一个故事作为心理学研究
甚至他们可能被要求做的事情如需要精细动作协调
在临床上有人来告诉你怎么做
并确保你做的正确
所以我要告诉你两个任务这样你才能知道
ResearchKit如何处理主动任务
首先是一个语音任务
这里的参与者被要求对着麦克风说“啊”
然后应用程序收集音频
并以任何适合于特定研究的方式分析
因此本课题的所有组件可以在一个主动任务
让我们通过他们
有一个页面描述任务是什么
这给用户说明如何执行任务
很多主动任务有一个倒计时
然后反馈给用户
在这种情况下 这是说她太大声了
这样可以确保你正确地完成这项任务
所有你看到的屏幕 动画该屏幕导航
都由ResearchKit提供
为得到该任务 只需使用ResearchKit 就这么简单
这里还有一个任务
这是一个点击速度的任务用户需要来回地敲
在一个给定的时间内以最快的速度
但ResearchKit也有许多其他的任务 包括行走任务
空间记忆任务 还有其他一些
所以这些都是主动任务
从ResearchKit发布第一天开始
就与HealthKit合成
它很容易在Xcode添加HealthKit的权利给应用程序
它不需要太多的代码行得到这样的屏幕
在那里你可以询问用户要获得在HealthKit的数据
当你这样做时你需要指定所要的数据读和写的健康应用程序
用户可以选择提供你所需要一切的权限
或者她可以给你特定的许可
所以我建议当你要请求访问数据的时候
你只询问绝对在研究中使用的数据
所以不要请求一切
你将更容易得到用户的许可
过去一年间我们被问到的大问题之一是
ResearchKit对数据做了什么及数据存放何处
这对我来说很容易回答因为ResearchKit不对数据做处理
若你出席去年的ResearchKit演讲
John Earl解释的ResearchKit架构
他还谈了很多结果对象
简单地说
ResearchKit在任务视图控制器上有一个结果属性
它会将该属性的结果交给你
但取决于你的应用程序来维持本地数据
同时也为研究将数据发送到安全服务器
在那里你可以汇总和分析
如果你没有看过John Earl去年的演讲
我建议你去看
因为在里面他也展示了如何编码知情同意
调查任务和主动任务
今天我不会将编码重复一遍
因为你们可以观看视频
我想邀请同事Yuan Zhu上台
详细介绍ResearchKit的新特性
并向你解释如何使用它们来编码
Yuan
谢谢你 Bunny
开源社区发现移动研究需要更多的特性
与研究提供的相比
我们一直与社区合作
为ResearchKit添加更多特性
所以今天 我真的很兴奋向你们展示三个特性
首先 分支任务
在书面上可能会费解
但在移动设备上这是真的为用户而设
第二 应用程序访问
它保护用户的隐私和数据
这对于大部分的研究应用很重要
最后 图表
以视觉方式将数据呈现给用户
然后你的用户可以更好地理解数据
首先 我要谈谈第一个分支任务
你的应用程序是否给予指示
提出一个调查或运行主动任务
一切在ResearchKit是一个步骤的集合
共同构成一个任务并可以将任务提交给用户
有了这个模型创建一个线性任务相当简单
但分支任务如何创建却没那么明显
让我给你展示一个例子
你在这里看到的是一项有三个问题的调查
显然 问第二个问题是有意义的
对于回答“是”的用户
回答第一个问题 你有车吗
以及最后一个问题你拥有自行车吗？
应该是最后问
无论前两个问题答案如何
你可能想知道我是如何在ResearchKit创建这项调查
为了帮你 我给你介绍一个新类
ORKNavigableOrderTask
因为这是一个任务所以它有一系列步骤
但除此之外 它还拥有集合导航规则
导航规则定义了任务中的分支逻辑
下一步我要向你展示如何使用这个新类
来呈现调查
它真的很容易使用
在代码中 首先我需要创建问题的步骤
一旦我有问题的步骤
我可用这些步骤创建可导航的命令任务
正如你所看到的这和创建一个线性任务一样容易
但之后 我需要为它创建导航规则
我想在此创建的导航规则
是展示拥有自行车的问题
此后紧接着是对于没车的人
我想让你知道导航规则有三个要素
首先 触发步骤
它触发了要被评估的导航规则
第二 预期的答案
对于第一个问题 我们有一辆车吗这里我们的答案是“否”
最后 它需要一个指定的步骤
现在你已学会了导航规则中的三个元素
闲杂让我给你展示代码
在代码中 首先我用resultSelector
定位结果所在处
然后我以预期的答案为基础创建predicate
有了predicate后我可以创建导航规则
与目标步骤
最后 我会添加第一个问题你拥有车吗
作为触发步骤
正如你所看到的
这是很容易的一 二 三我创建这个导航规则
而且任务已经准备好向用户展示
现在你已经学会了如何使用分支任务
下一步 让我向你们展示应用程序访问
用户帐户是应用中管理用户非常重要的方面
应用程序访问提供了这项必要功能
在应用程序中支持帐户的两个基本操作
帐号注册和帐户登录
帐户注册允许你的用户登录注册你的应用程序
通过密码和用户名
注册用户可以使用帐号登录
继续参与到你的应用即使在新的设备上
这就是帐户
你可能知道
对于大多数研究应用用户的隐私和数据的安全性非常重要
为了帮你做到这点我们建议你的应用允许用户
设置一个密码[听不清]
然后使用它来解锁你的应用程序
这里有两个基本密码运算
首先 创建密码
它让用户选择理想的密码
一旦密码被创建然后应用可以帮助用户
输入正确的密码进入应用程序
使用密码认证
现在你们已经学会了应用程序访问有两个部分 帐户和密码
首先让我向你们展示帐户
这是帐户注册的截图
它让用户通过提供邮箱地址来注册你的应用
两次输入 避免输错
下面 我将向你们展示如何编写此代码
我只需创建一个步骤ORKRegistrationStep
具有标识符 标题和文本
最后一个参数选项可以用来提供
额外的输入字段如性别或出生日期
这一步一旦完成我可把它放入任务并展示它
步骤完成后
我需要从对象结果里检索用户名和密码
这很容易
我只需使用预定义的标识符来获取它们
一旦我有了用户名和密码
我可以安全地将其发送至远程服务器
创建用户帐户
这就是帐户注册
接下来 帐户登录
对于已注册用户想继续使用你的应用
在这里可以看到一个帐户登录截图
它允许用户通过用户名和密码来登录
此外 如果用户忘记他的密码
在底部有一个按钮
我们只需几行代码就能在你的应用中创建这个
同理我们要一步ORKLoginStep
我通过标识符、标题和文本创建这一步
你可能注意到我需要提供一个ViewControllerClass的最后一个参数
为什么？
因为我需从ResearchKit中将视图控制分子类
提供我自己的自定义忘记密码行为的处理程序
万一用户忘记密码 点击那个按钮
我这样做之后
然后该登录步骤就会呈现
现在我展示帐户注册和帐户登录
接着 让我展示你的用户如何创建帐户
创建密码 然后用它来解锁你的应用
在密码创建过程
用户将被要求先输入密码
然后确认该密码
（可选）若设备已启用Touch ID
用户之后可选择使用Touch ID来解锁你的应用
在这里看到几个步骤但在代码中 很容易做到
同样 我需要一步ORKPasscodeStep
创建之后我建议你为用户提供解密文本
解释设置密码的目的
这就是我需要做的一切
你们中的一些人可能想问
密码被存储在哪里
好问题
让我来展示一下
从这个图表中 你可以看到
密码被存储在iOS的钥匙链因此是安全的
也告诉你密码编写和密码读取
都由ResearchKit管理因此你根本不需要担心
是不是很酷呢？
-是的-谢谢
学会这个后让我展示一下密码身份验证
密码认证允许用户
输入正确的密码在访问该应用之前
让我给你们展示代码
我只需要一个视图控制器
我可以很容易地创建该视图控制器
我也需要记住最后给它指派一个代理
接下来我将展示如何实践此代理
密码认证的视图控制器代理
给开发者提供了机会
处理可能身份验证的不同结果
例如 如果密码认证成功
我可将该功能呈现给用户
但如果密码验证失败
我要显示警报
或是取消密码认证
我可向用户显示默认的欢迎屏幕
所以就是这个代理
而且这个新控制器已准备向用户显示
现在我已经向你们展示了应用程序访问的所有部分
我希望你们觉得有用
我可以给你们看看图表
有了图表 你可以向用户呈现你的数据
在ResearchKit中有三种类型的图表
从这些截图中你可以看到
有饼图 线图和离散图
让我们将第一个放大 饼图
饼图[听不清]环并且分为段
其中每一段代表整体的一部分
每一段都有其自身的数值 颜色和名称
一旦你学会了饼图的基本知识
我可以向你们展示其背后的代码
要编写代码 首先我需要创建pieChartView
然后我将分配一个数据源对象给它
因为数据源对象提供图表中
显示的所有信息
现在我需要实践这个数据源
但在我提到这些函数前
首先我需要花一些时间建立数据对象
为了做到这些我首先定义一个基本结构
携带图表中每一段的基本信息
从这里你可看到我用标题 数值和颜色来定义基本结构
所有需要的基本信息
完成后 我可用那些结构创建数据对象
接着 我会把它们放回函数里
因为我已经准备好了这些对象
我可以很容易地创建函数
首先 我返回段的总数
然后我返回每段值
和将计算环中比例使用的值
之后是颜色和标题
完成后
然后这个饼图就能显示了
现在你们已学会了如何使用ResearchKit创建饼图
线图和离散图的使用很相似
你只要上GitHub网站就行下载我们的简单项目来学习
你可以看到屏幕上的URL
分支任务 应用程序访问和图表是三个新特性
今天我向你们介绍的
有了它们 我相信你会发现做一个研究应用程序将更容易
现在再次有请我的同事Bunny
谈论对ResearchKit作出贡献
ResearchKit如此多新特性的原因是
是因为我们的开源社区
我们的许多贡献者今天在这里我想感谢他们
但任何人都可以和我们一起工作让ResearchKit更好
让我来告诉你如何实现
对ResearchKit作出贡献
就像对任何其他开源项目作出贡献一样
去我们的GitHub报告
选择或打开一个问题请给我们留言
让我们知道你在做什么
然后提交一个拉出请求
Apple的工程师和活跃ResearchKit社区成员
将看看你的代码
毫无疑问 他们会有一些关于如何改进它的建议
所以我们想让你和审查团队一起工作直到每个人都满意
然后你的修改会被合并进入主分支
有时我们会分支合并
在那个时候你的代码将被本地化成iOS支持的所有语言
可访问性的更新
并各种设备和方案上得到测试
我们也会从隐私和安全角度看你的代码
现在这个开源过程对你而言可能有点以Apple为中心
但我们要确保你的代码可以在世界各地使用
被不同能力层面的用户使用
在一系列设备上使用
所以现在你们知道如何贡献
你们中的一些人可能已有贡献的想法
其他人也许还没有所以我想给你们一点灵感
但在我做此之前我们先在某个点标记一个新的稳定版本
我们的最后一个稳定版本是一月标记的Win.3
好的 你能做什么贡献？
当然你能贡献主动任务
我已经展示了一些
今年我们已经有了一个NHPT测试
我要感谢Julian Therrier为此作出的贡献
这个任务应该是一个数字版本
在诊所为康复医学做的一个测试
测试上肢功能
现在 这项任务正在进行研究的验证
因为我们不知道这个数字版本是否
与诊所的版本等效
所以验证是非常重要的
当你开发一个新任务
研究人员想知道你所说这项任务测量的对象
确实是这项任务测量的对象
因此你可能需要参与验证研究以证明这点
河内塔是心理学研究中常用的一个难题
我要感谢James Cox对此的贡献
我相信还有很多其他任务
事实上 研究人员经常给我写信
并说他们喜欢 比如Stroop
这是颜色测试或精神运动警觉任务
所以若你问研究人员你会发现还有很多其他任务
我相信你们能开发这些任务
我确定除了ResearchKit还有许多其他答案格式
我要感谢Quintiles给我们位置答案格式
正如你们从Yuan这里获得的信息
ResearchKit的基础就是一步
总有更多的步骤有待贡献
我想再次感谢Quintiles贡献了等待一步
这一步已证实是非常重要的
当你在做一个非常冗长的计算时
你想把结果给用户
在他们继续任务中的其他步骤之前
功能模块封装件有助于研究人员
Yuan刚向你们展示了图表模块
这是一项伟大的贡献
感谢Ricardo Sanchez和James Cox为此作出的贡献
几乎每个新ResearchKit应用都使用该模块
事实证明 用户喜欢看图表
获取他们的研究数据和进度以及有关研究的东西
条件的遗传学基础是许多研究人员的兴趣所在
现在有两个关于遗传学的ResearchKit应用
PPD Act正在寻找妇女产后抑郁症的遗传基础
MyHeart Counts最近增加了遗传因素
以便他们研究遗传学中的心血管健康
事实证明 若你想收集某人的遗传物质
有一个知情同意的过程
这超越了你的应用程序所需
因此我想感谢23andMe
提出ResearchKit模块展示了如何做...
在知情同意的情况下
而现他们在自己的网站上放着
若你想用23andMe收集遗传数据
你可以去他们的网站获取这个ResearchKit模块
很棒的是他们有完整文档
记录如何将该模块添加到你的应用
以及你的应用中需作出的调整
为了确保该模块顺利运行
我肯定还有其他你们可以贡献的模块
正如之前提到ResearchKit不用你的数据做任何事
所以你需要将它连接至数据服务
若你是提供数据服务者
我建议你下载我们的示例ORKSample
对其进行修改并使用你的数据服务
然后在GitHub repo上放置调整后的应用
人们可以去那里看看
如何将自己ResearchKit应用连接到你的数据服务
这将对研究人员有很大的帮助
那些正努力试图把这些数据连接到服务器的研究人员
所以在你已贡献出这些代码后也许你想做更多的贡献
我可看到你们中的一些人
若你最近去过ResearchKit.org
你会看到我们将一些教程置顶
一些开源社区写的教程
具体地说我要感谢[听不清]在法国的博客
与Raywenderlich.com网站
我们喜欢看到开发者教其他开发人员如何编写代码
如果你是这稀有的群体之一知道如何编写代码和写教程
请在ResearchKit找个你认为需要解释的主题
写一个教程然后告诉我们 我们会帮你传播
现在ResearchKit社区一直忙于写作 Apple亦如此
我们已经更新了ResearchKit编程指南
以及今年早些时候的参考文档
我们还为iOS Human InterfaceGuidelines增加了一个章节
指导如何写一个好的ResearchKit应用
如果你还没有读过 请尽早阅读
我有一些作业布置给你们
这是你们的行动号召
若你还没下载ResearchKit框架 请今天下载
你会获得Yuan提到的所有伟大的新特性
在框架内 你会看到样本文件夹
在那里面有个ORKSample应用我们今年补充的
我建议你构建并运行它这是一个很好的应用
在Swift里
它不仅对Swift和ResearchKit使用最佳实践
而且对于iOS也如此
对于ResearchKit应用它有很大的体系结构
你甚至可从那个应用开始
你的研究将会有一个很好的开始
另外构建和运行ORKCatalog应用
正如其名字所暗示它是ResearchKit功能目录
当你运行它时你会看到每个主动任务做什么
你会看到所有的答案格式
你甚至可以看到资格调查是什么样的
最后 请做出贡献
ResearchKit是开源的它将变成什么取决于你对它做了什么
开始ResearchKit所需的一切
都在这页上developer.apple.com/WWDC16/234
有GitHub repo的链接
教程的链接 文档的链接
所以请看看吧
今天下午我想你们来参加“开启CareKit”的演讲
CareKit是一个新的开源框架我们在3月份推出
这将帮助你建立好的应用为人们管理自己的护理
所以 谢谢大家希望各位在余下的WWDC过得愉快