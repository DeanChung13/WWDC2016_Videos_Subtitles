Game Center的新特性
大家早上好
谢谢来这里
我是Megan Gardner我是Game Center软件工程师
今天我们讨论Game Center的新特性
若你还不知什么是Game Center
Game Center是Apple社交游戏网络
它允许开发者定义排行榜你的用户可以向它提交分数
还定义你的玩家可以获得的成就
我们还有挑战
它利用排行榜和成就
来添加多人游戏元素到你的单人游戏
我们还有两个多人游戏API是实时的和基于回合的
iOS macOS和tvOS上都可以使用这些功能
今年我们宣布了watchOS
那么有什么新特性？
我们今年有一些新东西
首先我们有一个很好的发送多人游戏邀请的方式
接着我们有Game Center应用的大新闻
如果你们已经发现了
我们有全新的API
针对持续游戏会话我们对此感到兴奋
我们宣布Apple Watch支持
我们没时间在本次演讲谈论Apple Watch
但如果你对这感兴趣
我强烈建议你去
看Apple Watch游戏技术在这间房间 今天下午晚些时候
让我们谈谈基于消息的多人游戏邀请
现在你可以和任何能发消息的人一起玩
我们的Game Center多人游戏看起来像是这样
这是我们的GKMatchmakerViewController
你们中的大多数用它来设置你们的匹配
这是我们完成的内置UI
它允许你的用户邀请他们Game Center好友
和使用自动匹配的立即游戏功能
你们中的一部分实现了GKMatchmaker
这是我们的编程API
它允许你实现你自己的UI并设置你自己的邀请
但若你一直用GKMatchmakerViewController
现在它看起来是这样
这是我们新集成的消息视图控制器
你会注意到一些区别
没有气泡但这不是最重要的部分
现在它直接和消息集成
这允许你的用户可以发送消息
给联系人里的任何人
然后可以和他们一起玩游戏
让我们看看它是什么样子的
这是Doodle Jump中的多人游戏视图控制器
你可以点击立即游戏并且自动匹配会和以前一样工作
然而我们对点击邀请好友时会发生什么更感兴趣
这会带来这个新的消息视图控制器
你可以看到我们有这个漂亮的富链接
在角落里有小的Doodle Jump图标
我添加了一点文本来告诉你的用户
关于这个链接会让他们做什么
这完全基于iCloud技术
所以你的所有用户需要登录
iCloud使它能够工作
你可以在收件人域里开始输入
这会用联系人自动完成或者你可以键入
一个电子邮件地址或者电话号码属于你知道的任何人的
或者你刚刚见到的任何人
或者你可以点击加号按钮这会带来联系人
这是我的所有联系人
我有他们的消息信息
你在中间还能看到一个最近标签
这里会有你的Game Center好友
以及你的用户最近在GameCenter里一起玩过游戏的人
附近的功能是同样的
在本地网络中查找玩家
也在玩同一个游戏的玩家
所以我会点击Alisha 邀请我的朋友Alisha一起玩
然后点击添加
会把她填入收件人域
然后你可以这和消息的功能是一样的
这基本上就是消息UI
你的用户可以添加额外的文字然后这会被发送到所有这些玩家
若我点击一个Game Center玩家
他们的名字会被显示成灰色
他们会收到Game Center通知
他们不会得到一些奇怪的GameCenter iMessage
它会做为通知进入所以如果我们点击发送按钮
这会被发送给Alisha
在Alisha的屏幕上看起来是这样
她可以点击链接来接受邀请
这会直接把她带入游戏
并开始连接
就像她点击通知会发生的事一样
我们还有的功能是如果她没有Doodle Jump
这会把它带到商店她可以下载
并玩游戏就像她可以在通知做的
我说过我们不需要做什么
来实现这些
我们只替换了视图控制器
所以如果你一直在用这个视图控制器
那么你已经能够得到这些功能
一旦iOS 10发布
你的所有用户都能这样做来邀请他们知道的任何人
他们不再被限制在Game Center好友中
然而我们有一个东西如果你想你可以定制化
那就是富链接图像
就在这目前是Game Center图标
如果你想把这换成一些别的
你觉得更适合代表你的游戏
或者更适合用来表明这是一个游戏邀请
或者一个有趣的事人们会想点击它
那么你可以...
你要做的是添加这个文件GKMessageInvite到你的程序包中
用同样的方式然后我们会提取它
如果你想要定制你的通知声音
我们也可以提取它并定制你的富链接
这和Safari使用的富链接技术是相同的
所以这被用来使用各种各样的图像
这对Game Center好友说明什么？
我们不再需要好友因为我们可以和任何人一起玩
所以我们会冻结好友列表
但是你仍然可以查看任何你的Game Center好友
在最近玩家标签页中
你还是可以获得好友好友还是存在的
我们不是要删除他们他们还在那
但是你将不能发送 接收 回复
任何好友请求因为
GKFriendRequestComposeViewController现在被弃用了
它也并没有被使用很多
这对Game Center应用意味什么？
如果你下载了包围这款游戏你可以注意到一些改变
Game Center作用是什么？
在iOS 9中它被用来管理你的帐户
管理你的好友
你可以浏览游戏列表你可以查看你的排行榜
查看你的成就和挑战
发送挑战查看你的回合
但是这些你都可以在系统的其他部分里完成
更重要的是在你的应用中
所以我们移除了Game Center应用
那我们在哪做那些事？
要管理你的帐户你可以在设置里这么做
如果你想要管理好友你仍然可以在设置里这么做
要浏览你的游戏我们有App Store
你可以看你的主屏
你查看排行榜 成就和挑战从GKGameCenterViewController
如果你不用这个视图控制器你可以有你自己的UI
如果你现在没有
在你的游戏中显示挑战或者排行榜和成就
我们强烈建议你从现在开始这么做
你还可以查看和进行你的回合从GKMatchmaker...
GKTurnBasedMatchmakerViewController
所以我们移除了这个应用
所有功能都存在在其他地方更重要的是在你的应用里
我们想要我们的用户花费
你的用户花费更多时间在你的应用中
我们有手机的其他部分我们不需要他们的更多时间
所以我们移除了这个应用
让我们谈谈会话
这是我们全新的API我们对它感到很兴奋
这是一个全新的多人游戏方式
所以Game Center多人游戏它现在看起来是什么样子？
我们有两个主要API针对实时和回合制
实时会连接两到四名玩家
这些连接要求立即握手
如果任何人离开连接整个连接都会失去
你只是来回传送数据
游戏一结束那些数据马上消失
回合制可以连接16名玩家
我们有一个很正式的API来传递和交换回合
你需要遵守这些规定
你需要确保你的游戏适合那个结构
所有游戏被保存在Game Center服务器中
直到它们过期
什么是会话？
会话是我们新的基于iCloud的多人游戏
我们有通用接口来保存和共享游戏数据
这是一些易于分享的小的数据
人们可以分享给他们想一起玩游戏的人
这是一个完全灵活的游戏结构我们不强加任何东西给你
你可以做任何你想做的
我们有非常稳定可靠的实时流你可以在会话中建立
这允许你和任何人一起玩
一个会话看起来是怎样的？
我们有两个主要的东西
我们有游戏数据可能是更重要的部分之一
但是还有同样重要的就是玩家
这就是你所需的全部
你得到一个会话所需要的全部基本
是一个玩家和一些游戏数据
你可以有多个玩家
如果你想和其他人一起玩这很有用
我们还能在那些玩家间发送消息
这些消息会做为Game Center通知到达
你可以有那些消息在玩家间来回发送
或者多个玩家可以同时群发消息
和这些消息一起的我们可以加角标
所以你可以发送这些消息并给那些玩家加角标
让他们知道会话中发生了一些事
他们可能需要处理
现在我只显示四个玩家
但是在一个会话中我们可以最多有100个玩家
比以前能有的多了很多
我们能有多个不同类型的会话
你可以有只有一或两个玩家的小型会话
你也可以有4个 100个 7个玩家
那些玩家可以被分到不同组中
所有这些会话可以同时运行并且你的玩家可以
同时在所有不同的会话中
我们还有实时流如果你在会话中
你想要快速在不同玩家间传送数据
那么你的玩家只需要设置他们的连接状态
我们会在后台建立管道
这允许玩家开始互相通信
让我们进入实际的API看看一个会话是由什么组成的
我们有一些类我们有GKGameSession
它允许你的玩家和会话数据
以及其他玩家互动
我们有GKCloudPlayer是会话中的一个玩家
GKEventListener帮助你知道发生的重要事
在你的玩家所在的任何会话中
我们还有GKGameSessionError
给你更具体的错误
当你和会话一起工作时有可能遇到
让我们谈谈GKGameSession
这是你主要的驮马
每个会话的几乎所有工作都是在这完成的
它基本上允许你做任何事你可以创建一个会话
离开会话 载入和保存游戏数据
分享会话
添加和删除玩家
查看谁正在玩发送通知
设置和清除角标
加入流在那些流上发送数据
基本上你将要做的所有事都需要和GKGameSession互动
关于它的更多细节
你可以最多储存512KB的游戏数据
数据会被储存在用户的iCloud上
这不是关联到你的游戏用户会在其iCloud上有这些数据
这会计入他们的iCloud限制
它会遵守CloudKit惯例
关于谁拥有那些数据数据是怎样分享的 隐私
当数据被删除时发生了什么
消息和角标 像我说过的Game Center通知一样进来
它们被这样加角标
现在可以更直接地控制角标
被你 作为开发者
我们会更深入一些
但是角标数字来自哪里会很清楚
而且你应该能够理解它为什么是这样 它是什么 并能改变它
成为任何你想要的
我们还有这些实时流
利用已有的Apple基础设施
这和FaceTime和iMessage运行在同样的技术上
所以它很强大 稳定它被建造来处理大量数据
所以若我们想要创建一个会话我们需要做什么？
首先我们需要一个标题用来描述这个会话
你可以定义它或者从用户那得到它
你需要容器标识符
你为你的应用设置的iCloud容器
并且设置一个可以在多个应用之间使用的容器
如果你想多个游戏可以访问相同的数据
比如你有免费版本和付费版本
或者你的游戏的其他版本如果你的设置正确
他们仍然都能访问相同数据
你还可以设置流玩家的最大数量
有一个硬限制是最多16名玩家可以在一个实时流中
但是如果你想要使它更低或者不同
你可以在创建会话时降低限制
但是你需要在创建时决定它
然后你用所有相关信息调用createSessionInContainer
它会给你一个会话你可以开始操作和使用它
你需要对会话做的第一件事
是找到如何保存和载入你的数据
任何会话中的玩家都可以访问那些数据
这只是一个每个人都在使用的二进制大对象
还有一点会话的元数据
帮助你避免和解决冲突
那是最后修改日期和最后修改玩家
这样你知道谁最后修改了它
它是否对你很重要需要保存
或者你的数据很有可能是最新的
你可以调用loadDataWithCompletionHandler
它会把数据提供给你
你可能还想保存数据
我之前说过 512KB
但是你可以对那个数据做任何你想做的
它可以是任何东西只要在大小的限制内
以completionHandler来调用saveData
如果有冲突
如果其他人在间隔里进行了保存
你会得到错误和冲突的数据
我们等会会谈到更多关于这的内容
任何时候有人保存数据
会伴随一个事件监听器
如果你设置事件监听器来监听一个会话中的玩家保存数据
那么你会知道什么时候其他人保存了数据
这样你很有可能需要更新和解决
数据的任何本地冲突
像我说的保存冲突可能发生
这发生在两个玩家尝试在几乎相同的时间保存数据
因为没有正式的经过一回合
很有可能两个玩家在同时进行了一轮
如果你是这么设计和实现你的游戏的
假设我们有玩家2和3都在同一时间保存
他们中的一个会赢我假设是玩家2
这表明当玩家3尝试保存时他会得到一个错误
而且冲突数据会被返回
现在你需要找出如何解决这个冲突
因为我们没有指定数据格式
我们也不知道数据的意思
所以你需要自己设计数据结构
用一种方式使你容易
找出那些冲突是什么并解决它们
然后重新调用saveData
使那些数据被保存
如果你不重新调用saveData你的数据不会被保存
你需要继续调用saveData
直到不返回冲突
然后所有东西都是最新的
所有东西对你的用户都是一样的
然后你可以继续
然后每件事都很完美
我们已经谈过了多人游戏你怎么获得
额外的玩家到你的会话中？
任何在会话中的玩家可以邀请其他玩家参加
你会获得一个URL你需要把它发给其他人
你可通过iMessage 电子邮件Twitter Facebook发送它
打印 粘到一颗树上这可能不是个好方法
但是只要你把这个URL给其他人
他们可以点击它然后可以加入那个会话
最简单的方法是通过分享表
因为它就在这弹出然后你可以发送消息
这可能是最简单的这么做的方法
如果玩家1
如果他从会话中得到URL
他们用分享表设立iMessage
来发送给玩家2他们添加了一些文字
“嘿 你想和我一起玩吗？”结果是这个iCloud URL
它会被发送给玩家2他们会点击它
一旦他们这样做玩家2就加入了
为了获得这个URL
你只需要调用getShareURLWithCompletionHandler
它会给你一个URL你可以对它做任何你想做的
然后无论何时一个玩家加入了会话
事件监听器didAddPlayer将被调用
这会让你知道其他人加入了你的会话
并且相应地继续进行游戏
我们一直在说玩家他们到底是什么？
我们有GKCloudPlayer
这和你以前使用的GKPlayers不同
GKCloudPlayer只在会话中使用
它有两部分数据
一个对你的应用来说独特的玩家标识符和显示名字
这是用户想用来显示的名字
这完全不是一个GKPlayer对象
如果你尝试把它用于排行榜或成就
其他多人游戏 或任何事
它并不工作所以请不要这么做
每个人都会很失望
所以怎么获得我们的云玩家
我们可以获得当前登录的玩家
会话中的大部分都会从你的当前玩家中被调用
虽然并不需要确保你有这个玩家
你说 哦这个玩家正在保存数据
这些都在后台为你处理了
但是你可能想知道谁拥有会话？
你可能想知道如果会话被删除了
如果其他玩家拥有它
这将会删除每个人的数据
你可能还想要清除你的角标
发送消息知道更多的这些
你还可以获得会话中的其他玩家
这只是会话的一个属性
这是你把消息发送给其他玩家的最好方式
特别是设置和清除角标
说到消息和角标
让我们谈谈那些
这些消息我们称之为消息
但它们作为Game Center通知传入
像我说的 所有玩家都可以发送消息在任何时候给任何玩家
这些消息很容易本地化
你还可以和消息一起发送一点数据
如果有相关信息
你可能想传给其他玩家关于这个消息是什么
或者有什么特殊的东西是他们应该看的
并且你还可以选择性的给消息接收者加角标
这样任何收到消息的人也会收到一个角标
和消息
那代码是怎样的？
sendMessageWithLocalizedKey你有了所有参数 发送给谁
你是否想给那些玩家加角标
被调用的事件监听器是
会话didReceiveMessagefromPlayer
会在任何一个通知到达时被调用
让玩家知道有东西到达
他们可能想知道或处理
角标
我说过角标可以被包括在消息中
基本上任何时候你发送一条消息
你可以为那名玩家启用角标状态
你每个会话获得一个角标
这表明是否有事需要你来处理
这些角标可以在任何时候设置和清除
所以如果你发送一条消息然后
像是 嘿我在游戏里需要帮助我们正在做这件事
然后没有人出现你可以清除角标
像是 没关系 我不想和你说话
所以你可以保持所有数据相关并最新
应用图标会显示总计数
如果你有三个会话并且都有角标
应用图标会显示3
如果只有一个有角标图标会显示1
我们会帮你合计它们
但是会话设置角标是基于什么应该很清楚
角标数字来自哪
所以让我们谈谈管理会话
我们创建了一个会话我们保存了它 我们载入了它
我们载入了数据我们把它发送给一些玩家
你的用户关闭了你的应用他们完成了一些别的事
你回来你想要载入那些会话
并确保你获得所有相关数据
这样他们可以再次开始游戏
你要做的第一件事是调用载入会话loadSessionsInContainer
这个容器和开始的应用容器是同一个你在里面创建了会话
这会载入准系统数据
为你的本地玩家参与的所有会话
然后根据那些数据
你会想要找出你要载入哪个会话
会话有两个主要部分用来识别它
一个是你给我们的标题但是标题并不是独特的
你可以用任何你想用的
所以这不足以用来载入一个会话
当创建会话时我们会给你一个标识符
你要用它来载入特定会话
调用loadSessionWithIdentifier这会给你会话的所有信息
包括你需要知道的所有事
用来开始载入数据
发送消息给其他玩家继续游戏
你可能会想删除会话
如果你调用removeSessionWithIdentifier
这和我们刚刚说到的是同样的标识符
如果玩家不拥有会话
这只会把他们删除出会话
并不会删除任何数据
但是如果你删除那个玩家创建的会话
这会删除数据
不仅仅是对这个玩家而是玩家中的所有人
这时你可能想看看谁是本地玩家
找出他们是不是要对每个人这么做
也许发送
警告给用户 嘿你会为每个人删除它
这样他们知道他们是在做什么
任何时候一个玩家被删除了
事件监听器didRemovePlayer会被调用
这样你就知道有人离开了
你可以相应地继续更新你的游戏
让我们谈谈游戏会话流
这是会话中的实时元素
目前为止的其他内容听起来都是基于回合的
你保存 发送消息
我们还可以在游戏中有实时元素
游戏会话流
你可以连接当前在会话中的任何玩家
每个在会话中的人
如果他们愿意开始互相发送数据
这是你如何这么做
你可以查看会话中任意玩家的状态
你可以发送数据给所有玩家在你建立的连接上
你还可以添加和删除玩家而不需要重新开始连接
你可以让一些人参加
两个人在玩第三个人想加入
你不需要重置所有事
一旦他们开始
他们就开始接收和发送数据你不需要进行握手
我们在后台为你处理这些
那么我们怎么建立连接？
你只需要为玩家设定连接状态
你只需要以completionHandler调用setConnectionState
有很多原因可能造成这失败其中一个原因是
如果已经达到会话的最大玩家数
如果第17个玩家尝试加入流
你一共有17人
那么这就会失败他们无法加入流
你可以看到玩家是否被设置一个特定状态
这个状态是连接和断开
你可以看到多少其他玩家目前已经连接和他们是谁
任何时候一名玩家改变连接状态
不管是连接或断开事件监听器 会话
玩家 didChangeConnectionState会被调用
这样你就知道那是否改变了
和你目前和多少人一起玩
一旦你建立了连接你可能想开始发送数据
所有的数据会被发送给所有连接的玩家
你可以发送这些可靠或不可靠
和我们的实时API相同
根据哪个更重要确保玩家收到数据
或者确保他们尽快收到数据
任何时候数据被发送了
事件监听器didReceiveDataFromPlayer会被调用
你可以获得数据并在本地更新游戏
并继续玩你的游戏
这就是构成会话的所有基本要素
让我们谈谈一些例子看看它实际看起来是怎样
当你创建一个游戏时
首先你得到你基本的回合制游戏
你建立了会话 获得游戏数据
加入了一些玩家
可能是玩家1的回合
他们首先发现是他们的回合并且保存数据
数据可以被玩家2 3 4载入
玩家1可以向玩家2发送消息
发送角标并说 嘿轮到你了
可能你想这么做
玩家2可以载入游戏 开始玩
找出要怎么处理新数据进行他们的回合 保存数据
然后把回合交给玩家4
因为没有特定的方法关于回合如何传递
这由你决定你可以从1到2 从2到3
从4到1 你想怎样都行
没有回合传递的特定方法
坦白说我们不知道你在干什么
所以你把游戏传递给玩家4
他们完成他们的回合并继续
你有了一个相当基本的回合制游戏所需的所有元素
你还可以做一个实时游戏
你设置好所有玩家
你让每个人打开连接状态
一旦连接状态打开
我们会在后台建立管道来允许他们互相连接
一旦全都建立起来
你的玩家可以开始发送数据给其他人
这些数据会继续传送
只要这些连接可用
关于会话
如果你想在结束时保存任何信息
比如谁赢了 排名
或任何信息关于这个特定实时游戏
你可以有一些持续的数据
你想和会话一起保存
这些是基本的例子
但会话真正强大之处
是可以进行更复杂的游戏
假设你有一个游戏会话
这是一个回合制游戏但是你想要更复杂的回合
这有一个游戏
它有交易卡片的元素
当来到玩家的回合时你可能可以交易卡片
可能用砖交易羊或者什么东西
你可以通过桌上谈话
在一个真的桌面游戏中完成的事情
你可以用会话更容易地完成
假设是玩家1的回合他想要和其他玩家交易
然后他们发送一条消息说“嘿 我想要用砖交易羊
有人感兴趣吗？”
你可以发送这条消息和一些数据
让用户知道嘿这是我想要的
然后发送给每个人
假设玩家4像是“哦听起来很好 我愿意进行交易”
或者“我对这个交易没兴趣用小麦交易羊如何？”
或者类似的
他们可以发送消息给玩家1
加角标并说
“嘿 这是...我接受你的交易”或者“我有不同的交易”
你可以来回发送消息找出你想做的
一旦玩家1决定 “我接受交易”或“我拒绝交易”
他们可以进行他们的回合去掉每个人的角标
保存数据 去掉自己的角标
然后把回合交给玩家2
我们还可以更容易地加入
多人游戏这可能复杂一点
假设你有一个多人游戏如King of the Hill之类的东西
所有人都在会话中
但是你一次只想两个人能玩
你开始你的会话你有玩家1和2
他们会打开连接状态
加入一个游戏并来回传递数据
他们会有一些一对一的肉搏战
其中的一个玩家会被淘汰
让我们假设是玩家1
然后玩家2继续和队列中的下一个人玩
你不需要用任何方式停止游戏
你不需要建立任何连接屏幕
一旦玩家3设定了连接状态
你可以开始来回发送数据
立即给玩家2和3
他们会进行他们的回合看谁赢了
这次[听不清]
然后玩家4可以加入这个打架
他们可以建立连接并继续
你可以继续这样
继续进行任何循环赛
如果你有100个玩家你可以循环全部100个玩家
继续进行King of the Hill式的打斗
然后你可以保存游戏数据
这允许有持续的排名
和持续的天梯
在会话中的这些人中
另一个你可能遇到的情况是帮助一名单人玩家
假设你有一个单人游戏
你用会话保存数据这完全可以
你完全可以用会话来完成一个单人游戏
并用这做为一种方法
来保存和发送数据
这样你的所有数据可以容易地更新到所有设备中
但是你的玩家遇到了困难他们玩了好一会了
他们无法完成这一关他们真的有困难
如果你这样实现你的游戏
那么玩家1可以分享游戏给其他玩家
他们可以带入玩家2
然后你可以加入一些元素允许玩家2
帮助玩家1通过这关通过一些合作方法
或者你可以允许玩家2帮玩家1玩这一关
这样他们就可以通过游戏卡关的地方
让玩家1有更多乐趣
玩家2可以进来做任何你让他们做的
保存游戏数据
然后他们可以离开游戏
玩家1可以继续玩游戏
好像玩家2从来没有在游戏里出现过一样
这就是游戏会话
它允许你和有iCloud账户的任何人一起玩游戏
你不需要是他们的好友
所以更灵活的游戏结构将允许你 开发者
用任何你喜欢的方式建立游戏
我们有很简单的多人游戏连接
这很容易建立 很稳定
允许传送大量的数据
我们对看到新的可能的游戏类型感到兴奋
你会赶上因为会话的能力
因为在游戏中混合回合制和实时元素
我们很想看到你们会做出什么
这就是今年Game Center的新特性
我们有新的基于消息的多人游戏邀请
现在允许你能够发消息给任何人玩游戏
我们移除了Game Center应用
我们有刚谈过的持续游戏会话
我们还宣布了Apple Watch支持
如果你想知道更多关于本次演讲的信息你可以上这个链接
我们是演讲611
我们有一些相关演讲 你可能感兴趣
我们有“Apple Watch游戏技术”下午晚些时候
这周早些时候我们还有一些演讲你可以观看视频
还有一些其他的没有列在这里
谢谢到来有一个愉快的WWDC