测量值和单位
嗨 我是Daphne Larose
我是Foundation团队的软件工程师
欢迎来到我的讲座
谢谢仍然坚持在这的你们
我知道现在已经晚了
当我想到应用
我们通常和测量值关联的
我不知道你们但是我首先想到的
是转换应用
讲得通 把一个单位转换成另一个
但是我想知道是否有其他应用
也使用测量值但是是用不那么明显的方式
我不知道 但当我思考 测量值
这很有趣 对吗因为我们一直在用它们
我们只是一般不会明确地想到它们
它们会以一种意料之外的方式出现
其中的一种方式是它们不以单位的形式出现
这很普遍不管环境是什么
假设我在法国 我在用一个应用
是计算路程长度
我期待这个测量值会显示公里
但是它显示英里
这就像 嗯
这是不和谐的不是很好的用户体验
所以在这次演讲中我们会向你介绍
一系列可以帮助你确保这不会在你的应用中发生的API
如果我们再次思考这个问题关于其他应用
我们和测量值相关联的应用
我提到过转换应用这还是真的
但是其他例子可以是游戏 对吗？
所以今天我们会谈谈我在工作的游戏
它叫做Jammin' in the Streetz有一个z
因为z很酷我想要我的游戏酷
这个游戏的假定
是让我们的玩家从一关跳舞到另一关
我为这个游戏设定了一些目标
一 我希望这个游戏很有趣
像是有史以来最有趣的一个游戏
二 大量表情符号 因为我爱表情符号
三 需要在世界范围内可用我想要它出现在每个地方
当我们思考一些游戏可能包括的内容
每一轮会被称为一个jam会话
在jam会话里 它追踪
玩家从一关到另一关所花的总时间
他们移动的距离
他们进行的舞蹈移动
甚至像是移动的速率
但是让我们想想我刚刚提到的事
注意到什么吗？
它们都是可测量的它们都是可量化的 对吗？
如果我们现在停止这次演讲
突然拿出电脑尝试写代码
我们怎么表现这？
我们可以用双精度浮点来表示它们
这是对的
简单 这样做的问题是
如果我们在这么做的时候漏掉了一些上下文
让我们看一个例子
我们有我们的角色
我告诉过你 很多表情符号我很喜欢
我们的角色有月球漫步因为为什么不
他们月球漫步了一段距离
如果我们储存距离为5
就像 嗯 好吧但是5究竟是什么意思？
这带来这个问题5什么？
但是如果我们说5英尺这就像是 好的
这是有意义的
现在它在物理空间中有了语境
所以让我们谈谈
Foundation引入的方法 或者说API
来精确的表示整个语境
你有一个新的结构
叫做测量值 它在单位类型上是通用的
我们会讲一下什么是单位类型
包含一个单位和一个值以及一个初始化函数
它酷的地方是你可以
有一个完整的语境来表达一个测量值
如果我们返回到我们的角色
假设在游戏中
我们不只是追踪移动的距离
我们还追踪角色的剩余距离
我们怎么用新API这么做？
现在我们可以把移动距离表达为5英尺
我们还可以把剩余距离表达为
一个测量值 让我们假设是6英尺
等等 你可以用它做些很酷的事
你可以把它们加起来得到总距离
是一个11英尺的测量值
你可以乘以它们得到你想要的值
你可以除以他们得到一个类似的值
这很好
如果我们返回来思考单位
什么是我们想和单位关联起来的？
首先 每个单位有一个符号 容易地
单位有量度
一个例子是对于长度量度
可以用 像是 英尺是长度单位对吗？
单位间可以互相相等
1英尺大约等于0.3米
我们现在有API来表示一个单位对象
如果你注意的话
之前我说每个单位有一个符号
在API中我们在这表示符号
我们没有在这显示量度和相等
因为不是每个单位都能等于另一个
而且不是每个单位都是有尺寸的
但是至少每个单位都有符号
所以我们在这它表示它
但是如果我们返回到量度的概念
什么是量度？这是什么意思？
量度是单位的种类
可以被不同单位表示
当我们想到长度时做为一个例子
长度可以用公里 英尺 英里等表示
量度还有基本单位
回到长度的例子长度的基本单位是米
你还可以在量度内进行转换
在单一的量度内
你可以把公里转换成英尺或反过来
米到英里 等等
现在我们有API来表示一个量度
你看到在这量度是单位的子类
这表明它通过继承获得符号属性
我们有一个转换器属性
我会深入地看一下单位转换器
但是基本上它定义这个单位
和它的基本单位之间的转换
我们有初始化函数 需要符号和转换器实例
我已经提到过每个量度有一个基本单位
所以我们有一个类属性会返回那个单位
一件重要的事需要记得
每个量度实例 属于一个单位并且自身是一个单位
有了这个我们引入的新API
酷的事是
我们提供170多种单位
你可以立即使用
你甚至无需自己定义它们
你只需要使用它们
像是 在这次演讲之后
大部分单位是依照国际单位系统
所以它们使用你已经习惯的单位这很酷
让我们看一个例子
我们有长度量度它有一系列的单位
是类属性表示这些量度
如果我们返回这里
量度实例实际上是单位
任何时候你调用这些属性
你获得一个长度单位的实例
这些实例的区别是
第一 它们的符号不同
第二 转换器的定义不同
一个我们提供给你的所有类的概述
所有不同的单位类型
记得我说过有170多种
试着用一用它们
但是我们有一些很酷的一些常用的单位类型
像是面积 质量 温度 长度
但是也有一些不常用的像是光照度和电流
但是听起来真的很有趣 若你玩一玩它们
让我们返回到我们的移动距离和剩余距离的测量值
这是我们已经见过的代码
现在我们要注释最后两行
因为我们要重新定义它们
我们只剩已移动距离
但是我们定义剩余距离使用相同的值6
但是不是传递英尺作为单位
我们传递公里
现在事情开始变得危险
因为我们要把已移动距离和剩余距离加起来
但是一个是英尺 一个是公里
这对总距离说明什么？
它的单位是英尺还是公里？
讲台会在5秒内爆炸吗？
我不知道
但是 不 它不会
其实发生的事是结果的单位是基本单位
也就是米
关于测量值酷的事情
是暗中为我们处理了一切
你完全不需要为此担心
你可以用这些操作符就像普通的标量值一样
你获得期待的结果
现在让我们再次假设我想要追踪角色
因为某些原因 因为是在演示
我们只是打印字符串但是我想做些更时髦的事
同时更有功能性
但关键是我希望能够
比较这些测量值现在你可以
测量值支持比较操作符使你能够这么做
如果我们要打印距离标记
我们会得到我们想要的刚刚开始
因为测量值可以正确推断
已移动距离比剩余距离小
让我们谈谈更多关于定义一个单位
因为我们还没有深入研究它
之前提过
单位总是以它们的基本单位定义的
有一个方法来描述这种转换
和基本单位之间的转换
我们会在进入单位转换器的时候谈论更多
重要的事是记得
转换只能发生在单一量度中
比如当你想到长度
你可以把公里转换成英尺
但是你会尝试把公里转换成秒吗？
在概念上这并没有意义
在这个情况下如果你试着对测量值这么做
会抛出
一个Objective-C或者Swift中的致命错误
记得我提过我们提供
170多种单位给你立即使用
有可能你不需要定义你的定制单位
但是如果你需要 只有在这时
你需要思考如果定义它们这很酷
你实际上可以用它们
那些已经提供给你的单位
但是如果你创造定制的单位
你要思考如何建立转换器
酷的是
测量值可以帮你暗中处理转换
即使是你定制的单位
它就是能自动地工作
让我们谈谈定制单位
我们要为游戏定制一些单位
我们有jamz单位因为我想
计算一个jam会话中的总时间
用叫做jamz的单位来计算
我觉得秒太无聊了
但如果你看看这里 我们有UnitConverterLinear对象
它是什么？我们还没有说过它
让我们返回来说说更多关于转换的事
和基本单位之间的转换
UnitConverter是根类它定义两个方法
描述这个转换
baseUnitValue(fromValue)和value(fromBaseUnitValue)
UnitConverterLinear覆盖这两个方法
并线性地定义它们
对这里所有懂数学的人
它的形式是AX+B
A是系数 B是常数
如果我们返回到jamz单位
我们看到系数是30 一个标量值30
我们是说一个jamz单位等于30秒
在我们的线性函数中
无论jamz为何值我们把它乘以30
所以一次jam会话共是4个jamz4个jamz
如果我们想把它转换成秒
会是4乘以30等于120秒
你也可以反过来做
120除以30来得到jamz值
耶
假设我要定义其他定制单位比如长度
因为我不想用英尺和米计算移动距离
我想用一些更有趣的东西比如hopz
所以这里 相同的概念
1 hopz等于0.75米
我们在这定义方程
其他我需要的定制单位也是一样
你现在知道怎么做了
如果你还记得当我谈到jam会话
我命名了一个测量值
是所进行的舞蹈移动的次数
不幸的是国际单位系统没有一个量度
用来识别舞蹈移动
我不确定为什么
但是这是一个我们今天要自己定义的东西
我们有UnitDanceMove类
有一个基本单位wackyArmMovements
你在这看到
一个wackyArmMovement等于另一个wackyArmMovement
它的意思是另一种定义单位的方式
是多少个基本单位组成一个特定单位
这里是一对一所以系数是1
假设我们想定义一个机械移动
我认为它就相当于大概4个wackyArmMovements
CabbagePatch是3个wackyArmMovements
是的
当然没有jazzHands的舞蹈动作的量度是不完整的
它等于2个wackyArmMovements
我认为这是精确的我们会坚持这样
现在让我们返回并创建jam会话
我在早前已经概述过的
移动的距离 也就是已经进行的步数
会用我们创造的单位hopz
jamTime的单位自然是jamz
舞蹈移动的单位将会是机械
我们的角色当然会一直跳机械舞
舞蹈速率实际上会是米每秒
但是如果你记得
我们的测量值没有用米或者秒的
所以我们要怎么获得那个值？
我们可以把已移动步数转换成米
我们还可以把jamTime转换成秒
现在我们可以返回一个测量值
是按照米每秒的
酷的事是只需要几行代码
我们就可以完全定义我们的jam会话
现在我们知道怎样表示测量值
和单位做为模型对象这很酷
但是我告诉过你
我想要这个游戏在每个地方可用
要这么做我们需要格式化这些测量值
事情在这变得棘手一点
如果我们有我们的角色
我们不说跳舞了5英尺
而是说跳了5公里机械舞
硬核
如果我们想在全世界显示这些那看起来会怎样？
在加拿大 我们可以这么写
它以前被写成5公里
然而如果我们用中文显示这些
我们需要翻译单位
在阿拉伯语里我们需要翻译单位并改变数字的显示
来确保从右到左的正确顺序
这些都是我需要手动在我的应用里进行的逻辑
最后在美国 我们会说 公里？
那是什么？那是什么东西？
所以我不光需要处理转换
在我的计算过程中
我还需要仅仅为了格式处理转换
这是我需要加进应用的额外逻辑
那这里的解决方案是什么？
你可以让Foundation为你做所有的事
我们有新的格式器叫做MeasurementFormatter
它格式化测量值和单位并且知道地区
所以你不需要担心
让我们看一看它
它是格式器的子类
如果你对其他格式器熟悉是一样的概念
它有unitOptions属性
我们稍后会谈到更多unitOptions
它还有unitStyle
如果你熟悉其他格式器
短 中 长
它有一个可设置的地区
现在你可能默认使用
用户的当前地区
这就是这个地区永远的默认值
但是如果你需要明确设置它你可以这么做
它还接受一个定制的numberFormatter
假设你想要你的测量值中的值
被用科学计数法显示
你可以提供一个定制的numberFormatter来为你这么做
它还有方法接受一个测量值对象和一个单位对象
让我们多谈一下单位选项
酷的事是它开箱可用 根据默认
这个格式器使用你的用户所在地区偏爱的单位进行格式化
所以你甚至不用思考这些
它还考虑其他事比如目的
如果你在计算一个长度
关于路程距离而不是身高
你会想要根据语境用不同的单位
所以我会看看一些MeasurementFormatter提供的选项
一个是providedUnit假设我们有一个情况
我们想传入5公里的测量值
但是我们的地区是美国
通常在美国我们会为路程
把它转换成英里因为我们通常用英里
但若你设置providedUnit
它会保证不论你传入什么单位
都会被格式化成你设置的这个单位
还有一个动作叫做自然比例尺
这对UI相关的东西很有用
如果你的应用是在watch上运行
你很担心屏幕尺寸
那么不是放1000米
会需要很多你的屏幕
你实际上可以把它格式化成1公里
另一个是不带单位的温度
假设你有个测量值显示90华氏度
但是你不想要显示华氏度单位
你可以这么设置得到你想要的结果
让我们用一些例子来玩一玩
我们有我们的格式器
我们有我们的原始距离测量值
那是5公里因为这是我们的角色跳舞的距离
现在我们想从中获得一个结果字符串
我们会看到结果的单位是英里
最酷的事是只用了三行代码
我们不但得到了想要的结果
而且不需要对格式器做任何事
开箱即用不需要任何设置
它知道应该做什么
现在假设我们给它我们的定制单位hopz
以及测量值 MeasurementFormatter它没概念
它不知道hopz实际上是一个单位
但是我们创建了hopz距离
我们把它传递给格式器
它实际上还可以为我们暗地里进行转换
我们不需要做任何事
现在让我们假设我们有定制单位
我们要人们看到它所以设置providedUnit
我们会给它一个测量值这会有我们的hopz单位
现在结果会使用那个单位
这个情况是个很有趣的情况
因为我们不但提供一个定制单位
我们还提供定制量度中的定制单位
在这一点
这就像 不是很确定MeasurementFormatter会做什么？
好吧 它做的正是我们期待的这很好
现在我要把讲台交给Foundation团队的另一成员
他会展示如何使用测量值
并且可以在游戏的高分功能中使用和格式化它
谢谢
谢谢Daphne
我是Peter Hosey
我也是Foundation团队的一名工程师
像Daphne说的这是我们的高分列表
我们在这显示游戏的关卡列表
当你点击一个时你看到基本事实
关于关卡 名字 它的一个图片
你看到一些关于玩这关的重要信息
你需要知道的事
并且你还会看到你的统计关于你在游戏中的表现怎样
你看到一些东西 比如你的高分做了多少wackyArmMovements
你能看到你跳了多远多快
但这些都只是数字
他们缺少量度
所以我们不知道像是6811是多远？
现在你自己可以实现一整个单位系统
你最开始可以只追踪一个单位
直到最后追踪所有这些数字
你可以再构造更多比如一个单位转换系统
能理解不同地区
并自动翻译单位名
这有很多工作不是吗？
像Daphne说过的让Foundation为你工作
我们现在有测量值和单位
以及在Foundation中的MeasurementFormatter类型
让我们在我们的游戏里用它们
我们要创建定制单位
Daphne向你们展示过像是这样
我们有一些长度单位和速度单位
我们有4个定制的舞蹈移动
并不来自Foundation
我们有我们的定制单位
我们能把这些带到我们的模型中它是这个关卡结构
有我们关于这个关卡的一些基本事实
并包括角色的统计 这只是些数字
让我们把它们转成测量值
现在我们有舞蹈移动的测量值一个长度的测量值
还有一个速度的测量值
因为我们改变了属性我们也改变初始化函数
现在可以用测量值来创造一关了
我们想在列表视图控制器里做这些
这里 针对这个视图的控制器这是列表
我们的列表视图控制器的请求是一个同步的API 它返回
一个JSON字典列表每关一个
包含所有信息
特别是包括角色的统计做为数字
我们想要围绕这些数字创造测量值
这是wackyArmMovements的数字
这是Hopz的数字
这是hopzPerJamz的数字
现在这些信息在我们的模型中
我们把它作为测量值创建在我们的列表视图控制器中
这是我们在列表视图控制器中要做的唯一改变
现在我们可以看看详情视图控制器
它在这里显示这个视图
并且为每一关显示这些
我们还可以在这用我们的新测量值
我们已经有了一个格式器
这是一个NumberFormatter它所做的是填充
到6个数字 用0来填充我们想保持它
但是我们想在其上开发
我们想让它显示单位
所以我们要再加两个格式器
我等下会解释为什么要这么做
现在我们已经创建了它们
我们来到同样的地方我们已经配置了数字格式器
是在我们的viewDidLoad方法中
这是从UIViewController继承的我们在这覆盖它
我们配置highScoreNumberFormatter
用我们的最少整数位数
现在我们要配置MeasurementFormatter
用我们的providedUnit它是wackyArmMovements
你在这看不出来 不是吗？
用我们的NumberFormatter我们可以继续填充到6位数字
我提到过我们新建了两个新的MeasurementFormatters
让我们配置另一个
这一个我们想用标准的数字格式器
所以我们不设置这个NumberFormatter
但是我们仍然设置它使用providedUnit
现在如果我运行它
欧
我配置了格式器
我现在需要使用它们给我的字符串
我们已经谈过了一个格式器我们说从这个值得到的字符串
当它是一个数字时工作得很好但现是一个测量值
所以我们谈谈MeasurementFormatter
这只需要修改一个单词
其他的都完全一样
对任何格式器都同样工作
另外两个我们直接从数字获得字符串
你可以想象这不利于你的本地化
这里我们也希望用一个格式器
所以我们会用我们其他的格式器这还是一样的东西
这个情况下我们从测量值得到字符串
这返回一个字符串我们把它传递给标签
现在我们可以运行应用
我们看到我们的定制单位显示了出来
这是一个开始
但是我们还是没有真正提供真实世界的语境
这是我们开始的目标
我们需要用真实世界的单位显示这些
所以我们可以进行一些我们自己的转换逻辑
但是MeasurementFormatter可以为我们做这些
我们要创建另一个MeasurementFormatter
因为我们有定制单位MeasurementFormatter
我们还要有能识别地区的MeasurementFormatter
我们创建它 和我们配置它一样
除了我们实际上不需要做任何事
因为MeasurementFormatter可以立即使用
自动转换成玩家想要的针对他们地区的单位
这里会变得有点棘手请对我有点耐心
我们正在调用一个格式器要求得到一个字符串
并把它直接传给标签
我们要做的
是我们将首先调用customUnitsMeasurementFormatter
得到距离的字符串
然后调用localeAwareMeasurementFormatter
得到它的距离字符串
然后用一个Swift字符串填写
把这两个放一起生成一个字符串
我们把这个字符串传给标签
我们为距离这么做了我们也为舞蹈速率这么做
这就是我们需要做的全部工作
用来显示我们的两个定制单位
和玩家希望的针对他们的地区的单位
真实世界中的距离
但是我们不需要停在这
因为目标是让这个游戏到达全世界的每个国家
英里在美国很好我们在美国
我们看到英里
但是我们想确保它在每个国家都工作
所以我要用到一个Xcode功能
这是你方案的一部分我要在这编辑我的方案
我要复制方案
当复制方案时
会问我它的名字
我会给我的方案一个有特色的名字
现在给我的方案命名了
我要做一个简单的改变在运行的里面
选项标签 应用地区
我要把我们的测试移动到外国
像是加拿大
现在我要运行这个方案
不需要改变应用代码没有模拟器的配置改变
只是改变方案
我们看到在加拿大它显示公里
这就是我们要让它工作所需的全部工作
有了我们新的测量值和单位
和在Foundation中MeasurementFormatter类型
谢谢
谢谢 Daphne
非常感谢 Peter
显然这个游戏会很流行
我很喜欢它
让我们很快总结一下
我们看了这整个演讲和演示
测量值和单位怎么是模型对象
我们可以在应用中使用这很棒
我们还看到很容易格式化它们
只需要我们进行少量工作这很酷
最好的部分是我们免费得到所有的这些强大的本地化
不需要定义任何对象或选项
开箱即用
所以现在你不需要突然变成知道多国语言
或者改变你应用的任何逻辑和代码来支持这些
你只需要直接使用它
如果你想要知道更多信息你需要访问这个链接
这些会话已是过去式了
但是如果你们超感兴趣我建议你们下载视频
非常感谢