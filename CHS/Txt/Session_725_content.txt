大家好 我是Todd RitlandAirPrint工程师
和iOS首席印刷工程师
这个就是在企业中部署AirPrint
AirPrint是Apple的全方位印刷解决方案
这是一项可以帮助你创建无损打印输出的技术
无需下载或安装驱动程序
若你是应用开发者并想在你的应用程序中添加打印服务
请查看developer.apple.com/airprint
上面有个我之前在 WWDC 的演讲
标题叫AirPrint的优势
然后下载示例代码就可以开始了
如果你是一个打印机制造商
或者是一个打印服务器开发者
并且想对你的产品授权AirPrint技术
请电邮airprint@apple.com
这次谈话将会针对负责部署AirPrint
和想要了解更多所有的
让AirPrint在企业环境中能很好工作的企业特点
企业的打印服务有很多特有的要求
我们企业的用户会和一堆打印机打交道
（打印机）经常来自不同的制造商并有着不同的功能
在不同的楼层或者是不同的楼之中
还可能在不同的地点
这些也可能是非常复杂的打印机
网络架构一般很复杂
通常他们是无线或者有线的客户端
而且他们的网络结构和所在建筑的物理位置可能并无关联
IT部门也会有各种各样的网络要求比如说禁止软件升级
禁止组播数据包传输
和阻塞特定端口
这些都会影响到打印机
企业客户也可能会有会计要求
因为每一页都会花钱
当然
安全性要求是必要的
而且在企业打印中越来越重要
我们从企业中收到最多的请求
是可以创建PDF
并且增加更多无纸化的工作流程
安全性
访问控制和会计
还有更方便的找到打印机
让我们来看一下AirPrint其中每一项上具体能带给我们什么
首先是从打印面板中创建PDF
Mac OS早具备生成PDF的能力
在任何地方都可以打印
而如今在iOS10
所有的iOS设备都具备了这项能力接下来我想展示下它是怎么工作的
我现在有一台运行着iOS 10的iPad
当我轻触打印
我就可以用我的双指缩放打印预览
而且在这里我左上角有一个分享按钮
所有支持PDF的应用就会出现在分享菜单下面
还会有AirDrop和其他系统分享的选项
这也可在Managed Open InEnterprise功能中使用
这样就可以把商业条目和个人条目分开
在具备3D Touch的设备上
你也可以用Peek and Pop手势
来到和打印预览里同样的视图
我认为企业用户会喜欢这个新的无纸化工作流程
应用到他们所有的iOS设备中
安全性
下面是一个极其重要的话题
安全性
iOS和Mac OS上的AirPrint完全支持端到端加密法
这样你的网络文档就被保护起来了
AirPrint支持最新的TLS产业标准
基于HTTP的1.2加密
这项加密技术
对于所有新AirPrint打印机和服务器是必须的
接下来 对于额外的安全措施
很多企业用户不想打印出来的文件
呆在打印机的出纸盒里
这样一个人未经允许就可以拿起来查看
对于支持PIN Release的iOS和Mac OS打印机
用户会在打印机上输入自己的PIN
来接收他们的打印文件
在iOS上 当需要输入PIN时
打印面板会显示一个标签用来解释
当用户点触打印时会显示一个提醒
输入PIN来释放打印任务
在Mac OS上
用户可以输入自己想要的PIN来释放打印
Mac OS也支持这样的PIN设置
当PIN是可选的打印时就不需要输入PIN
然后是访问控制和会计
登录
AirPrint一直支持打印机和服务器
需要输入用户名和密码来验证身份
我们把输入的用户名和密码保存在Keychain中
这样用户就不用重复输入
iOS 10已支持这样一个功能
忘记已存储的身份验证信息
以便使用需要输入不同用户名的工作流
今年的新功能还有支持仅密码验证
这样打印机就只被一个简单密码保护起来
就像这里展示的
会计
当企业需要把账单
或者账户信息添加到每一次的打印中
iOS和Mac OS两者都支持打印机和服务器
接受该账户信息
如果每次打印都需要这个账户信息
在打印继续前用户需要输入该账户信息
此外对打印任务 iOS和Mac OS支持账户ID可选或强制
这个是Mac OS X上UI的界面
接着是更方便的找到打印机
支持的发现方式
AirPrint有很多方式来发现和使用打印机
大多数用户使用AirPrint的主流方法是Local Bonjour
它不需要设置
打印机显示可用 自动地出现在列表里
不用任何设置
AirPrint也一直支持Wide-Area Bonjour
Bonjour基于DNS发现服务
并且如果使用正确记录来配置DNS服务器
打印机也可以这样被发现
我会示范下这个怎么做
iOS和Mac OS现在也都支持移动设备管理
或者带有设置好AirPrint有效载荷的MDM配置文件
iOS 10的新变化是
我们把AirPrint Bluetooth Beacon作为发现打印机的发法
它使用蓝牙低功耗信标
配置DNS服务器来发布AirPrint打印机并不难
首先 设置好的DNS服务器必须在
被需显示打印机的iOS设备和Mac使用的DNS服务器列表里
一共有很多种管理哪些DNS服务器
和搜索域被使用了的方法
比如DHCP和MDM配置文件
然后下一步你需要添加A或者AAAA记录
到打印机的名字里
和设置了静态IP地址的打印机里
为主要的IPPS服务类型添加PTR记录
还要为通用子类型额外添加一个PTR记录
这是AirPrint的关键AirPrint不仅是IPPS服务
它还有一个通用的子类型
而那就是iOS设备和Mac搜索的东西
你要为该服务添加一个SRV记录
然后还有一个TXT或检测过的文件记录
它描述了打印机的很多性能和信息
极其重要的一点是去找到
打印机或服务器的TXT或文件记录
用Mac OS命令行工具dns-sd可以轻松做到这一点
想要用dns-sd找到那些记录
只需要在你设置的打印机的相同子网下执行这条命令
使用-Z选项会以当前区域的文件格式来显示记录
你要应用_tcp._ipps.service类型
到本地域就像这里以蓝色显示的部分
你会得到一个输出包含每一个在本地被发现的打印机
PTR SRV和TXT记录几乎都是你需往DNS服务器中添加的
外加其他的一些补充
改变过的地方在这里被绿色高亮
像我之前提过的你需要添加一个额外的PTR记录
到通用子类型
就像第二行的这个一样
你还要把SRV记录中本地打印机的名字换成
完全符合要求的域名
我早些时候提到的A记录
而且你还要替换
本地Bonjour实例名
使之成为完全符合要求的域名
就像这里显示的带有打印机管理员URL的绿色部分
如果这个不修好的话
用户将不能使用Mac OS上的按钮
快速访问打印机的管理员页面
这些文字
可以直接拷贝到zone file里
这样打印机就会出现在列表里供用户使用
前提是用户把这个DNS服务器设置成他们DNS服务器中的一个
配置Wide-Area Bonjour打印机的关键是
借助dns-sd命令行工具
MDM配置文件是一个很流行又超级简单的方法
来为你的用户们设置打印机
AirPrint有效载荷可以被添加到任何配置文件里
而且有效载荷包含一个主机或IP地址
还包含一个资源路径
对于大多数AirPrint打印机资源路径是ipp/print
AirPrint服务器也一样这会成为队列
这个是Apple Configurator的截图
最受欢迎的移动设备管理工具之一
下一个是令我们非常兴奋的一项新技术
也是iOS10的新功能
它就是AirPrint Bluetooth Beacon
那么什么是AirPrint Bluetooth Beacon它是怎么工作的？
它是可以被设置的很多市场上的第三方
蓝牙信标设备就可以
只要在打印机附近
或者它也可以成为打印机的一部分
用打印机自带的无线电和天线就可以办到
未来的AirPrint打印机就会内置这项功能
它所做的就是把连接信息发射出去
若iPhone接收到了那个IP地址
它就可以向这个打印机发送打印任务了
这个非常厉害因为网络的复杂性对我们无关紧要
唯一重要的是我们能收到那个IP地址
它甚至可以是网络上的一个公用IP地址
即便远到iOS设备蓝牙覆盖的范围
外加可以收到那个IP地址
打印机就能出现在用户的列表里以供使用
而且AirPrint Beacon也可以很好和打印服务器配合运作
我们这里有个AirPrint服务器在右边
在网络上的每一台打印机都有一个AirPrint Bluetooth Beacon
正在发布服务器的IP地址
和打印机关联的Queue ID
当用户开始打印打印任务发送到打印服务器上
还有相随的队列信息
然后服务器把打印任务发送到用户在UI界面选择的那个打印机
我们来细说下何谓AirPrint Bluetooth Beacon格式
这样你就可以设置你的打印机了
首先 我们有一个header
这个用来把蓝牙信标验证为一个AirPrint Beacon
所有的AirPrint Bluetooth Beacons都一样
这样我们就可以拷贝了
下一步
我们有了连接信息
它会告诉我们之后被发现的IP地址
是IPv4地址还是IPv6地址
它还会告诉我们这个IP地址是服务器的
还是打印机的
这个字节还决定连接是否用TLS加密
对于这个示例连接是TLS加密的
IP地址是一个IPv6地址
且这不是一个服务器
请浏览发布在developer.apple.com上的说明
这个字节是如何设置的
接着我们有一个打印机的ID
该打印任务是应发送到打印服务器上
或者资源路径的信息还是打印任务应被直接发送到打印机上
这个打印机把ipp/print作为资源路径
重复下 请浏览发布的说明
是更多关于指定资源路径的
下面我们有了连接的端口号
631是标准的IPP端口
端口443经常被用作TLS安全连接
对于这个示例
277是631的16进制也就是标准的IPP端口
下面我们有一个IP地址
如果你的打印机使用的是不可升级的外置信标
确保打印机使用的是静态IP地址
否则这个IP在信标中一旦IP地址发生变化就会失效
最后 就像iBeacon一样我们测好的信号强度为1米
用的是和Apple iBeacon测量强度一样的度量方法
这样可以更好的给iOS设备提供关于距离打印机物理距离的信息
对于这个例子发射功率平均为64分贝
也就是16进制的40
AirPrint Bluetooth Beacon的格式和iBeacon稍微有点像
iBeacon的格式要少一个字节
但是起始的header非常相似
如果你是根据iBeacon技术说明设置的你的设备
你有可能稍作调整并用相似的参数来设置AirPrint Bluetooth Beacon
很多制造商对蓝牙硬件
会或者将会使用特定的AirPrint Bluetooth Beacon设置流程
那么对于企业用户
iOS和Mac OS提供很多非常好的技术来支持PDF工作流
以适应日益增长的数码世界
AirPrint则提供了非常好的安全性访问控制
会计和新的发现技术使打印更出色不论任何环境
老规矩 告诉我们你的意见你们的企业有什么特殊的需求
请在apple.com/feedback上发送意见反馈
更多关于此次演示的信息
和参考数据
请查阅developer.apple.com/wwdc16/725
你可能也想知道
在Nob Hill的“Apple设备管理的新特性”会话
时间是周三上午11点
还有“获取内部核心位置”
地点在Marina
时间是周三下午3点15分