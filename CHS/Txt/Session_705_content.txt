iOS安全的工作原理
谢谢
非常感谢大家参加下午4点关于安全的演讲
我知道大家一天辛苦了不过真的要感谢各位的到来
我叫Ivan Krstic
我管理Apple的安全工程架构
这个团队从基础将安全
构建给所有用户手中的产品
今天的重点是iOS
我非常自豪地告诉大家安全的作用在
这一平台上扮演着关键设计理念的角色
在我们开始之前我们要先讲一下背景
为什么安全对Apple如此重要
为什么我们相信这对用户至关重要？
这是因为我们的移动设备前所未有地记录着我们的生活
有史以来从未有过一种东西会对我们如此了解
了解我们的消费方式
了解我们发送的邮件我们拍下的照片
了解我们的消息
从最简单的问好到最亲密的对话
当今的移动设备前所未有地记录着我们的生活
当你这样考虑 你会发现
保护所有这些信息的安全
这不仅仅是技术上的问题
对我们来说是一项任务
这项任务的中心在于保护
我们用户的个人数字主权
而且当你这样考虑你还会发现
攻击者的定义也发生了改变
现今的攻击者可能会想要持有你的数据并进行勒索
他们可能是不良的商业竞争对手 想要占得优势
他们可能是网络服务提供商
想要不可磨灭地标记出你的在线活动
在未征求你同意的情况下进行跟踪和广告宣传
这可能是国家
像是2014年SonyPictures的黑客入侵
有时候好奇心也会让和我们亲近的人受到侵害
攻击者会是谁
当然 还有我们一定不能低估
高等猫科动物所带来的威胁
谢谢
所以当你想想这些攻击者
他们想要什么？
我们发现这些动机通常会在这三个组中
有个人跟踪和监视
尝试获取你的照片和消息
使用你的相机和麦克风
还有商业间谍
获取你的商业邮件和文件
还有你的知识产权
攻击者想要什么？
最后这里有直接经济好处将金钱直接
从你的网上银行业务交易中盗走或者植入广告
以及在你浏览网页的时候进行点击欺诈
为了做到这些事攻击者创建了
广告软件 间谍软件 勒索软件
远程访问木马以及多种多样的恶意软件
我们怎么会知道？
因为我们在其他平台上见到过
但iOS上面没有
iOS上市将近10年之久
还没有出现一种iOS的恶意软件
大范围地影响我们的用户
这是因为大约在10年前Apple就意识到
移动设备会在用户的生活中发挥着何种作用
我们意识到现存的安全技术
是远远不够的并且无法胜任这些挑战
所以我们决定构建出我们所能设想的最佳安全技术
来保护我们的客户并且规模大得惊人
我们所保护的用户
在全球范围内拥有10亿多激活的iOS设备
而且我们的每一项安全功能
都会真正地保护用户免遭威胁
IOS安全支柱
但我们并不孤单
在iOS安全中有三个关键支柱
有平台安全我们将这类技术
构建于我们的软件和硬件之中
有用户将他们的软件升级到最新最安全的版本
然后有像各位这样的开发者
使用我们的安全技术构建安全的应用
我们今天要谈谈这三个支柱
我们从平台安全开始
当你想想之前安全的运作方式尤其在企业设置中
那是一长串的复杂内容
用户必须要遵守才能保证安全
在设备上加载安全配置
复杂的批量管理方案复杂的密码策略
非常困难 非常笨重用户根本无法成功
而且很难实现安全
但因为Apple拥有所有的硬件和软件
我们能够以一种独特又创新的方式解决这一问题
当你审视iOS安全
我们将安全直接构建在硅片上
在默认情况下 我们让设备在出厂时就是安全的
我们让用户非常容易地升级
并运行最新最安全的版本
我们让用户非常容易地使用Touch ID来安全登入设备
我们监管App Store而且我们让安全易于使用
iOS平台安全包括大量的功能
而今天我只有时间强调五项功能
我们从安全引导开始
安全引导
能够信任一个设备的最重要
方式之一就是信任上面运行的软件
我们的做法是
在硅片内部构建信任
每个iOS设备内部的Apple设计系统芯片都持有
Apple公开密钥 位于一个叫做Boot ROM的只读存储区域中
在出厂前就已写上并且之后无法改变
当你的iOS设备启动时
我们会用那个公开密钥
然后Boot ROM会在引导链中验证下一步
也就是低级引导加载程序
而且只有通过了那个验证我们才会进入到链中的下一步
我们会重复该过程直到iOS设备完全开启
这让我们确定引导中使用的软件
的每一部分都签有Apple的私人密钥
信任安全引导
当你想想安全引导
非常有趣的是我们不依靠
任何第三方来实现安全引导信任
我们不依赖我们控制之外的证书权威机构
用于安全引导的密钥是由Apple生成 管理和提供的
用于验证的代码
刚才给你们展示了也是Apple编写的
只有Apple拥有给所有软件签名所需的私人密钥
但这里还有另一件有趣的事 那就是
当iOS设备去升级软件版本时
它必须联系我们的安装授权服务器
并请求许可来升级到指定的版本
做法是将升级版本的加密测量
发送给服务器然后询问是否可以升级
我们这么做是因为现在服务器能够
防止iOS设备迁移到更旧更不安全的iOS版本
所以当你将这两者放在一起你会得到一个强大可靠的机制
依靠每个iOS设备上所运行的软件
旧版iOS无法从一个设备复制到另一个设备上
该过程的软件完整性是无法篡改的
现在我们谈谈保护用户的静态数据
数据保护
如果你非常认真对待这件事
你不要将保护用户数据的加密密钥
用在应用处理器中
或是设备中的普通处理器
这是因为那里的攻击面实在是太大了
如果真的想保护用户的静态数据
你要构建专门的硅片来持有这些加密密钥
我们就这样做的
我们称之为Secure Enclave
当你在想密码的时候
通常它们很短4到6位数
如果攻击者设法将加密的数据从手机中取走
从iOS设备中取走
并尝试所有可能的密码
这不会花多长时间
所以取而代之我们从用户的密码中衍生出一个密钥
仅用于Secure Enclave的硬件密钥相挂钩
这意味着无法在离线状态下猜测出密码
密码猜测必须要在设备上进行
而且设备可以自由限制尝试的次数
事实上 这就是你iOS设备的工作原理
在几次错误密码尝试之后我们会实行时间延迟
但在10次错误密码尝试之后
Secure Enclave将不会再次解锁那个设备
这与清除数据功能没有任何关系
当启用时
数据会在10次错误密码尝试之后被清除掉
即使你没开这项功能
一旦出现10次错误密码尝试
Secure Enclave将不会再解锁那个设备
无论你等多长时间
所以我们使用行业标准算法来构建系统
我们对其进行严格的内部安全审查
以及第三方代码审核
之后我们还会再进一步
我们将我们核心加密库
用于支持数据保护而且我们将它们发布到网上
供所有人下载检查
我们谈谈沙盒
沙盒
沙盒是一种在应用之间隔离数据的方法
这是因为即使意图是好的
开发者有时还是会犯错
沙盒这种方法可以减轻由那些错误带来的潜在危害
这有点像汽车中的气囊或安全带
能够减轻事故中受伤的风险
我们还使用沙盒来将一些有关安全的
选择直接交到用户的手里
我们有一个叫做TCC的机制透明 同意 控制
我们可以询问用户问他们是否信任指定的应用
并将一些敏感数据交给它们例如地点 照片和联系人
一旦用户在这样的对话中下了决定
沙盒机制和内核就会执行那个决定
代码签名
我们平台安全的另一个关键因素就是代码签名
当攻击者尝试攻击设备时
第一步就是尝试让他们的恶意代码运行起来
因此 iOS代码签名不仅是涵盖操作系统
它还涵盖设备上运行的每个应用
事实上 当你将应用上传到App Store上面的时候
Xcode会计算每个可执行文件的密码散列
和应用捆绑包中资源的密码散列
并且会将它们和应用一同写入代码目录
之后再送到App Store
当用户下载应用并运行它
我们的内核会查看每个可执行的存储页面
然后和代码目录进行对比 来确保
其未被篡改过
结果 攻击者无法将一些恶意代码
植入到存储中并将控制流转移过去
反而 他们必须依靠于更加复杂的
更加困难的方案来运行他们的恶意代码
Touch ID
我们谈谈Touch ID
每天平均80次用户解锁
我们知道我们的iPhone用户每天平均解锁手机80次
如果你设置了密码这就会给那80次解锁带来麻烦
结果
几乎过半的用户没有设置密码
我们知道因为密码可以说是用于保护
用户静态数据的关键部分所以这个问题我们必须要解决
我们需一个解决方案
要简单
要快速
并能为用户的数据提供极好的保护
我们解决方案是Touch ID
不过我们不仅是将指纹传感器放入手机中
你可以更改密码
但你无法更改你的生物特征属性
你无法改变你的指纹
所以我们知道
我们必须提供生物特征数据这是我们能构建的
最高级别保护
所以我们做的是将指纹传感器直接连接
到Secure Enclave通过一个加密链接
而且我们使得当你的手指触摸到传感器时
指纹会直接传输到Secure Enclave
在那里进行处理然后加密
而应用处理器无法获取指纹
应用处理器运行手机上的正常应用
我刚才提过在Touch ID推出之前
大约一半的用户设置了密码
Touch ID之前的密码使用率
现在九成人用密码
Touch ID之后的密码使用率
这精彩地示范了Apple的惊人之处
我们将硬件工程专业技术
软件工程专业技术
对易于使用的投入
将它们组合在一起使得普通用户
不关心指纹传感器
不关心Secure Enclave或是散列函数
他们得到的是数据安全的惊人提升
用户升级软件
iOS安全的第二个支柱
是用户升级软件
最新版的iOS总会是最安全的
并且我们持续让iOS变得更加安全
基于现在见过的威胁和未来预见到的威胁
而且我们构建所有深层的技术
来信任在我们硬件上运行的软件
但iOS版本无论多么安全
如果人们不去安装最新的版本 这都是没意义的
最安全的那个版本
所以当我们考虑软件升级时
这不仅有关于那个设备和其运行的软件
这还关于我们与运营商的关系
以及我们快速发布升级的能力
还有用户体验
用户如何看待设备上的升级
我们在iOS 9中做的一件事是我们极大缩小了
安装升级所占用的空间量
这样拥有较小剩余空间的用户还是可以获取最新
最安全的软件版本
更小的安装占用空间
之后我们着眼于用户体验
然后说 有时候用户不想因为升级而被中断
所以我们让他们选择是立刻安装升级
或是在晚上安装
当他们可能没在使用手机的时候
或者第二天提醒
得出的结果很惊人
将近85%的客户在运行最新的iOS版本
我们最安全的版本
如果你认为这很简单没什么大不了的
你只需去看看其他的平台
Android安装基数
顺便一说这个比较很公平
因为Android 6和iOS 9的发布时间只相差几个周
准确来说一下
在Android 5.1.1版之前每个版本都有一个漏洞
叫做Stagefright这会被远程利用
你利用它的方法可以是将一个专门制作的消息发送给
一个有漏洞的设备然后获得对那个设备的完全控制
Google很快修复了这个错误
但这没有任何意义 因为他们的大多数用户没有安装补丁
而没有安装补丁是没有任何作用的
这就是为何我们投入如此多精力不仅是构建安全的iOS版本
而且还让用户能容易获取最新最安全的版本
iOS安全中的第三个支柱
就是各位开发者
使用我们提供的安全技术来打造安全的应用
开发者打造安全应用
遵循最佳做法
这意味着遵循平台上的最佳做法
我们有数量惊人的应用使用Touch ID API
让用户免于记住复杂的密码
然后再直接输入到应用中
去年 我们推出了一项新功能叫做App Transport Security
为应用的信息提供强大的保护
随着信息通过网络传输到应用的服务器上
今天我很自豪地说在2016年的年底
App Transport Security将成为App Store应用的一个必要条件
这意味着到了2016年底
当你的应用和你自己服务器的后端进行通信时
它们必须使用安全的TLS信道使用TLS 1.2
除非通信中的数据是批量数据
例如流媒体和已加密的数据
这会将真真正正的安全提供给我们的用户
以及你应用在网络上的通信
各位开发者还要承担另一部分责任
当你构建应用的时候
这就是要清楚你的代码这不仅是你编写的代码
还有你在应用中加入的任何第三方代码
清楚你的代码
这是因为你使用的库可能会破坏你应用的安全
可能因为他们在背地里做一些你不知情的事
但可能
因为这里有一个更新更安全的版本
这里有一个很好的例子
有一个非常知名的第三方网络库
在TLS连接的安全验证上出现了重大漏洞
这个漏洞很快就被修复了
但在一段时间里 App Store中有多达25,000个应用
不是最新最安全的版本
所以从可靠位置获取第三方代码是十分重要的
你要清楚它的功能并且要保持更新
所以这些就是我们iOS安全中的三个关键支柱
平台安全
这是最佳的安全技术机制
我们可以将其构建在我们的硬件和软件之中
我们的用户下载最新最安全的iOS版本
以及各位开发者使用我们的安全技术
来打造安全应用
我们的成果如何？
这个问题问得非常好那我们的成果如何？
iOS安全有多好？
安全的有趣之处在于因为和性能不同
你无法直接测量
你无法进行测试 看看得出一个客观的答案会花多长时间
所以剩下的就是间接指标
今天我会和大家分享三点
没大范围iOS恶意软件
第一个是自推出后的十年时间里
还没有任何一种iOS恶意软件大范围影响我们的用户
这一点对我们最为重要
我们的用户在将近10年时间里得到了无微不至的保护
下一个间接指标很有意思
就是看看一些放出的不受限的越狱工具
这些越狱工具击败了iOS安全机制
有意思的地方是我们看到的最新版本
经常需要找到并链接起
5到10个截然不同的漏洞才能够
击败平台安全机制
这比其他任何平台都要高得多
原因是iOS安全措施是步调紧密地共同发挥作用
这样击败所有的措施会花上很长时间和大量工夫
我的最后一个间接指标
我希望各位半信半疑地听一下
可能在座的大多数人已经知道那就是软件漏洞黑市
时不时地 一些价格
会在黑市上变得透明
通常这些价格是几万美元
有时候是十万美元
但在2013年纽约时报获悉
一个iOS漏洞价值五十万美元
去年 福布斯采访了一名越狱工具开发者
那个人说大多数专家一致认为一款无限制的iOS越狱工具
的黑市价格是一百万美元
一百万美元
各位半信半疑地听不过这个数字真的非常惊人
接下来我们应该怎么做？
很明显安全是过程而并非终点
在iOS安全上我们还会继续努力 永远不会停歇
这也不是我们最近才感兴趣的事
你现在看到的是我们10年的结晶
为保护用户所做出的最杰出工作
但是坏人不会善罢甘休
而我们会不断发展我们的安全
来击败现在以及将来的威胁
我们会利用我们硬件和软件的专业技术
我们会构建出我们所能设想的最好安全技术
来保护我们的客户 和他们现在使用移动设备的方式
以及将来使用的方式
并保护我们的客户不受现在和将来的攻击者的侵害
哪怕是猫
非常感谢
如果你想了解更多信息
我邀请你去阅读iOS安全指南
其中有关于这些强大功能的大量技术细节
我刚才讲过的还包括我没时间讲的
例如iCloud Keychain和双因素认证
在此次会议的网站上会有一个链接
再次感谢大家